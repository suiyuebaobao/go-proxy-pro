import{_ as E,a as F,r as i,c as J,o as O,b as P,d as w,e as c,f as t,w as o,h as n,i as h,M as j,n as p,J as U,k as q,t as S}from"./index-DggV_0iX.js";const z={class:"usage-page"},G={class:"card-header"},H={__name:"Usage",setup(K){const s=F({totalRequests:0,totalTokens:0,todayCost:0,totalCost:0}),k=i([]),v=i(!1),g=i([]),m=i(!1),y=new Date,V=new Date(y.getTime()-7*24*60*60*1e3),d=i([V,y]),B=[{text:"最近一周",value:()=>{const e=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*7),[a,e]}},{text:"最近一月",value:()=>{const e=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*30),[a,e]}},{text:"最近三月",value:()=>{const e=new Date,a=new Date;return a.setTime(a.getTime()-3600*1e3*24*90),[a,e]}}],T=J(()=>g.value.reduce((e,a)=>e+(a.cost||0),0));function R(e){return!T.value||!e?0:Math.round(e/T.value*100)}function b(e){return e==null?"0.0000":e.toFixed(4)}function D(e){return e.toISOString().split("T")[0]}async function $(){try{const e=await h.getMyUsageSummary();e.data&&(s.totalRequests=e.data.total_requests||0,s.totalTokens=e.data.total_tokens||0,s.todayCost=e.data.today_cost||0,s.totalCost=e.data.total_cost||0)}catch{}}async function x(){if(!(!d.value||d.value.length!==2)){v.value=!0;try{const e=await h.getMyDailyUsage({start_date:D(d.value[0]),end_date:D(d.value[1])});k.value=e.data||[]}catch{}finally{v.value=!1}}}async function N(){m.value=!0;try{const e=await h.getMyModelUsage();g.value=e.data||[]}catch{}finally{m.value=!1}}return O(()=>{$(),x(),N()}),(e,a)=>{const _=n("el-statistic"),u=n("el-card"),f=n("el-col"),I=n("el-row"),L=n("el-date-picker"),l=n("el-table-column"),C=n("el-table"),A=n("el-progress"),M=j("loading");return w(),P("div",z,[a[6]||(a[6]=c("div",{class:"page-header"},[c("h2",null,"使用统计")],-1)),t(I,{gutter:16,class:"stats-cards"},{default:o(()=>[t(f,{span:6},{default:o(()=>[t(u,{shadow:"hover"},{default:o(()=>[t(_,{title:"总请求数",value:s.totalRequests},{suffix:o(()=>[...a[1]||(a[1]=[p("次",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),t(f,{span:6},{default:o(()=>[t(u,{shadow:"hover"},{default:o(()=>[t(_,{title:"总 Token 消耗",value:s.totalTokens},null,8,["value"])]),_:1})]),_:1}),t(f,{span:6},{default:o(()=>[t(u,{shadow:"hover"},{default:o(()=>[t(_,{title:"今日消费",value:s.todayCost,precision:4},{prefix:o(()=>[...a[2]||(a[2]=[p("$",-1)])]),_:1},8,["value"])]),_:1})]),_:1}),t(f,{span:6},{default:o(()=>[t(u,{shadow:"hover"},{default:o(()=>[t(_,{title:"总消费",value:s.totalCost,precision:4},{prefix:o(()=>[...a[3]||(a[3]=[p("$",-1)])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(u,{class:"usage-card"},{header:o(()=>[c("div",G,[a[4]||(a[4]=c("span",null,"每日使用统计",-1)),t(L,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=r=>d.value=r),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:B,onChange:x},null,8,["modelValue"])])]),default:o(()=>[U((w(),q(C,{data:k.value,stripe:""},{default:o(()=>[t(l,{prop:"date",label:"日期",width:"120"}),t(l,{prop:"requests",label:"请求数",width:"100"}),t(l,{prop:"input_tokens",label:"输入 Token",width:"120"}),t(l,{prop:"output_tokens",label:"输出 Token",width:"120"}),t(l,{prop:"total_tokens",label:"总 Token",width:"120"}),t(l,{prop:"cost",label:"费用 ($)",width:"120"},{default:o(({row:r})=>[p(S(b(r.cost)),1)]),_:1})]),_:1},8,["data"])),[[M,v.value]])]),_:1}),t(u,{class:"usage-card"},{header:o(()=>[...a[5]||(a[5]=[c("span",null,"按模型统计",-1)])]),default:o(()=>[U((w(),q(C,{data:g.value,stripe:""},{default:o(()=>[t(l,{prop:"model",label:"模型","min-width":"200"}),t(l,{prop:"requests",label:"请求数",width:"100"}),t(l,{prop:"input_tokens",label:"输入 Token",width:"120"}),t(l,{prop:"output_tokens",label:"输出 Token",width:"120"}),t(l,{prop:"total_tokens",label:"总 Token",width:"120"}),t(l,{prop:"cost",label:"费用 ($)",width:"120"},{default:o(({row:r})=>[p(S(b(r.cost)),1)]),_:1}),t(l,{label:"占比",width:"100"},{default:o(({row:r})=>[t(A,{percentage:R(r.cost),"show-text":!1,"stroke-width":8},null,8,["percentage"])]),_:1})]),_:1},8,["data"])),[[M,m.value]])]),_:1})])}}},W=E(H,[["__scopeId","data-v-a03e77a3"]]);export{W as default};
