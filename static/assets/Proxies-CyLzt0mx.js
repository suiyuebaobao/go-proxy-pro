import{_ as ue,r as _,a as j,o as re,b as $,d as c,e as n,f as l,w as a,h as i,i as v,M as pe,n as d,D as A,J as fe,k as S,l as q,t as b,E as r}from"./index-DggV_0iX.js";const me={class:"proxies-page"},ce={class:"page-header"},ge={class:"header-actions"},_e={class:"filter-bar"},ye={class:"proxy-name-cell"},ve={class:"proxy-info"},be={class:"proxy-name-row"},ke={class:"proxy-name"},Ve={key:0,class:"proxy-remark"},xe={class:"proxy-address"},he={class:"status-cell"},Ce={key:3,class:"no-test"},ze={key:0,class:"fa-solid fa-plug-circle-check"},Se={class:"table-footer"},Ue={__name:"Proxies",setup(we){const U=_(!1),T=_([]),E=_(""),k=_(!1),h=_(!1),R=_(!1),B=_(),C=_(""),f=j({page:1,pageSize:20,total:0}),M={name:"",type:"http",host:"",port:7890,username:"",password:"",remark:"",enabled:!0},o=j({...M}),D={name:[{required:!0,message:"请输入代理名称",trigger:"blur"}],type:[{required:!0,message:"请选择代理类型",trigger:"change"}],host:[{required:!0,message:"请输入主机地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}]};async function V(){U.value=!0;try{const s=await v.getProxyConfigs({page:f.page,page_size:f.pageSize,keyword:E.value});T.value=(s.items||[]).map(e=>({...e,testStatus:e.test_status||null,latency:e.test_latency||null})),f.total=s.total||0}catch(s){console.error("Failed to load proxies:",s)}finally{U.value=!1}}let N=null;function F(){clearTimeout(N),N=setTimeout(()=>{f.page=1,V()},300)}function J(s){return{http:"",https:"success",socks5:"warning"}[s]||""}function K(){const s=C.value.trim();if(s)try{const e=/^(https?|socks5):\/\/(?:([^:@]+):([^@]+)@)?([^:\/]+):(\d+)\/?$/i,u=s.match(e);if(u){const[,p,y,g,z,w]=u;o.type=p.toLowerCase(),o.host=z,o.port=parseInt(w,10),o.username=y||"",o.password=g||"",o.name||(o.name=`${p.toUpperCase()} - ${z}:${w}`),r.success("代理地址解析成功")}else{const p=s.match(/^([^:\/]+):(\d+)$/);p&&(o.host=p[1],o.port=parseInt(p[2],10),o.name||(o.name=`HTTP - ${o.host}:${o.port}`),r.success("代理地址解析成功"))}}catch(e){console.error("解析代理URL失败:",e)}}async function O(s){try{return await v.testProxyConnectivity({id:s.id||0,type:s.type,host:s.host,port:s.port,username:s.username||"",password:s.password||""})}catch(e){return{success:!1,error:e.message||"测试请求失败"}}}async function G(s){s.testStatus="testing",s.latency=null;const e=await O(s);e.success?(s.testStatus="success",s.latency=e.latency):(s.testStatus="failed",r.error(e.error||"代理连接失败"))}function Q(){Object.assign(o,{...M}),C.value="",h.value=!1,k.value=!0}function W(s){Object.assign(o,{...s}),C.value="",h.value=!0,k.value=!0}async function X(s){try{await v.toggleProxyConfig(s.id),r.success("更新成功"),!s.enabled&&s.is_default&&(s.is_default=!1)}catch{s.enabled=!s.enabled,r.error("更新失败")}}async function Y(s){try{await v.setDefaultProxyConfig(s.id),T.value.forEach(e=>{e.is_default=e.id===s.id}),r.success(`已将 "${s.name}" 设为默认代理，用于OAuth认证`)}catch(e){r.error(e.message||"设置失败")}}async function Z(s){try{await v.deleteProxyConfig(s),r.success("删除成功"),V()}catch(e){r.error(e.message||"删除失败")}}async function ee(){var e;if(await((e=B.value)==null?void 0:e.validate().catch(()=>!1))){R.value=!0;try{r.info("正在测试代理连通性...");const u=await O(o);u.success?r.success(`代理连接测试成功，延迟: ${u.latency}ms`):r.warning(`代理连接测试失败: ${u.error}，仍将保存配置`),h.value?(await v.updateProxyConfig(o.id,o),r.success("更新成功")):(await v.createProxyConfig(o),r.success("创建成功")),k.value=!1,V()}catch(u){r.error(u.message||"操作失败")}finally{R.value=!1}}}return re(()=>{V()}),(s,e)=>{const u=i("el-button"),p=i("el-input"),y=i("el-tag"),g=i("el-table-column"),z=i("el-switch"),w=i("el-popconfirm"),te=i("el-table"),le=i("el-pagination"),ae=i("el-card"),m=i("el-form-item"),H=i("el-divider"),I=i("el-radio-button"),se=i("el-radio-group"),P=i("el-col"),oe=i("el-input-number"),L=i("el-row"),ne=i("el-form"),ie=i("el-dialog"),de=pe("loading");return c(),$("div",me,[n("div",ce,[e[16]||(e[16]=n("div",{class:"header-left"},[n("h2",null,"代理管理"),n("p",{class:"header-desc"},"管理代理服务器配置，用于账户连接")],-1)),n("div",ge,[l(u,{onClick:V},{default:a(()=>[n("i",{class:A(["fa-solid fa-sync-alt",{"fa-spin":U.value}])},null,2),e[14]||(e[14]=d(" 刷新 ",-1))]),_:1}),l(u,{type:"primary",onClick:Q},{default:a(()=>[...e[15]||(e[15]=[n("i",{class:"fa-solid fa-plus"},null,-1),d(" 添加代理 ",-1)])]),_:1})])]),n("div",_e,[l(p,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=t=>E.value=t),placeholder:"搜索代理名称、地址...",clearable:"",style:{width:"300px"},onInput:F},{prefix:a(()=>[...e[17]||(e[17]=[n("i",{class:"fa-solid fa-search"},null,-1)])]),_:1},8,["modelValue"])]),l(ae,{class:"proxies-table-card",shadow:"never"},{default:a(()=>[fe((c(),S(te,{data:T.value,stripe:""},{default:a(()=>[l(g,{label:"代理名称","min-width":"180"},{default:a(({row:t})=>[n("div",ye,[n("div",{class:A(["proxy-icon",t.type])},[...e[18]||(e[18]=[n("i",{class:"fa-solid fa-shield-halved"},null,-1)])],2),n("div",ve,[n("div",be,[n("span",ke,b(t.name),1),t.is_default?(c(),S(y,{key:0,type:"warning",size:"small",class:"default-tag"},{default:a(()=>[...e[19]||(e[19]=[n("i",{class:"fa-solid fa-star"},null,-1),d(" 默认 ",-1)])]),_:1})):q("",!0)]),t.remark?(c(),$("span",Ve,b(t.remark),1)):q("",!0)])])]),_:1}),l(g,{label:"类型",width:"100"},{default:a(({row:t})=>[l(y,{type:J(t.type),size:"small"},{default:a(()=>[d(b(t.type.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),l(g,{label:"地址","min-width":"200"},{default:a(({row:t})=>[n("span",xe,b(t.host)+":"+b(t.port),1)]),_:1}),l(g,{label:"连接状态",width:"120",align:"center"},{default:a(({row:t})=>[n("div",he,[t.testStatus==="testing"?(c(),S(y,{key:0,type:"info",size:"small"},{default:a(()=>[...e[20]||(e[20]=[n("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),d(" 测试中 ",-1)])]),_:1})):t.testStatus==="success"?(c(),S(y,{key:1,type:"success",size:"small"},{default:a(()=>[e[21]||(e[21]=n("i",{class:"fa-solid fa-check"},null,-1)),d(" "+b(t.latency)+"ms ",1)]),_:2},1024)):t.testStatus==="failed"?(c(),S(y,{key:2,type:"danger",size:"small"},{default:a(()=>[...e[22]||(e[22]=[n("i",{class:"fa-solid fa-xmark"},null,-1),d(" 失败 ",-1)])]),_:1})):(c(),$("span",Ce,"未测试"))])]),_:1}),l(g,{label:"启用",width:"80",align:"center"},{default:a(({row:t})=>[l(z,{modelValue:t.enabled,"onUpdate:modelValue":x=>t.enabled=x,size:"small",onChange:x=>X(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(g,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(u,{link:"",type:"warning",size:"small",onClick:x=>Y(t),disabled:t.is_default||!t.enabled},{default:a(()=>[...e[23]||(e[23]=[n("i",{class:"fa-solid fa-star"},null,-1),d(" 设为默认 ",-1)])]),_:1},8,["onClick","disabled"]),l(u,{link:"",type:"success",size:"small",onClick:x=>G(t),loading:t.testStatus==="testing"},{default:a(()=>[t.testStatus!=="testing"?(c(),$("i",ze)):q("",!0),e[24]||(e[24]=d(" 测试 ",-1))]),_:2},1032,["onClick","loading"]),l(u,{link:"",type:"primary",size:"small",onClick:x=>W(t)},{default:a(()=>[...e[25]||(e[25]=[n("i",{class:"fa-solid fa-edit"},null,-1),d(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(w,{title:"确定删除该代理吗？","confirm-button-text":"删除","cancel-button-text":"取消",onConfirm:x=>Z(t.id)},{reference:a(()=>[l(u,{link:"",type:"danger",size:"small"},{default:a(()=>[...e[26]||(e[26]=[n("i",{class:"fa-solid fa-trash"},null,-1),d(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[de,U.value]]),n("div",Se,[l(le,{"current-page":f.page,"onUpdate:currentPage":e[1]||(e[1]=t=>f.page=t),"page-size":f.pageSize,"onUpdate:pageSize":e[2]||(e[2]=t=>f.pageSize=t),total:f.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:V},null,8,["current-page","page-size","total"])])]),_:1}),l(ie,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=t=>k.value=t),title:h.value?"编辑代理":"添加代理",width:"500px","close-on-click-modal":!1},{footer:a(()=>[l(u,{onClick:e[12]||(e[12]=t=>k.value=!1)},{default:a(()=>[...e[34]||(e[34]=[d("取消",-1)])]),_:1}),l(u,{type:"primary",loading:R.value,onClick:ee},{default:a(()=>[d(b(h.value?"保存修改":"添加代理"),1)]),_:1},8,["loading"])]),default:a(()=>[l(ne,{model:o,rules:D,ref_key:"formRef",ref:B,"label-position":"top"},{default:a(()=>[l(m,{label:"快速导入"},{default:a(()=>[l(p,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=t=>C.value=t),placeholder:"粘贴代理URL自动解析，如: http://user:pass@host:port 或 socks5://host:port",clearable:"",onInput:K},{prefix:a(()=>[...e[27]||(e[27]=[n("i",{class:"fa-solid fa-magic-wand-sparkles"},null,-1)])]),_:1},8,["modelValue"]),e[28]||(e[28]=n("div",{class:"form-tip"},"支持格式: http://, https://, socks5:// 开头的代理地址",-1))]),_:1}),l(H,{"content-position":"left"},{default:a(()=>[...e[29]||(e[29]=[d("代理配置",-1)])]),_:1}),l(m,{label:"代理名称",prop:"name"},{default:a(()=>[l(p,{modelValue:o.name,"onUpdate:modelValue":e[4]||(e[4]=t=>o.name=t),placeholder:"为代理设置一个易识别的名称"},null,8,["modelValue"])]),_:1}),l(m,{label:"代理类型",prop:"type"},{default:a(()=>[l(se,{modelValue:o.type,"onUpdate:modelValue":e[5]||(e[5]=t=>o.type=t)},{default:a(()=>[l(I,{value:"http"},{default:a(()=>[...e[30]||(e[30]=[d("HTTP",-1)])]),_:1}),l(I,{value:"https"},{default:a(()=>[...e[31]||(e[31]=[d("HTTPS",-1)])]),_:1}),l(I,{value:"socks5"},{default:a(()=>[...e[32]||(e[32]=[d("SOCKS5",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(L,{gutter:16},{default:a(()=>[l(P,{span:16},{default:a(()=>[l(m,{label:"主机地址",prop:"host"},{default:a(()=>[l(p,{modelValue:o.host,"onUpdate:modelValue":e[6]||(e[6]=t=>o.host=t),placeholder:"例如: 127.0.0.1 或 proxy.example.com"},null,8,["modelValue"])]),_:1})]),_:1}),l(P,{span:8},{default:a(()=>[l(m,{label:"端口",prop:"port"},{default:a(()=>[l(oe,{modelValue:o.port,"onUpdate:modelValue":e[7]||(e[7]=t=>o.port=t),min:1,max:65535,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(H,{"content-position":"left"},{default:a(()=>[...e[33]||(e[33]=[d("认证配置（可选）",-1)])]),_:1}),l(L,{gutter:16},{default:a(()=>[l(P,{span:12},{default:a(()=>[l(m,{label:"用户名"},{default:a(()=>[l(p,{modelValue:o.username,"onUpdate:modelValue":e[8]||(e[8]=t=>o.username=t),placeholder:"代理认证用户名"},null,8,["modelValue"])]),_:1})]),_:1}),l(P,{span:12},{default:a(()=>[l(m,{label:"密码"},{default:a(()=>[l(p,{modelValue:o.password,"onUpdate:modelValue":e[9]||(e[9]=t=>o.password=t),type:"password","show-password":"",placeholder:"代理认证密码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{label:"备注"},{default:a(()=>[l(p,{modelValue:o.remark,"onUpdate:modelValue":e[10]||(e[10]=t=>o.remark=t),type:"textarea",rows:2,placeholder:"备注信息（可选）"},null,8,["modelValue"])]),_:1}),l(m,{label:"启用"},{default:a(()=>[l(z,{modelValue:o.enabled,"onUpdate:modelValue":e[11]||(e[11]=t=>o.enabled=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},$e=ue(Ue,[["__scopeId","data-v-c7cc82cf"]]);export{$e as default};
