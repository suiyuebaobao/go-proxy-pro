import{_ as Ue,r as C,C as be,c as N,h,b as f,d as p,l as _,e,f as t,w as i,n as c,k as x,t as g,F as W,D as z,G as ze,E as T,i as j,a as Ie,H as te,I as de,J as Te,L as Oe,o as Pe,M as Ke,N as Ge}from"./index-DggV_0iX.js";const Le={class:"oauth-flow"},De={key:0,class:"oauth-section claude"},Fe={class:"auth-method-select"},Re={key:0,class:"cookie-auth"},Be={class:"label-with-badge"},We={key:0,class:"session-key-tip"},qe={key:0,class:"help-section"},Ne={key:1,class:"manual-auth"},je={class:"auth-steps"},Ee={class:"step-card"},Je={class:"step-content"},He={key:0,class:"fa-solid fa-link"},Xe={key:1,class:"auth-url-container"},Ze={class:"step-card"},Qe={class:"step-content"},Ye={class:"step-card"},el={class:"step-content"},ll={key:1,class:"oauth-section gemini"},al={class:"auth-steps"},tl={class:"step-card"},sl={class:"step-content"},ol={key:0,class:"fa-solid fa-link"},nl={key:1,class:"auth-url-container"},il={class:"step-card"},dl={class:"step-content"},ul={key:2,class:"oauth-section openai"},rl={class:"auth-steps"},pl={class:"step-card"},cl={class:"step-content"},fl={key:0,class:"fa-solid fa-link"},ml={key:1,class:"auth-url-container"},yl={class:"step-card"},vl={class:"step-content"},_l={class:"step-card"},gl={class:"step-content"},bl={class:"oauth-actions"},kl={__name:"OAuthFlow",props:{platform:{type:String,required:!0},proxy:{type:Object,default:null},authMode:{type:String,default:"oauth",validator:se=>["oauth","cookie"].includes(se)}},emits:["success","back"],setup(se,{emit:ue}){const k=se,J=ue,P=C(!1),G=C(!1),I=C(""),$=C(""),D=C(!1),U=C(""),S=C("manual"),R=C(""),E=C(!1),Z=C(""),oe=C(!1),H=C({current:0,total:0});be(()=>k.authMode,A=>{A==="cookie"?S.value="cookie":S.value="manual"},{immediate:!0});const ne=N(()=>k.platform==="claude"||k.platform==="claude-official"),Q=N(()=>R.value.split(`
`).map(A=>A.trim()).filter(A=>A.length>0).length),re=N(()=>I.value&&$.value.trim());be($,A=>{if(!A||typeof A!="string")return;const d=A.trim();if(!d)return;if((d.startsWith("http://")||d.startsWith("https://"))&&(d.startsWith("http://localhost:45462")||d.startsWith("http://localhost:1455")))try{const K=new URL(d).searchParams.get("code");K&&($.value=K,T.success("成功提取授权码！"))}catch(M){console.error("Failed to parse URL:",M)}});function fe(){return k.platform==="openai-responses"?"openai":k.platform}async function pe(){var A,d,F;P.value=!0,I.value="",$.value="",U.value="";try{const M=(A=k.proxy)!=null&&A.enabled?{type:k.proxy.type,host:k.proxy.host,port:parseInt(k.proxy.port),username:k.proxy.username||null,password:k.proxy.password||null}:null,K=await j.generateOAuthUrl(fe(),M);I.value=K.data.auth_url,U.value=K.data.session_id,T.success("授权链接已生成")}catch(M){T.error(((F=(d=M.response)==null?void 0:d.data)==null?void 0:F.message)||M.message||"生成授权链接失败")}finally{P.value=!1}}function me(){I.value="",$.value="",U.value="",pe()}async function ye(){if(!I.value){T.warning("请先生成授权链接");return}try{await navigator.clipboard.writeText(I.value),D.value=!0,T.success("链接已复制"),setTimeout(()=>{D.value=!1},2e3)}catch{const d=document.createElement("input");d.value=I.value,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),D.value=!0,T.success("链接已复制"),setTimeout(()=>{D.value=!1},2e3)}}async function ce(){var A,d,F;if(re.value){G.value=!0;try{const M=(A=k.proxy)!=null&&A.enabled?{type:k.proxy.type,host:k.proxy.host,port:parseInt(k.proxy.port),username:k.proxy.username||null,password:k.proxy.password||null}:null,ae=(await j.exchangeOAuthCode(fe(),$.value,U.value,M)).data;J("success",ae)}catch(M){T.error(((F=(d=M.response)==null?void 0:d.data)==null?void 0:F.message)||M.message||"授权失败，请检查授权码是否正确")}finally{G.value=!1}}}async function ve(){var K,ae,L;const A=R.value.split(`
`).map(O=>O.trim()).filter(O=>O.length>0);if(A.length===0){Z.value="请输入至少一个 sessionKey";return}E.value=!0,Z.value="",H.value={current:0,total:A.length};const d=(K=k.proxy)!=null&&K.enabled?{type:k.proxy.type,host:k.proxy.host,port:parseInt(k.proxy.port),username:k.proxy.username||null,password:k.proxy.password||null}:null,F=[],M=[];for(let O=0;O<A.length;O++){H.value.current=O+1;try{const ee=await j.oauthByCookie(k.platform,A[O],d);F.push({...ee.data,session_key:A[O]})}catch(ee){M.push({index:O+1,key:A[O].substring(0,20)+"...",error:((L=(ae=ee.response)==null?void 0:ae.data)==null?void 0:L.message)||ee.message})}}H.value={current:0,total:0},E.value=!1,F.length>0&&J("success",F),M.length>0&&F.length===0?Z.value="全部授权失败，请检查 sessionKey 是否有效":M.length>0&&(Z.value=`${M.length} 个授权失败`)}function a(){R.value="",Z.value="",E.value=!1,H.value={current:0,total:0},I.value="",$.value="",U.value=""}return(A,d)=>{const F=h("el-radio"),M=h("el-radio-group"),K=h("el-alert"),ae=h("el-tag"),L=h("el-button"),O=h("el-input"),ee=h("el-form-item"),ie=h("el-form"),_e=h("el-collapse-transition");return p(),f("div",Le,[ne.value?(p(),f("div",De,[d[31]||(d[31]=e("div",{class:"oauth-header"},[e("div",{class:"platform-icon claude"},[e("i",{class:"fa-solid fa-brain"})]),e("div",{class:"platform-info"},[e("h4",null,"Claude 账户授权")])],-1)),e("div",Fe,[d[12]||(d[12]=e("label",{class:"method-label"},"选择授权方式",-1)),t(M,{modelValue:S.value,"onUpdate:modelValue":d[0]||(d[0]=V=>S.value=V),onChange:a},{default:i(()=>[t(F,{value:"manual"},{default:i(()=>[...d[10]||(d[10]=[c("手动授权",-1)])]),_:1}),t(F,{value:"cookie"},{default:i(()=>[...d[11]||(d[11]=[c("SessionKey 自动授权",-1)])]),_:1})]),_:1},8,["modelValue"])]),S.value==="cookie"?(p(),f("div",Re,[t(K,{type:"info",closable:!1,class:"mb-4"},{title:i(()=>[...d[13]||(d[13]=[e("i",{class:"fa-solid fa-cookie"},null,-1),c(" 使用 claude.ai 的 sessionKey 自动完成 OAuth 授权流程 ",-1)])]),_:1}),t(ie,{"label-position":"top"},{default:i(()=>[t(ee,null,{label:i(()=>[e("span",Be,[d[15]||(d[15]=e("i",{class:"fa-solid fa-cookie text-blue-500"},null,-1)),d[16]||(d[16]=c(" sessionKey ",-1)),Q.value>1?(p(),x(ae,{key:0,size:"small",type:"primary",class:"ml-2"},{default:i(()=>[c(g(Q.value)+" 个 ",1)]),_:1})):_("",!0),t(L,{link:"",type:"primary",class:"ml-2",onClick:d[1]||(d[1]=V=>oe.value=!oe.value)},{default:i(()=>[...d[14]||(d[14]=[e("i",{class:"fa-solid fa-question-circle"},null,-1)])]),_:1})])]),default:i(()=>[t(O,{modelValue:R.value,"onUpdate:modelValue":d[2]||(d[2]=V=>R.value=V),type:"textarea",rows:3,placeholder:`每行一个 sessionKey，例如：
sk-ant-sid01-xxxxx...
sk-ant-sid01-yyyyy...`},null,8,["modelValue"]),Q.value>1?(p(),f("div",We,[d[17]||(d[17]=e("i",{class:"fa-solid fa-info-circle"},null,-1)),c(" 将批量创建 "+g(Q.value)+" 个账户 ",1)])):_("",!0)]),_:1})]),_:1}),t(_e,null,{default:i(()=>[oe.value?(p(),f("div",qe,[...d[18]||(d[18]=[e("h5",null,[e("i",{class:"fa-solid fa-lightbulb"}),c(" 如何获取 sessionKey")],-1),e("ol",null,[e("li",null,[c("在浏览器中登录 "),e("strong",null,"claude.ai")]),e("li",null,[c("按 "),e("kbd",null,"F12"),c(" 打开开发者工具")]),e("li",null,[c("切换到 "),e("strong",null,"Application"),c("（应用）标签页")]),e("li",null,[c("在左侧找到 "),e("strong",null,"Cookies"),c(" → "),e("strong",null,"https://claude.ai")]),e("li",null,[c("找到键为 "),e("strong",null,"sessionKey"),c(" 的那一行")]),e("li",null,[c("复制其 "),e("strong",null,"Value"),c("（值）列的内容")])],-1),e("p",{class:"tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" sessionKey 通常以 "),e("code",null,"sk-ant-sid01-"),c(" 开头 ")],-1)])])):_("",!0)]),_:1}),Z.value?(p(),x(K,{key:0,type:"error",closable:!1,class:"mb-4"},{title:i(()=>[d[19]||(d[19]=e("i",{class:"fa-solid fa-exclamation-circle"},null,-1)),c(" "+g(Z.value),1)]),_:1})):_("",!0),t(L,{type:"primary",size:"large",class:"w-full",loading:E.value,disabled:!R.value.trim(),onClick:ve},{default:i(()=>[E.value&&H.value.total>1?(p(),f(W,{key:0},[c(" 正在授权 "+g(H.value.current)+"/"+g(H.value.total)+"... ",1)],64)):E.value?(p(),f(W,{key:1},[c("正在授权...")],64)):(p(),f(W,{key:2},[d[20]||(d[20]=e("i",{class:"fa-solid fa-magic"},null,-1)),d[21]||(d[21]=c(" 开始自动授权 ",-1))],64))]),_:1},8,["loading","disabled"])])):(p(),f("div",Ne,[d[30]||(d[30]=e("p",{class:"auth-desc"},"请按照以下步骤完成 Claude 账户的授权：",-1)),e("div",je,[e("div",Ee,[d[23]||(d[23]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"1"),e("div",{class:"step-title"},"点击下方按钮生成授权链接")],-1)),e("div",Je,[I.value?(p(),f("div",Xe,[t(O,{modelValue:I.value,"onUpdate:modelValue":d[3]||(d[3]=V=>I.value=V),readonly:""},{append:i(()=>[t(L,{onClick:ye},{default:i(()=>[e("i",{class:z(D.value?"fa-solid fa-check text-green-500":"fa-solid fa-copy")},null,2)]),_:1})]),_:1},8,["modelValue"]),t(L,{link:"",type:"primary",class:"mt-2",onClick:me},{default:i(()=>[...d[22]||(d[22]=[e("i",{class:"fa-solid fa-sync-alt"},null,-1),c(" 重新生成 ",-1)])]),_:1})])):(p(),x(L,{key:0,type:"primary",loading:P.value,onClick:pe},{default:i(()=>[P.value?_("",!0):(p(),f("i",He)),c(" "+g(P.value?"生成中...":"生成授权链接"),1)]),_:1},8,["loading"]))])]),e("div",Ze,[d[26]||(d[26]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"2"),e("div",{class:"step-title"},"在浏览器中打开链接并完成授权")],-1)),e("div",Qe,[d[25]||(d[25]=e("p",null,"请在新标签页中打开授权链接，登录您的 Claude 账户并授权。",-1)),t(K,{type:"warning",closable:!1,class:"mt-2"},{title:i(()=>[...d[24]||(d[24]=[e("i",{class:"fa-solid fa-exclamation-triangle"},null,-1),e("strong",null,"注意：",-1),c("如果您设置了代理，请确保浏览器也使用相同的代理访问授权页面。 ",-1)])]),_:1})])]),e("div",Ye,[d[29]||(d[29]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"3"),e("div",{class:"step-title"},"输入 Authorization Code")],-1)),e("div",el,[d[27]||(d[27]=e("p",{class:"mb-3"},[c("授权完成后，页面会显示一个 "),e("strong",null,"Authorization Code"),c("，请将其复制并粘贴到下方输入框：")],-1)),t(O,{modelValue:$.value,"onUpdate:modelValue":d[4]||(d[4]=V=>$.value=V),type:"textarea",rows:3,placeholder:"粘贴从 Claude 页面获取的 Authorization Code..."},null,8,["modelValue"]),d[28]||(d[28]=e("p",{class:"tip mt-2"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 请粘贴从 Claude 页面复制的 Authorization Code ")],-1))])])])]))])):se.platform==="gemini"?(p(),f("div",ll,[d[36]||(d[36]=ze('<div class="oauth-header" data-v-1cda5bf5><div class="platform-icon gemini" data-v-1cda5bf5><i class="fa-brands fa-google" data-v-1cda5bf5></i></div><div class="platform-info" data-v-1cda5bf5><h4 data-v-1cda5bf5>Gemini 账户授权</h4></div></div><p class="auth-desc" data-v-1cda5bf5>请按照以下步骤完成 Gemini 账户的授权：</p>',2)),e("div",al,[e("div",tl,[d[33]||(d[33]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"1"),e("div",{class:"step-title"},"点击下方按钮生成授权链接")],-1)),e("div",sl,[I.value?(p(),f("div",nl,[t(O,{modelValue:I.value,"onUpdate:modelValue":d[5]||(d[5]=V=>I.value=V),readonly:""},{append:i(()=>[t(L,{onClick:ye},{default:i(()=>[e("i",{class:z(D.value?"fa-solid fa-check text-green-500":"fa-solid fa-copy")},null,2)]),_:1})]),_:1},8,["modelValue"]),t(L,{link:"",type:"primary",class:"mt-2",onClick:me},{default:i(()=>[...d[32]||(d[32]=[e("i",{class:"fa-solid fa-sync-alt"},null,-1),c(" 重新生成 ",-1)])]),_:1})])):(p(),x(L,{key:0,type:"primary",loading:P.value,onClick:pe},{default:i(()=>[P.value?_("",!0):(p(),f("i",ol)),c(" "+g(P.value?"生成中...":"生成授权链接"),1)]),_:1},8,["loading"]))])]),d[35]||(d[35]=ze('<div class="step-card" data-v-1cda5bf5><div class="step-header" data-v-1cda5bf5><div class="step-num" data-v-1cda5bf5>2</div><div class="step-title" data-v-1cda5bf5>在浏览器中打开链接并完成授权</div></div><div class="step-content" data-v-1cda5bf5><p data-v-1cda5bf5>请在新标签页中打开授权链接，登录您的 Google 账户并授权。</p></div></div>',1)),e("div",il,[d[34]||(d[34]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"3"),e("div",{class:"step-title"},"输入 Authorization Code")],-1)),e("div",dl,[t(O,{modelValue:$.value,"onUpdate:modelValue":d[6]||(d[6]=V=>$.value=V),type:"textarea",rows:3,placeholder:"粘贴从 Gemini 页面获取的 Authorization Code..."},null,8,["modelValue"])])])])])):se.platform==="openai"||se.platform==="openai-responses"?(p(),f("div",ul,[d[47]||(d[47]=ze('<div class="oauth-header" data-v-1cda5bf5><div class="platform-icon openai" data-v-1cda5bf5><i class="fa-solid fa-robot" data-v-1cda5bf5></i></div><div class="platform-info" data-v-1cda5bf5><h4 data-v-1cda5bf5>OpenAI 账户授权</h4></div></div><p class="auth-desc" data-v-1cda5bf5>请按照以下步骤完成 OpenAI 账户的授权：</p>',2)),e("div",rl,[e("div",pl,[d[38]||(d[38]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"1"),e("div",{class:"step-title"},"点击下方按钮生成授权链接")],-1)),e("div",cl,[I.value?(p(),f("div",ml,[t(O,{modelValue:I.value,"onUpdate:modelValue":d[7]||(d[7]=V=>I.value=V),readonly:""},{append:i(()=>[t(L,{onClick:ye},{default:i(()=>[e("i",{class:z(D.value?"fa-solid fa-check text-green-500":"fa-solid fa-copy")},null,2)]),_:1})]),_:1},8,["modelValue"]),t(L,{link:"",type:"primary",class:"mt-2",onClick:me},{default:i(()=>[...d[37]||(d[37]=[e("i",{class:"fa-solid fa-sync-alt"},null,-1),c(" 重新生成 ",-1)])]),_:1})])):(p(),x(L,{key:0,type:"primary",loading:P.value,onClick:pe},{default:i(()=>[P.value?_("",!0):(p(),f("i",fl)),c(" "+g(P.value?"生成中...":"生成授权链接"),1)]),_:1},8,["loading"]))])]),e("div",yl,[d[44]||(d[44]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"2"),e("div",{class:"step-title"},"在浏览器中打开链接并完成授权")],-1)),e("div",vl,[d[43]||(d[43]=e("p",null,"请在新标签页中打开授权链接，登录您的 OpenAI 账户并授权。",-1)),t(K,{type:"info",closable:!1,class:"mt-2"},{title:i(()=>[...d[39]||(d[39]=[e("i",{class:"fa-solid fa-clock"},null,-1),e("strong",null,"重要提示：",-1),c("授权后页面可能会加载较长时间，请耐心等待。 ",-1)])]),default:i(()=>[d[40]||(d[40]=c(" 当浏览器地址栏变为 ",-1)),d[41]||(d[41]=e("strong",null,"http://localhost:1455/...",-1)),d[42]||(d[42]=c(" 开头时，表示授权已完成。 ",-1))]),_:1})])]),e("div",_l,[d[46]||(d[46]=e("div",{class:"step-header"},[e("div",{class:"step-num"},"3"),e("div",{class:"step-title"},"输入授权链接或 Code")],-1)),e("div",gl,[t(O,{modelValue:$.value,"onUpdate:modelValue":d[8]||(d[8]=V=>$.value=V),type:"textarea",rows:3,placeholder:`方式1：复制完整的链接（http://localhost:1455/auth/callback?code=...）
方式2：仅复制 code 参数的值
系统会自动识别并提取所需信息`},null,8,["modelValue"]),t(K,{type:"info",closable:!1,class:"mt-2"},{title:i(()=>[...d[45]||(d[45]=[e("i",{class:"fa-solid fa-lightbulb"},null,-1),e("strong",null,"提示：",-1),c("您可以直接复制整个链接或仅复制 code 参数值，系统会自动识别。 ",-1)])]),_:1})])])])])):_("",!0),e("div",bl,[t(L,{onClick:d[9]||(d[9]=V=>A.$emit("back"))},{default:i(()=>[...d[48]||(d[48]=[c("上一步",-1)])]),_:1}),ne.value&&S.value==="cookie"?_("",!0):(p(),x(L,{key:0,type:"primary",disabled:!re.value,loading:G.value,onClick:ce},{default:i(()=>[c(g(G.value?"验证中...":"完成授权"),1)]),_:1},8,["disabled","loading"]))])])}}},hl=Ue(kl,[["__scopeId","data-v-1cda5bf5"]]),Vl={key:0,class:"steps-indicator"},Al={key:1,class:"form-step"},Cl={class:"form-section"},wl={class:"platform-groups"},xl=["onClick"],$l={class:"card-info"},zl={key:0,class:"check-mark"},Il={key:0,class:"subplatform-section"},Ul={class:"subplatform-grid"},Tl=["value"],Sl={class:"sub-info"},Ml={class:"sub-name"},Ol={class:"sub-desc"},Pl={key:0,class:"check-mark small"},Kl={key:0,class:"form-section"},Gl={class:"add-type-cards"},Ll={key:0,class:"type-check"},Dl={key:0,class:"type-check"},Fl={key:0,class:"type-check"},Rl={key:0,class:"type-check"},Bl={key:0,class:"type-check"},Wl={key:0,class:"type-check"},ql={class:"form-section"},Nl={key:1,class:"form-section"},jl={class:"section-title"},El={class:"form-section"},Jl={class:"form-section"},Hl={key:2,class:"form-step"},Xl={key:3,class:"form-step"},Zl={class:"edit-type-banner"},Ql={key:0,class:"form-section"},Yl={key:1,class:"form-section"},ea={key:2,class:"form-section"},la={key:3,class:"form-section"},aa={class:"form-section"},ta={class:"mapping-option"},sa={class:"source-model"},oa={class:"target-model"},na={class:"form-section"},ia={class:"dialog-footer"},da={key:0,class:"fa-solid fa-arrow-right ml-2"},ua={__name:"AccountForm",props:{modelValue:Boolean,editData:Object},emits:["update:modelValue","success"],setup(se,{emit:ue}){const k=se,J=ue,P=N({get:()=>k.modelValue,set:r=>J("update:modelValue",r)}),G=N(()=>{var r;return!!((r=k.editData)!=null&&r.id)}),I=C(),$=C(1),D=C(!1),U=C(""),S=[{key:"claude",name:"Claude",desc:"Anthropic AI",icon:"fa-solid fa-brain",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{key:"openai",name:"OpenAI",desc:"GPT 系列模型",icon:"fa-solid fa-robot",gradient:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"},{key:"gemini",name:"Gemini",desc:"Google AI",icon:"fa-brands fa-google",gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}],R={claude:[{value:"claude-official",label:"Claude Official",desc:"OAuth 认证",icon:"fa-solid fa-key",color:"#667eea"},{value:"claude-console",label:"Claude Console",desc:"API Key 认证",icon:"fa-solid fa-terminal",color:"#764ba2"},{value:"bedrock",label:"AWS Bedrock",desc:"AWS 托管服务",icon:"fa-brands fa-aws",color:"#ff9900"}],openai:[{value:"openai",label:"OpenAI 三方 API",desc:"API Key 认证",icon:"fa-solid fa-bolt",color:"#11998e"},{value:"openai-responses",label:"ChatGPT 官方",desc:"OAuth / SessionKey",icon:"fa-solid fa-comments",color:"#38ef7d"},{value:"azure-openai",label:"Azure OpenAI",desc:"Azure 托管",icon:"fa-brands fa-microsoft",color:"#0078d4"}],gemini:[{value:"gemini",label:"Gemini",desc:"Google AI Studio",icon:"fa-brands fa-google",color:"#4facfe"}]},E=N(()=>R[U.value]||[]),Z=C([]),oe=C(!1),H=C([]),ne=C(!1),Q=C([]),re=C(!1),fe=N(()=>{let r="";if(U.value)r=U.value;else if(a.type){for(const[l,y]of Object.entries(R))if(y.some(m=>m.value===a.type)){r=l;break}}return r?Z.value.filter(l=>l.platform.toLowerCase()===r):[]}),pe=N(()=>{if(!a.proxy_id)return null;const r=H.value.find(l=>l.id===a.proxy_id);return r?{enabled:!0,type:r.type,host:r.host,port:r.port,username:r.username||"",password:r.password||""}:null});async function me(){oe.value=!0;try{const l=(await j.getModels({enabled:!0})).data||[],y={};l.forEach(m=>{const s=m.platform||"other";y[s]||(y[s]={platform:s.charAt(0).toUpperCase()+s.slice(1),models:[]}),y[s].models.push(m.name)}),Z.value=Object.values(y)}catch(r){console.error("Failed to load models:",r)}finally{oe.value=!1}}async function ye(){ne.value=!0;try{const r=await j.getEnabledProxyConfigs();H.value=r.items||[]}catch(r){console.error("Failed to load proxies:",r)}finally{ne.value=!1}}async function ce(){var r;re.value=!0;try{const l=await j.getModelMappings();Q.value=(((r=l.data)==null?void 0:r.mappings)||[]).filter(y=>y.enabled)}catch(l){console.error("Failed to load model mappings:",l)}finally{re.value=!1}}const ve={name:"",type:"",description:"",enabled:!0,priority:50,weight:100,max_concurrency:5,accountType:"shared",addType:"oauth",api_key:"",api_url:"",access_token:"",refresh_token:"",session_key:"",organization_id:"",aws_access_key_id:"",aws_secret_access_key:"",aws_region:"us-east-1",azure_endpoint:"",azure_deployment_name:"",azure_api_version:"2024-02-01",allowed_models:"",allowedModelsList:[],model_mapping:"",selectedMappingIds:[],proxy_id:null},a=Ie({...ve}),A={name:[{required:!0,message:"请输入账户名称",trigger:"blur"}]},d=N(()=>{const r=a.type;return["claude-official","openai-responses","gemini"].includes(r)});N(()=>{const r=a.type;return!!(["claude-console","azure-openai"].includes(r)||(r==="openai"||r==="gemini")&&a.addType==="apikey")});const F=N(()=>{const r=a.type;return!!(["claude-console","bedrock","azure-openai"].includes(r)||(r==="openai"||r==="gemini")&&a.addType==="apikey"||r==="openai-responses"&&a.addType==="cookie")}),M=N(()=>{const r={"claude-console":"Claude Console 配置",bedrock:"AWS Bedrock 配置","azure-openai":"Azure OpenAI 配置",openai:"OpenAI 三方 API 配置","openai-responses":"ChatGPT 官方配置",gemini:"Gemini 配置"};return a.addType==="manual"?"Token 配置":r[a.type]||"平台配置"}),K=N(()=>a.type==="openai-responses"&&a.addType==="cookie"?!1:a.addType==="oauth"||a.addType==="cookie"),ae=N(()=>{const r=a.type;return["claude-console","openai","gemini"].includes(r)}),L=N(()=>!(!a.type||!a.name));be(()=>k.editData,r=>{if(r){if(Object.assign(a,{...ve,...r}),r.base_url&&(a.api_url=r.base_url),r.allowed_models)try{a.allowedModelsList=r.allowed_models.split(",").map(l=>l.trim()).filter(Boolean)}catch{a.allowedModelsList=[]}else a.allowedModelsList=[];if(r.model_mapping)try{const l=JSON.parse(r.model_mapping);a._rawModelMapping=l,a.selectedMappingIds=[]}catch{a.selectedMappingIds=[]}else a.selectedMappingIds=[];for(const[l,y]of Object.entries(R))if(y.some(m=>m.value===r.type)){U.value=l;break}}},{immediate:!0}),be(P,async r=>{if(r&&!G.value&&ee(),r&&(me(),ye(),await ce(),a._rawModelMapping&&Q.value.length>0)){const l=[];for(const[y,m]of Object.entries(a._rawModelMapping)){const s=Q.value.find(o=>o.source_model===y&&o.target_model===m);s&&l.push(s.id)}a.selectedMappingIds=l,delete a._rawModelMapping}});function O(r){U.value=r,a.type="",a.allowedModelsList=[],r==="claude"?a.addType="cookie":a.addType="apikey"}be(()=>a.type,r=>{r&&(r==="claude-official"?a.addType="cookie":r==="openai-responses"?a.addType="oauth":(["claude-console","bedrock","azure-openai"].includes(r)||["openai","gemini"].includes(r))&&(a.addType="apikey"))});function ee(){Object.assign(a,{...ve}),U.value="",$.value=1}function ie(){P.value=!1,ee()}async function _e(){var l;if(!await((l=I.value)==null?void 0:l.validate().catch(y=>(console.error("Form validation failed:",y),!1)))){T.warning("请填写必要的信息");return}K.value?$.value=2:await he()}async function V(r){if(Array.isArray(r))for(const l of r)a.access_token=l.access_token,a.refresh_token=l.refresh_token,a.session_key=l.session_key,await ke();else a.access_token=r.access_token,a.refresh_token=r.refresh_token,await ke()}async function ke(){D.value=!0;try{const r=Ve();await j.createAccount(r),T.success("创建成功"),J("success"),ie()}catch(r){T.error(r.message||"创建失败")}finally{D.value=!1}}async function he(){var l;if(await((l=I.value)==null?void 0:l.validate().catch(()=>!1))){D.value=!0;try{const y=Ve();G.value?(await j.updateAccount(a.id,y),T.success("更新成功")):(await j.createAccount(y),T.success("创建成功")),J("success"),ie()}catch(y){T.error(y.message||"操作失败")}finally{D.value=!1}}}function Ve(){var l,y,m,s,o;const r={name:a.name,type:a.type,description:a.description,enabled:a.enabled,priority:a.priority,weight:a.weight,max_concurrency:a.max_concurrency,account_type:a.accountType};if(a.api_key&&(r.api_key=a.api_key),a.api_url&&(r.base_url=a.api_url),a.access_token&&(r.access_token=a.access_token),a.refresh_token&&(r.refresh_token=a.refresh_token),a.session_key&&(r.session_key=a.session_key),a.organization_id&&(r.organization_id=a.organization_id),a.type==="bedrock"&&(r.aws_access_key=a.aws_access_key_id,r.aws_secret_key=a.aws_secret_access_key,r.aws_region=a.aws_region),a.type==="azure-openai"&&(r.azure_endpoint=a.azure_endpoint,r.azure_deployment_name=a.azure_deployment_name,r.azure_api_version=a.azure_api_version),a.proxy_id?r.proxy_id=a.proxy_id:G.value&&((l=k.editData)!=null&&l.proxy_id)&&(r.clear_proxy=!0),((y=a.allowedModelsList)==null?void 0:y.length)>0?r.allowed_models=a.allowedModelsList.join(","):G.value&&((m=k.editData)!=null&&m.allowed_models)&&(r.clear_allowed_models=!0),((s=a.selectedMappingIds)==null?void 0:s.length)>0){const v={};a.selectedMappingIds.forEach(b=>{const q=Q.value.find(w=>w.id===b);q&&(v[q.source_model]=q.target_model)}),Object.keys(v).length>0&&(r.model_mapping=JSON.stringify(v))}else G.value&&((o=k.editData)!=null&&o.model_mapping)&&(r.clear_model_mapping=!0);return r}function Ce(r){for(const l of Object.values(R)){const y=l.find(m=>m.value===r);if(y)return y.label}return r}function we(r){for(const l of Object.values(R)){const y=l.find(m=>m.value===r);if(y)return y.icon}return"fa-solid fa-circle"}function xe(r){for(const l of Object.values(R)){const y=l.find(m=>m.value===r);if(y)return y.color}return"#999"}return(r,l)=>{const y=h("el-input"),m=h("el-form-item"),s=h("el-option"),o=h("el-select"),v=h("el-col"),b=h("el-input-number"),q=h("el-row"),w=h("el-switch"),X=h("el-form"),B=h("el-alert"),Ae=h("el-option-group"),ge=h("el-button"),$e=h("el-dialog");return p(),x($e,{modelValue:P.value,"onUpdate:modelValue":l[55]||(l[55]=n=>P.value=n),title:G.value?"编辑账户":"添加账户",width:"800px","close-on-click-modal":!1,onClose:ie},{footer:i(()=>[e("div",ia,[t(ge,{onClick:ie},{default:i(()=>[...l[110]||(l[110]=[c("取消",-1)])]),_:1}),!G.value&&$.value===1?(p(),x(ge,{key:0,type:"primary",disabled:!L.value,onClick:_e},{default:i(()=>[c(g(K.value?"下一步":"创建账户")+" ",1),K.value?(p(),f("i",da)):_("",!0)]),_:1},8,["disabled"])):_("",!0),G.value?(p(),x(ge,{key:1,type:"primary",loading:D.value,onClick:he},{default:i(()=>[...l[111]||(l[111]=[c(" 保存修改 ",-1)])]),_:1},8,["loading"])):_("",!0)])]),default:i(()=>[!G.value&&K.value?(p(),f("div",Vl,[e("div",{class:z(["step",{active:$.value>=1,done:$.value>1}])},[...l[56]||(l[56]=[e("div",{class:"step-num"},"1",-1),e("span",null,"基本信息",-1)])],2),l[58]||(l[58]=e("div",{class:"step-line"},null,-1)),e("div",{class:z(["step",{active:$.value>=2}])},[...l[57]||(l[57]=[e("div",{class:"step-num"},"2",-1),e("span",null,"授权认证",-1)])],2)])):_("",!0),$.value===1&&!G.value?(p(),f("div",Al,[e("div",Cl,[l[62]||(l[62]=e("h4",{class:"section-title"},"选择平台",-1)),e("div",wl,[(p(),f(W,null,te(S,n=>e("div",{key:n.key,class:z(["platform-group-card",{selected:U.value===n.key}]),onClick:Y=>O(n.key)},[e("div",{class:"card-icon",style:de({background:n.gradient})},[e("i",{class:z(n.icon)},null,2)],4),e("div",$l,[e("h5",null,g(n.name),1),e("p",null,g(n.desc),1)]),U.value===n.key?(p(),f("div",zl,[...l[59]||(l[59]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],10,xl)),64))]),U.value?(p(),f("div",Il,[l[61]||(l[61]=e("p",{class:"subplatform-label"},"选择具体平台类型：",-1)),e("div",Ul,[(p(!0),f(W,null,te(E.value,n=>(p(),f("label",{key:n.value,class:z(["subplatform-card",{selected:a.type===n.value}])},[Te(e("input",{"onUpdate:modelValue":l[0]||(l[0]=Y=>a.type=Y),type:"radio",value:n.value,class:"sr-only"},null,8,Tl),[[Oe,a.type]]),e("div",{class:"sub-icon",style:de({background:n.color})},[e("i",{class:z(n.icon)},null,2)],4),e("div",Sl,[e("span",Ml,g(n.label),1),e("span",Ol,g(n.desc),1)]),a.type===n.value?(p(),f("div",Pl,[...l[60]||(l[60]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2))),128))])])):_("",!0)]),d.value?(p(),f("div",Kl,[l[81]||(l[81]=e("h4",{class:"section-title"},"添加方式",-1)),e("div",Gl,[a.type==="claude-official"?(p(),f(W,{key:0},[e("div",{class:z(["add-type-card",{selected:a.addType==="cookie"}]),onClick:l[1]||(l[1]=n=>a.addType="cookie")},[l[64]||(l[64]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}},[e("i",{class:"fa-solid fa-cookie"})],-1)),l[65]||(l[65]=e("div",{class:"type-content"},[e("h5",null,"SessionKey 授权"),e("p",null,"使用 Claude.ai 的 sessionKey 自动完成授权")],-1)),a.addType==="cookie"?(p(),f("div",Ll,[...l[63]||(l[63]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2),e("div",{class:z(["add-type-card",{selected:a.addType==="oauth"}]),onClick:l[2]||(l[2]=n=>a.addType="oauth")},[l[67]||(l[67]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"}},[e("i",{class:"fa-solid fa-key"})],-1)),l[68]||(l[68]=e("div",{class:"type-content"},[e("h5",null,"OAuth 手动授权"),e("p",null,"生成授权链接，手动完成授权流程")],-1)),a.addType==="oauth"?(p(),f("div",Dl,[...l[66]||(l[66]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2)],64)):a.type==="openai-responses"?(p(),f(W,{key:1},[e("div",{class:z(["add-type-card",{selected:a.addType==="oauth"}]),onClick:l[3]||(l[3]=n=>a.addType="oauth")},[l[70]||(l[70]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #764ba2 0%, #667eea 100%)"}},[e("i",{class:"fa-solid fa-user-shield"})],-1)),l[71]||(l[71]=e("div",{class:"type-content"},[e("h5",null,"OAuth 授权"),e("p",null,"通过 OAuth 授权访问 ChatGPT 账户")],-1)),a.addType==="oauth"?(p(),f("div",Fl,[...l[69]||(l[69]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2),e("div",{class:z(["add-type-card",{selected:a.addType==="cookie"}]),onClick:l[4]||(l[4]=n=>a.addType="cookie")},[l[73]||(l[73]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},[e("i",{class:"fa-solid fa-cookie"})],-1)),l[74]||(l[74]=e("div",{class:"type-content"},[e("h5",null,"SessionKey 授权"),e("p",null,"使用 ChatGPT 的 SessionKey 直接认证")],-1)),a.addType==="cookie"?(p(),f("div",Rl,[...l[72]||(l[72]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2)],64)):a.type==="gemini"?(p(),f(W,{key:2},[e("div",{class:z(["add-type-card",{selected:a.addType==="apikey"}]),onClick:l[5]||(l[5]=n=>a.addType="apikey")},[l[76]||(l[76]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}},[e("i",{class:"fa-solid fa-key"})],-1)),l[77]||(l[77]=e("div",{class:"type-content"},[e("h5",null,"API Key"),e("p",null,"使用 Gemini API Key 直接连接")],-1)),a.addType==="apikey"?(p(),f("div",Bl,[...l[75]||(l[75]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2),e("div",{class:z(["add-type-card",{selected:a.addType==="oauth"}]),onClick:l[6]||(l[6]=n=>a.addType="oauth")},[l[79]||(l[79]=e("div",{class:"type-icon",style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"}},[e("i",{class:"fa-solid fa-user-shield"})],-1)),l[80]||(l[80]=e("div",{class:"type-content"},[e("h5",null,"OAuth 授权"),e("p",null,"通过 Google OAuth 授权访问")],-1)),a.addType==="oauth"?(p(),f("div",Wl,[...l[78]||(l[78]=[e("i",{class:"fa-solid fa-check"},null,-1)])])):_("",!0)],2)],64)):_("",!0)])])):_("",!0),e("div",ql,[l[82]||(l[82]=e("h4",{class:"section-title"},"基本信息",-1)),t(X,{model:a,rules:A,ref_key:"formRef",ref:I,"label-position":"top"},{default:i(()=>[t(m,{label:"账户名称",prop:"name"},{default:i(()=>[t(y,{modelValue:a.name,"onUpdate:modelValue":l[7]||(l[7]=n=>a.name=n),placeholder:"为账户设置一个易识别的名称"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述（可选）"},{default:i(()=>[t(y,{modelValue:a.description,"onUpdate:modelValue":l[8]||(l[8]=n=>a.description=n),type:"textarea",rows:2,placeholder:"账户用途说明..."},null,8,["modelValue"])]),_:1}),t(q,{gutter:16},{default:i(()=>[t(v,{span:6},{default:i(()=>[t(m,{label:"账户类型"},{default:i(()=>[t(o,{modelValue:a.accountType,"onUpdate:modelValue":l[9]||(l[9]=n=>a.accountType=n),style:{width:"100%"}},{default:i(()=>[t(s,{label:"共享账户",value:"shared"}),t(s,{label:"专属账户",value:"dedicated"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"优先级"},{default:i(()=>[t(b,{modelValue:a.priority,"onUpdate:modelValue":l[10]||(l[10]=n=>a.priority=n),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"最大并发"},{default:i(()=>[t(b,{modelValue:a.max_concurrency,"onUpdate:modelValue":l[11]||(l[11]=n=>a.max_concurrency=n),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"每日预算($)"},{default:i(()=>[t(b,{modelValue:a.daily_budget,"onUpdate:modelValue":l[12]||(l[12]=n=>a.daily_budget=n),min:0,max:1e4,precision:2,step:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(q,{gutter:20},{default:i(()=>[t(v,{span:6},{default:i(()=>[t(m,{label:"启用"},{default:i(()=>[t(w,{modelValue:a.enabled,"onUpdate:modelValue":l[13]||(l[13]=n=>a.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),F.value?(p(),f("div",Nl,[e("h4",jl,g(M.value),1),a.type==="claude-console"?(p(),x(X,{key:0,model:a,"label-position":"top"},{default:i(()=>[t(m,{label:"API URL",required:""},{default:i(()=>[t(y,{modelValue:a.api_url,"onUpdate:modelValue":l[14]||(l[14]=n=>a.api_url=n),placeholder:"例如：https://api.anthropic.com"},null,8,["modelValue"])]),_:1}),t(m,{label:"API Key",required:""},{default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[15]||(l[15]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"sk-ant-api03-..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):_("",!0),a.type==="bedrock"?(p(),x(X,{key:1,model:a,"label-position":"top"},{default:i(()=>[t(m,{label:"AWS Access Key ID",required:""},{default:i(()=>[t(y,{modelValue:a.aws_access_key_id,"onUpdate:modelValue":l[16]||(l[16]=n=>a.aws_access_key_id=n),placeholder:"请输入 AWS Access Key ID"},null,8,["modelValue"])]),_:1}),t(m,{label:"AWS Secret Access Key",required:""},{default:i(()=>[t(y,{modelValue:a.aws_secret_access_key,"onUpdate:modelValue":l[17]||(l[17]=n=>a.aws_secret_access_key=n),type:"password","show-password":"",placeholder:"请输入 AWS Secret Access Key"},null,8,["modelValue"])]),_:1}),t(m,{label:"AWS Region",required:""},{default:i(()=>[t(o,{modelValue:a.aws_region,"onUpdate:modelValue":l[18]||(l[18]=n=>a.aws_region=n),placeholder:"选择 AWS 区域",style:{width:"100%"}},{default:i(()=>[t(s,{label:"us-east-1 (美国东部)",value:"us-east-1"}),t(s,{label:"us-west-2 (美国西部)",value:"us-west-2"}),t(s,{label:"eu-west-1 (欧洲爱尔兰)",value:"eu-west-1"}),t(s,{label:"ap-northeast-1 (东京)",value:"ap-northeast-1"}),t(s,{label:"ap-southeast-1 (新加坡)",value:"ap-southeast-1"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])):_("",!0),a.type==="openai"&&a.addType==="apikey"?(p(),x(X,{key:2,model:a,"label-position":"top"},{default:i(()=>[t(m,{required:""},{label:i(()=>[...l[83]||(l[83]=[e("span",{class:"label-with-icon"},[e("i",{class:"fa-solid fa-key text-green-500"}),c(" API Key ")],-1)])]),default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[19]||(l[19]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"sk-..."},null,8,["modelValue"]),l[84]||(l[84]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 在 "),e("a",{href:"https://platform.openai.com/api-keys",target:"_blank"},"OpenAI Platform"),c(" 获取 API Key ")],-1))]),_:1}),t(m,{label:"组织 ID（可选）"},{default:i(()=>[t(y,{modelValue:a.organization_id,"onUpdate:modelValue":l[20]||(l[20]=n=>a.organization_id=n),placeholder:"org-..."},null,8,["modelValue"])]),_:1}),t(m,{label:"API Base URL（可选）"},{default:i(()=>[t(y,{modelValue:a.api_url,"onUpdate:modelValue":l[21]||(l[21]=n=>a.api_url=n),placeholder:"默认: https://api.openai.com/v1"},null,8,["modelValue"]),l[85]||(l[85]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 如果使用代理或自定义端点，请填写完整 URL ")],-1))]),_:1})]),_:1},8,["model"])):_("",!0),a.type==="openai-responses"&&a.addType==="cookie"?(p(),f(W,{key:3},[t(X,{model:a,"label-position":"top"},{default:i(()=>[t(m,{required:""},{label:i(()=>[...l[86]||(l[86]=[e("span",{class:"label-with-icon"},[e("i",{class:"fa-solid fa-cookie text-orange-500"}),c(" SessionKey (Access Token) ")],-1)])]),default:i(()=>[t(y,{modelValue:a.session_key,"onUpdate:modelValue":l[22]||(l[22]=n=>a.session_key=n),type:"password","show-password":"",placeholder:"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(B,{type:"info",closable:!1,class:"session-key-help"},{title:i(()=>[...l[87]||(l[87]=[e("i",{class:"fa-solid fa-lightbulb"},null,-1),c(" 如何获取 SessionKey ",-1)])]),default:i(()=>[l[88]||(l[88]=e("ol",{class:"help-steps"},[e("li",null,[c("在浏览器中登录 "),e("a",{href:"https://chatgpt.com",target:"_blank"},"chatgpt.com")]),e("li",null,[c("按 "),e("kbd",null,"F12"),c(" 打开开发者工具，切换到 "),e("strong",null,"Network"),c(" 标签")]),e("li",null,[c("刷新页面，找到任意 API 请求（如 "),e("code",null,"conversations"),c("）")]),e("li",null,[c("在请求头中找到 "),e("strong",null,"Authorization: Bearer xxx")]),e("li",null,[c("复制 "),e("strong",null,"Bearer"),c(" 后面的完整 token")])],-1)),l[89]||(l[89]=e("p",{class:"help-note"},[e("i",{class:"fa-solid fa-info-circle"}),c(" SessionKey 通常以 "),e("code",null,"eyJhbGciOiJSUzI1NiI"),c(" 开头，有效期约 7 天 ")],-1))]),_:1})],64)):_("",!0),a.type==="azure-openai"?(p(),x(X,{key:4,model:a,"label-position":"top"},{default:i(()=>[t(m,{label:"Azure Endpoint",required:""},{default:i(()=>[t(y,{modelValue:a.azure_endpoint,"onUpdate:modelValue":l[23]||(l[23]=n=>a.azure_endpoint=n),placeholder:"https://your-resource.openai.azure.com"},null,8,["modelValue"])]),_:1}),t(m,{label:"API Key",required:""},{default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[24]||(l[24]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"Azure API Key"},null,8,["modelValue"])]),_:1}),t(m,{label:"部署名称",required:""},{default:i(()=>[t(y,{modelValue:a.azure_deployment_name,"onUpdate:modelValue":l[25]||(l[25]=n=>a.azure_deployment_name=n),placeholder:"gpt-4"},null,8,["modelValue"])]),_:1}),t(m,{label:"API 版本"},{default:i(()=>[t(y,{modelValue:a.azure_api_version,"onUpdate:modelValue":l[26]||(l[26]=n=>a.azure_api_version=n),placeholder:"2024-02-01"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):_("",!0),a.type==="gemini"&&a.addType==="apikey"?(p(),x(X,{key:5,model:a,"label-position":"top"},{default:i(()=>[t(m,{required:""},{label:i(()=>[...l[90]||(l[90]=[e("span",{class:"label-with-icon"},[e("i",{class:"fa-solid fa-key text-blue-500"}),c(" API Key ")],-1)])]),default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[27]||(l[27]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"Gemini API Key"},null,8,["modelValue"]),l[91]||(l[91]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 在 "),e("a",{href:"https://aistudio.google.com/apikey",target:"_blank"},"Google AI Studio"),c(" 获取 API Key ")],-1))]),_:1}),t(m,{label:"API Base URL（可选）"},{default:i(()=>[t(y,{modelValue:a.api_url,"onUpdate:modelValue":l[28]||(l[28]=n=>a.api_url=n),placeholder:"默认: https://generativelanguage.googleapis.com/v1beta"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):_("",!0),a.addType==="manual"?(p(),x(X,{key:6,model:a,"label-position":"top"},{default:i(()=>[t(m,{label:"Access Token",required:""},{default:i(()=>[t(y,{modelValue:a.access_token,"onUpdate:modelValue":l[29]||(l[29]=n=>a.access_token=n),type:"textarea",rows:2,placeholder:"OAuth Access Token"},null,8,["modelValue"])]),_:1}),t(m,{label:"Refresh Token（可选）"},{default:i(()=>[t(y,{modelValue:a.refresh_token,"onUpdate:modelValue":l[30]||(l[30]=n=>a.refresh_token=n),type:"textarea",rows:2,placeholder:"OAuth Refresh Token（用于自动刷新）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):_("",!0)])):_("",!0),e("div",El,[l[93]||(l[93]=e("div",{class:"section-title"},[e("i",{class:"fa-solid fa-robot"}),c(" 模型配置（可选） ")],-1)),t(m,{label:"允许的模型"},{default:i(()=>[t(o,{modelValue:a.allowedModelsList,"onUpdate:modelValue":l[31]||(l[31]=n=>a.allowedModelsList=n),multiple:"",filterable:"","allow-create":"","default-first-option":"",loading:oe.value,placeholder:"留空表示允许所有模型",style:{width:"100%"}},{default:i(()=>[(p(!0),f(W,null,te(fe.value,n=>(p(),x(Ae,{key:n.platform,label:n.platform},{default:i(()=>[(p(!0),f(W,null,te(n.models,Y=>(p(),x(s,{key:Y,label:Y,value:Y},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","loading"]),l[92]||(l[92]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空表示允许所有模型，可手动输入自定义模型名 ")],-1))]),_:1})]),e("div",Jl,[l[95]||(l[95]=e("h4",{class:"section-title"},"代理配置",-1)),t(m,{label:"选择代理"},{default:i(()=>[t(o,{modelValue:a.proxy_id,"onUpdate:modelValue":l[32]||(l[32]=n=>a.proxy_id=n),clearable:"",placeholder:"选择代理（留空直连）",style:{width:"100%"},loading:ne.value},{default:i(()=>[(p(!0),f(W,null,te(H.value,n=>(p(),x(s,{key:n.id,label:`${n.name} (${n.type}://${n.host}:${n.port})`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),l[94]||(l[94]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空表示直连，选择代理后将通过该代理访问目标服务 ")],-1))]),_:1})])])):_("",!0),$.value===2?(p(),f("div",Hl,[t(hl,{platform:a.type,proxy:pe.value,"auth-mode":a.addType,onSuccess:V,onBack:l[33]||(l[33]=n=>$.value=1)},null,8,["platform","proxy","auth-mode"])])):_("",!0),G.value?(p(),f("div",Xl,[e("div",Zl,[e("div",{class:"type-badge",style:de({background:xe(a.type)})},[e("i",{class:z(we(a.type))},null,2)],4),e("span",null,g(Ce(a.type)),1)]),t(X,{model:a,rules:A,ref_key:"formRef",ref:I,"label-position":"top"},{default:i(()=>[t(m,{label:"账户名称",prop:"name"},{default:i(()=>[t(y,{modelValue:a.name,"onUpdate:modelValue":l[34]||(l[34]=n=>a.name=n),placeholder:"账户名称"},null,8,["modelValue"])]),_:1}),t(m,{label:"描述（可选）"},{default:i(()=>[t(y,{modelValue:a.description,"onUpdate:modelValue":l[35]||(l[35]=n=>a.description=n),type:"textarea",rows:2,placeholder:"账户用途说明..."},null,8,["modelValue"])]),_:1}),t(q,{gutter:16},{default:i(()=>[t(v,{span:6},{default:i(()=>[t(m,{label:"优先级"},{default:i(()=>[t(b,{modelValue:a.priority,"onUpdate:modelValue":l[36]||(l[36]=n=>a.priority=n),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"权重"},{default:i(()=>[t(b,{modelValue:a.weight,"onUpdate:modelValue":l[37]||(l[37]=n=>a.weight=n),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"最大并发"},{default:i(()=>[t(b,{modelValue:a.max_concurrency,"onUpdate:modelValue":l[38]||(l[38]=n=>a.max_concurrency=n),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:6},{default:i(()=>[t(m,{label:"启用"},{default:i(()=>[t(w,{modelValue:a.enabled,"onUpdate:modelValue":l[39]||(l[39]=n=>a.enabled=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),ae.value?(p(),f("div",Ql,[l[98]||(l[98]=e("h4",{class:"section-title"},"API 配置",-1)),t(m,{label:"API URL"},{default:i(()=>[t(y,{modelValue:a.api_url,"onUpdate:modelValue":l[40]||(l[40]=n=>a.api_url=n),placeholder:"API Base URL"},null,8,["modelValue"]),l[96]||(l[96]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空使用默认地址 ")],-1))]),_:1}),t(m,{label:"API Key"},{default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[41]||(l[41]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"API Key"},null,8,["modelValue"]),l[97]||(l[97]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空保持原有 Key 不变 ")],-1))]),_:1})])):_("",!0),a.type==="bedrock"?(p(),f("div",Yl,[l[99]||(l[99]=e("h4",{class:"section-title"},"AWS Bedrock 配置",-1)),t(m,{label:"AWS Access Key ID"},{default:i(()=>[t(y,{modelValue:a.aws_access_key_id,"onUpdate:modelValue":l[42]||(l[42]=n=>a.aws_access_key_id=n),placeholder:"请输入 AWS Access Key ID"},null,8,["modelValue"])]),_:1}),t(m,{label:"AWS Secret Access Key"},{default:i(()=>[t(y,{modelValue:a.aws_secret_access_key,"onUpdate:modelValue":l[43]||(l[43]=n=>a.aws_secret_access_key=n),type:"password","show-password":"",placeholder:"请输入 AWS Secret Access Key（留空保持不变）"},null,8,["modelValue"])]),_:1}),t(m,{label:"AWS Region"},{default:i(()=>[t(o,{modelValue:a.aws_region,"onUpdate:modelValue":l[44]||(l[44]=n=>a.aws_region=n),placeholder:"选择 AWS 区域",style:{width:"100%"}},{default:i(()=>[t(s,{label:"us-east-1 (美国东部)",value:"us-east-1"}),t(s,{label:"us-west-2 (美国西部)",value:"us-west-2"}),t(s,{label:"eu-west-1 (欧洲爱尔兰)",value:"eu-west-1"}),t(s,{label:"ap-northeast-1 (东京)",value:"ap-northeast-1"}),t(s,{label:"ap-southeast-1 (新加坡)",value:"ap-southeast-1"})]),_:1},8,["modelValue"])]),_:1})])):_("",!0),a.type==="azure-openai"?(p(),f("div",ea,[l[100]||(l[100]=e("h4",{class:"section-title"},"Azure OpenAI 配置",-1)),t(m,{label:"Azure Endpoint"},{default:i(()=>[t(y,{modelValue:a.azure_endpoint,"onUpdate:modelValue":l[45]||(l[45]=n=>a.azure_endpoint=n),placeholder:"https://your-resource.openai.azure.com"},null,8,["modelValue"])]),_:1}),t(m,{label:"API Key"},{default:i(()=>[t(y,{modelValue:a.api_key,"onUpdate:modelValue":l[46]||(l[46]=n=>a.api_key=n),type:"password","show-password":"",placeholder:"Azure API Key（留空保持不变）"},null,8,["modelValue"])]),_:1}),t(m,{label:"部署名称"},{default:i(()=>[t(y,{modelValue:a.azure_deployment_name,"onUpdate:modelValue":l[47]||(l[47]=n=>a.azure_deployment_name=n),placeholder:"gpt-4"},null,8,["modelValue"])]),_:1}),t(m,{label:"API 版本"},{default:i(()=>[t(y,{modelValue:a.azure_api_version,"onUpdate:modelValue":l[48]||(l[48]=n=>a.azure_api_version=n),placeholder:"2024-02-01"},null,8,["modelValue"])]),_:1})])):_("",!0),a.type==="openai-responses"?(p(),f("div",la,[l[103]||(l[103]=e("h4",{class:"section-title"},"ChatGPT 官方配置",-1)),t(m,{label:"Base URL"},{default:i(()=>[t(y,{modelValue:a.api_url,"onUpdate:modelValue":l[49]||(l[49]=n=>a.api_url=n),placeholder:"默认: https://chatgpt.com/backend-api/codex"},null,8,["modelValue"]),l[101]||(l[101]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空使用默认地址 ")],-1))]),_:1}),t(m,{label:"SessionKey (Access Token)"},{default:i(()=>[t(y,{modelValue:a.session_key,"onUpdate:modelValue":l[50]||(l[50]=n=>a.session_key=n),type:"password","show-password":"",placeholder:"eyJhbGciOiJSUzI1NiI...（留空保持不变）"},null,8,["modelValue"]),l[102]||(l[102]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空保持原有 SessionKey 不变 ")],-1))]),_:1}),t(m,{label:"Organization ID（可选）"},{default:i(()=>[t(y,{modelValue:a.organization_id,"onUpdate:modelValue":l[51]||(l[51]=n=>a.organization_id=n),placeholder:"org-..."},null,8,["modelValue"])]),_:1})])):_("",!0),e("div",aa,[l[107]||(l[107]=e("div",{class:"section-title"},[e("i",{class:"fa-solid fa-robot"}),c(" 模型配置 ")],-1)),t(m,{label:"允许的模型"},{default:i(()=>[t(o,{modelValue:a.allowedModelsList,"onUpdate:modelValue":l[52]||(l[52]=n=>a.allowedModelsList=n),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或输入允许使用的模型",style:{width:"100%"}},{default:i(()=>[(p(!0),f(W,null,te(fe.value,n=>(p(),x(Ae,{key:n.platform,label:n.platform},{default:i(()=>[(p(!0),f(W,null,te(n.models,Y=>(p(),x(s,{key:Y,label:Y,value:Y},null,8,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),l[104]||(l[104]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空表示允许所有模型，可手动输入自定义模型名 ")],-1))]),_:1}),t(m,{label:"模型映射（可选）"},{default:i(()=>[t(o,{modelValue:a.selectedMappingIds,"onUpdate:modelValue":l[53]||(l[53]=n=>a.selectedMappingIds=n),multiple:"",filterable:"",loading:re.value,placeholder:"选择要应用的模型映射规则",style:{width:"100%"}},{default:i(()=>[(p(!0),f(W,null,te(Q.value,n=>(p(),x(s,{key:n.id,label:`${n.source_model} → ${n.target_model}`,value:n.id},{default:i(()=>[e("div",ta,[e("span",sa,g(n.source_model),1),l[105]||(l[105]=e("span",{class:"mapping-arrow-inline"},"→",-1)),e("span",oa,g(n.target_model),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),l[106]||(l[106]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 从全局模型映射中选择要应用的规则，将请求的模型名映射到实际使用的模型 ")],-1))]),_:1})]),e("div",na,[l[109]||(l[109]=e("h4",{class:"section-title"},"代理配置",-1)),t(m,{label:"选择代理"},{default:i(()=>[t(o,{modelValue:a.proxy_id,"onUpdate:modelValue":l[54]||(l[54]=n=>a.proxy_id=n),clearable:"",placeholder:"选择代理（留空直连）",style:{width:"100%"},loading:ne.value},{default:i(()=>[(p(!0),f(W,null,te(H.value,n=>(p(),x(s,{key:n.id,label:`${n.name} (${n.type}://${n.host}:${n.port})`,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),l[108]||(l[108]=e("div",{class:"input-tip"},[e("i",{class:"fa-solid fa-info-circle"}),c(" 留空表示直连，选择代理后将通过该代理访问目标服务 ")],-1))]),_:1})])]),_:1},8,["model"])])):_("",!0)]),_:1},8,["modelValue","title"])}}},ra=Ue(ua,[["__scopeId","data-v-cf521839"]]),pa={class:"accounts-page"},ca={class:"page-header"},fa={class:"header-actions"},ma={class:"platform-stats"},ya=["onClick"],va={class:"stat-info"},_a={class:"stat-numbers"},ga={class:"total"},ba={class:"valid"},ka={class:"filter-bar"},ha={class:"filter-left"},Va={class:"filter-right"},Aa={class:"row-index"},Ca={class:"account-cell"},wa={class:"account-info"},xa={class:"account-name"},$a={class:"account-type"},za={key:0,class:"status-detail rate-limit-reset"},Ia={key:1,class:"status-detail next-check"},Ua={key:2,class:"status-detail suspended-count"},Ta={key:0,class:"usage-bars"},Sa={key:0,class:"usage-bar-item"},Ma={class:"usage-bar-label"},Oa={class:"label-value"},Pa={class:"usage-bar-track"},Ka={key:1,class:"usage-bar-item"},Ga={class:"usage-bar-label"},La={class:"label-value"},Da={class:"usage-bar-track"},Fa={key:2,class:"usage-bar-item"},Ra={class:"usage-bar-label"},Ba={class:"label-value"},Wa={class:"usage-bar-track"},qa={key:1,class:"usage-bars"},Na={class:"usage-bar-item"},ja={class:"usage-bar-label"},Ea={class:"label-value"},Ja={class:"usage-bar-track"},Ha={class:"usage-stat-row"},Xa={class:"stat-label"},Za={class:"stat-label"},Qa={key:2,class:"usage-stats"},Ya={class:"usage-stat-item"},et={class:"usage-stat-item"},lt={class:"usage-stat-item"},at={key:3,class:"no-usage"},tt={class:"concurrency-cell"},st={class:"concurrency-max"},ot={class:"request-count"},nt={key:0,class:"total-cost"},it={key:1,class:"no-cost"},dt={class:"today-usage"},ut={class:"usage-tokens"},rt={class:"usage-count"},pt={key:0,class:"last-used"},ct={key:1,class:"no-used"},ft={key:1,class:"no-proxy"},mt={class:"table-footer"},yt={key:0,class:"selection-info"},vt={__name:"Accounts",setup(se){const ue=C(!1),k=C([]),J=C([]),P=C(!1),G=C(null),I=C([]),$=C([]),D=C([]),U=Ie({page:1,pageSize:20,total:0}),S=Ie({platform:"",status:"",search:""}),R=[{key:"claude",name:"Claude",icon:"fa-solid fa-brain",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",types:["claude-official","claude-console","bedrock"]},{key:"openai",name:"OpenAI",icon:"fa-solid fa-robot",gradient:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",types:["openai","openai-responses","azure-openai"]},{key:"gemini",name:"Gemini",icon:"fa-brands fa-google",gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",types:["gemini"]}],E={"claude-official":{label:"Claude Official",icon:"fa-solid fa-key",color:"#667eea",platform:"Claude"},"claude-console":{label:"Claude Console",icon:"fa-solid fa-terminal",color:"#764ba2",platform:"Claude"},bedrock:{label:"AWS Bedrock",icon:"fa-brands fa-aws",color:"#ff9900",platform:"Claude"},openai:{label:"OpenAI 三方 API",icon:"fa-solid fa-bolt",color:"#11998e",platform:"OpenAI"},"openai-responses":{label:"ChatGPT 官方",icon:"fa-solid fa-comments",color:"#38ef7d",platform:"OpenAI"},"azure-openai":{label:"Azure OpenAI",icon:"fa-brands fa-microsoft",color:"#0078d4",platform:"OpenAI"},gemini:{label:"Gemini",icon:"fa-brands fa-google",color:"#4facfe",platform:"Gemini"}},Z=N(()=>R.map(s=>{const o=k.value.filter(v=>s.types.includes(v.type));return{...s,count:o.length,validCount:o.filter(v=>v.status==="valid"&&v.enabled).length}}));function oe(s,o=null){var b;const v=((b=E[s])==null?void 0:b.label)||s;if(!o)return v;if(s==="claude-official"){const q=o.access_token,w=o.session_key;return q&&w?"OAuth + SK":q?"OAuth":w?"SessionKey":o.api_key?"API Key":"Claude Official"}if(s==="openai"){if(o.base_url)try{const w=new URL(o.base_url).hostname.replace("www.","");return w.includes("openrouter")?"OpenRouter":w.includes("together")?"Together AI":w.includes("groq")?"Groq":w.includes("deepseek")?"DeepSeek":w.includes("moonshot")||w.includes("kimi")?"Moonshot":w.includes("zhipu")||w.includes("bigmodel")?"ZhipuAI":w.includes("baichuan")?"Baichuan":w.includes("minimax")?"MiniMax":w.includes("yi.")||w.includes("lingyiwanwu")?"零一万物":w.includes("siliconflow")?"SiliconFlow":w.split(".")[0]}catch{return"三方 API"}return o.api_key?"API Key":"OpenAI"}if(s==="openai-responses")return o.access_token&&o.refresh_token?"ChatGPT OAuth":o.access_token?"ChatGPT Token":"ChatGPT";if(s==="azure-openai"){if(o.azure_endpoint)try{const w=new URL(o.azure_endpoint).hostname.split(".");if(w.length>0)return`Azure: ${w[0]}`}catch{}return"Azure OpenAI"}return s==="gemini"?o.access_token?"Gemini OAuth":"Gemini":s==="gemini-api"?"Gemini API":s==="bedrock"?o.aws_region?`Bedrock: ${o.aws_region}`:"AWS Bedrock":v}function H(s){var o;return((o=E[s])==null?void 0:o.icon)||"fa-solid fa-circle"}function ne(s){var o;return((o=E[s])==null?void 0:o.color)||"#999"}function Q(s){var o;return((o=E[s])==null?void 0:o.platform)||"Unknown"}function re(s){var v;const o=(v=E[s])==null?void 0:v.platform;return o==="Claude"?"fa-solid fa-brain":o==="OpenAI"?"fa-solid fa-robot":o==="Gemini"?"fa-brands fa-google":"fa-solid fa-circle"}function fe(s){var v,b;return((b=(v=E[s])==null?void 0:v.platform)==null?void 0:b.toLowerCase())||"unknown"}function pe(s){var o;return((o=R.find(v=>v.key===s))==null?void 0:o.name)||s}function me(s){return{valid:"正常",invalid:"无效",rate_limited:"限流中",overloaded:"过载",token_expired:"Token过期",suspended:"疑似封号",banned:"已封号",disabled:"已禁用"}[s]||s}function ye(s){return s.five_hour_utilization!==null&&s.five_hour_utilization!==void 0||s.seven_day_utilization!==null&&s.seven_day_utilization!==void 0||s.seven_day_sonnet_utilization!==null&&s.seven_day_sonnet_utilization!==void 0}function ce(s){return s>=90?"danger":s>=70?"warning":"normal"}function ve(s){const o=s.current_concurrency||0,v=s.max_concurrency||5;return o>=v?"danger":o>=v*.8?"warning":"normal"}function a(s){return s?s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString():"0"}function A(s){return s?s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString():"0"}function d(s){return s?s>=1e3?(s/1e3).toFixed(2)+"K":s>=1?s.toFixed(2):s>=.01?s.toFixed(3):s.toFixed(4):"0.00"}function F(s){if(!s)return"-";const o=new Date(s),b=Math.floor((new Date-o)/1e3);return b<60?"刚刚":b<3600?Math.floor(b/60)+" 分钟前":b<86400?Math.floor(b/3600)+" 小时前":b<604800?Math.floor(b/86400)+" 天前":o.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function M(s){if(!s)return"";const o=new Date(s),b=Math.floor((o-new Date)/1e3);if(b<=0)return"即将恢复";if(b<60)return b+" 秒后恢复";if(b<3600)return Math.floor(b/60)+" 分钟后恢复";if(b<86400){const q=Math.floor(b/3600),w=Math.floor(b%3600/60);return q+"时"+w+"分后恢复"}return o.toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})+" 恢复"}function K(s){if(!s)return"";const o=new Date(s),b=Math.floor((o-new Date)/1e3);return b<=0?"待检测":b<60?b+" 秒后":b<3600?Math.floor(b/60)+" 分钟后":Math.floor(b/3600)+" 小时后"}function ae(s){return["claude-official","openai-responses","gemini"].includes(s.type)}function L(s){return["invalid","rate_limited","token_expired","suspended","banned","disabled"].includes(s.status)}function O(s){return s.type==="claude-official"&&s.session_key}function ee(s){S.platform===s?S.platform="":S.platform=s,V()}let ie=null;function _e(){clearTimeout(ie),ie=setTimeout(()=>{V()},300)}async function V(){ue.value=!0;try{const s={page:U.page,page_size:U.pageSize,status:S.status,search:S.search};if(S.platform){const v=R.find(b=>b.key===S.platform);v&&(s.types=v.types.join(","))}const o=await j.getAccounts(s);k.value=o.data.items||[],U.total=o.data.total||0}catch(s){console.error("Failed to load accounts:",s)}finally{ue.value=!1}}function ke(s){J.value=s.map(o=>o.id)}async function he(s){try{await j.updateAccount(s.id,{enabled:s.enabled}),T.success("更新成功")}catch{s.enabled=!s.enabled,T.error("更新失败")}}function Ve(s){G.value={...s},P.value=!0}async function Ce(s){try{await j.deleteAccount(s),T.success("删除成功"),V()}catch{T.error("删除失败")}}async function we(s){I.value.push(s.id);try{const o=await j.checkAccountHealth(s.id),v=o.data||o;v.healthy?T.success(`[${s.name}] ${v.message}`):T.warning(`[${s.name}] ${v.message}`),V()}catch{T.error("检测失败")}finally{I.value=I.value.filter(o=>o!==s.id)}}async function xe(s){$.value.push(s.id);try{await j.recoverAccount(s.id),T.success(`[${s.name}] 账号已强制恢复`),V()}catch{T.error("恢复失败")}finally{$.value=$.value.filter(o=>o!==s.id)}}async function r(s){D.value.push(s.id);try{await j.refreshAccountToken(s.id),T.success(`[${s.name}] Token 刷新成功`),V()}catch{T.error("Token 刷新失败")}finally{D.value=D.value.filter(o=>o!==s.id)}}async function l(){if(J.value.length!==0)try{await Ge.confirm(`确定要删除选中的 ${J.value.length} 个账户吗？`,"批量删除",{type:"warning"});for(const s of J.value)await j.deleteAccount(s);T.success("批量删除成功"),J.value=[],V()}catch(s){s!=="cancel"&&T.error("批量删除失败")}}function y(){P.value=!1,G.value=null,V()}function m(s){s||(G.value=null)}return Pe(()=>{V()}),(s,o)=>{const v=h("el-button"),b=h("el-option"),q=h("el-select"),w=h("el-input"),X=h("el-tag"),B=h("el-table-column"),Ae=h("el-tooltip"),ge=h("el-switch"),$e=h("el-popconfirm"),n=h("el-table"),Y=h("el-pagination"),Se=h("el-card"),Me=Ke("loading");return p(),f("div",pa,[e("div",ca,[o[9]||(o[9]=e("div",{class:"header-left"},[e("h2",null,"账户管理"),e("p",{class:"header-desc"},"管理 Claude、Gemini、OpenAI 等账户与代理配置")],-1)),e("div",fa,[t(v,{onClick:V},{default:i(()=>[e("i",{class:z(["fa-solid fa-sync-alt",{"fa-spin":ue.value}])},null,2),o[7]||(o[7]=c(" 刷新 ",-1))]),_:1}),t(v,{type:"primary",onClick:o[0]||(o[0]=u=>P.value=!0)},{default:i(()=>[...o[8]||(o[8]=[e("i",{class:"fa-solid fa-plus"},null,-1),c(" 添加账户 ",-1)])]),_:1})])]),e("div",ma,[(p(!0),f(W,null,te(Z.value,u=>(p(),f("div",{key:u.key,class:z(["stat-card",{active:S.platform===u.key}]),onClick:le=>ee(u.key)},[e("div",{class:"stat-icon",style:de({background:u.gradient})},[e("i",{class:z(u.icon)},null,2)],4),e("div",va,[e("h3",null,g(u.name),1),e("div",_a,[e("span",ga,g(u.count)+" 个账户",1),e("span",ba,[o[10]||(o[10]=e("i",{class:"fa-solid fa-circle valid-dot"},null,-1)),c(" "+g(u.validCount)+" 可用 ",1)])])])],10,ya))),128))]),e("div",ka,[e("div",ha,[t(q,{modelValue:S.status,"onUpdate:modelValue":o[1]||(o[1]=u=>S.status=u),clearable:"",placeholder:"状态筛选",onChange:V},{default:i(()=>[t(b,{label:"正常",value:"valid"}),t(b,{label:"无效",value:"invalid"}),t(b,{label:"限流中",value:"rate_limited"}),t(b,{label:"Token过期",value:"token_expired"}),t(b,{label:"疑似封号",value:"suspended"}),t(b,{label:"已封号",value:"banned"}),t(b,{label:"已禁用",value:"disabled"})]),_:1},8,["modelValue"]),t(w,{modelValue:S.search,"onUpdate:modelValue":o[2]||(o[2]=u=>S.search=u),placeholder:"搜索账户名称...",clearable:"",style:{width:"200px"},onInput:_e},{prefix:i(()=>[...o[11]||(o[11]=[e("i",{class:"fa-solid fa-search"},null,-1)])]),_:1},8,["modelValue"])]),e("div",Va,[S.platform?(p(),x(X,{key:0,closable:"",onClose:o[3]||(o[3]=u=>{S.platform="",V()})},{default:i(()=>[c(g(pe(S.platform)),1)]),_:1})):_("",!0)])]),t(Se,{class:"accounts-table-card",shadow:"never"},{default:i(()=>[Te((p(),x(n,{data:k.value,stripe:"",onSelectionChange:ke},{default:i(()=>[t(B,{type:"selection",width:"50"}),t(B,{label:"#",width:"60",align:"center"},{default:i(({$index:u})=>[e("span",Aa,g((U.page-1)*U.pageSize+u+1),1)]),_:1}),t(B,{label:"账户","min-width":"200"},{default:i(({row:u})=>[e("div",Ca,[e("div",{class:"account-avatar",style:de({background:ne(u.type)})},[e("i",{class:z(H(u.type))},null,2)],4),e("div",wa,[e("span",xa,g(u.name),1),e("span",$a,g(oe(u.type,u)),1)])])]),_:1}),t(B,{label:"平台/类型",width:"180"},{default:i(({row:u})=>[e("div",{class:z(["platform-badge",fe(u.type)])},[e("i",{class:z(re(u.type))},null,2),e("span",null,g(Q(u.type)),1)],2)]),_:1}),t(B,{label:"状态",width:"180"},{default:i(({row:u})=>[e("div",{class:z(["status-badge",u.status])},[o[12]||(o[12]=e("span",{class:"status-dot"},null,-1)),c(" "+g(me(u.status)),1)],2),u.status==="rate_limited"&&u.rate_limit_reset_at?(p(),f("div",za,[o[13]||(o[13]=e("i",{class:"fa-solid fa-clock"},null,-1)),c(" "+g(M(u.rate_limit_reset_at)),1)])):_("",!0),u.next_health_check_at&&["rate_limited","suspended","banned","token_expired"].includes(u.status)?(p(),f("div",Ia,[o[14]||(o[14]=e("i",{class:"fa-solid fa-stethoscope"},null,-1)),c(" 下次检测: "+g(K(u.next_health_check_at)),1)])):_("",!0),u.status==="suspended"&&u.suspended_count>0?(p(),f("div",Ua,[o[15]||(o[15]=e("i",{class:"fa-solid fa-triangle-exclamation"},null,-1)),c(" 连续失败 "+g(u.suspended_count)+" 次 ",1)])):_("",!0),u.last_error&&["invalid","suspended","banned","token_expired"].includes(u.status)?(p(),x(Ae,{key:3,content:u.last_error,placement:"top"},{default:i(()=>[...o[16]||(o[16]=[e("div",{class:"status-detail error-hint"},[e("i",{class:"fa-solid fa-circle-info"}),c(" 查看错误 ")],-1)])]),_:1},8,["content"])):_("",!0)]),_:1}),t(B,{label:"用量",width:"180"},{default:i(({row:u})=>[u.type==="claude-official"&&ye(u)?(p(),f("div",Ta,[u.five_hour_utilization!==null&&u.five_hour_utilization!==void 0?(p(),f("div",Sa,[e("div",Ma,[o[17]||(o[17]=e("span",{class:"label-text"},"5H",-1)),e("span",Oa,g(u.five_hour_utilization.toFixed(1))+"%",1)]),e("div",Pa,[e("div",{class:z(["usage-bar-fill",ce(u.five_hour_utilization)]),style:de({width:Math.min(u.five_hour_utilization,100)+"%"})},null,6)])])):_("",!0),u.seven_day_utilization!==null&&u.seven_day_utilization!==void 0?(p(),f("div",Ka,[e("div",Ga,[o[18]||(o[18]=e("span",{class:"label-text"},"7D",-1)),e("span",La,g(u.seven_day_utilization.toFixed(1))+"%",1)]),e("div",Da,[e("div",{class:z(["usage-bar-fill",ce(u.seven_day_utilization)]),style:de({width:Math.min(u.seven_day_utilization,100)+"%"})},null,6)])])):_("",!0),u.seven_day_sonnet_utilization!==null&&u.seven_day_sonnet_utilization!==void 0?(p(),f("div",Fa,[e("div",Ra,[o[19]||(o[19]=e("span",{class:"label-text"},"7D-S",-1)),e("span",Ba,g(u.seven_day_sonnet_utilization.toFixed(1))+"%",1)]),e("div",Wa,[e("div",{class:z(["usage-bar-fill",ce(u.seven_day_sonnet_utilization)]),style:de({width:Math.min(u.seven_day_sonnet_utilization,100)+"%"})},null,6)])])):_("",!0)])):u.daily_budget>0?(p(),f("div",qa,[e("div",Na,[e("div",ja,[o[20]||(o[20]=e("span",{class:"label-text"},"今日",-1)),e("span",Ea,"$"+g(d(u.today_cost||0))+" / $"+g(d(u.daily_budget)),1)]),e("div",Ja,[e("div",{class:z(["usage-bar-fill",ce(u.budget_utilization||0)]),style:de({width:Math.min(u.budget_utilization||0,100)+"%"})},null,6)])]),e("div",Ha,[e("span",Xa,[o[21]||(o[21]=e("i",{class:"fa-solid fa-coins"},null,-1)),c(" "+g(A(u.today_tokens)),1)]),e("span",Za,[o[22]||(o[22]=e("i",{class:"fa-solid fa-arrow-right-arrow-left"},null,-1)),c(" "+g(u.today_count)+" 次",1)])])])):u.today_tokens>0||u.today_count>0?(p(),f("div",Qa,[e("div",Ya,[o[23]||(o[23]=e("i",{class:"fa-solid fa-dollar-sign"},null,-1)),e("span",null,"$"+g(d(u.today_cost||0)),1)]),e("div",et,[o[24]||(o[24]=e("i",{class:"fa-solid fa-coins"},null,-1)),e("span",null,g(A(u.today_tokens)),1)]),e("div",lt,[o[25]||(o[25]=e("i",{class:"fa-solid fa-arrow-right-arrow-left"},null,-1)),e("span",null,g(u.today_count)+" 次",1)])])):(p(),f("span",at,"-"))]),_:1}),t(B,{label:"启用",width:"80",align:"center"},{default:i(({row:u})=>[t(ge,{modelValue:u.enabled,"onUpdate:modelValue":le=>u.enabled=le,size:"small",onChange:le=>he(u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(B,{label:"优先级",width:"90",align:"center"},{default:i(({row:u})=>[t(X,{size:"small",type:"info"},{default:i(()=>[c(g(u.priority),1)]),_:2},1024)]),_:1}),t(B,{label:"并发",width:"100",align:"center"},{default:i(({row:u})=>[e("div",tt,[e("span",{class:z(["concurrency-current",ve(u)])},g(u.current_concurrency||0),3),o[26]||(o[26]=e("span",{class:"concurrency-separator"},"/",-1)),e("span",st,g(u.max_concurrency||5),1)])]),_:1}),t(B,{label:"请求次数",width:"100",align:"right"},{default:i(({row:u})=>[e("span",ot,g(a(u.request_count)),1)]),_:1}),t(B,{label:"总费用",width:"110",align:"right"},{default:i(({row:u})=>[u.total_cost>0?(p(),f("span",nt," $"+g(d(u.total_cost)),1)):(p(),f("span",it,"-"))]),_:1}),t(B,{label:"今日用量",width:"140",align:"right"},{default:i(({row:u})=>[e("div",dt,[e("span",ut,g(A(u.today_tokens)),1),e("span",rt,g(u.today_count||0)+" 次",1)])]),_:1}),t(B,{label:"最后使用",width:"150"},{default:i(({row:u})=>[u.last_used_at?(p(),f("span",pt,g(F(u.last_used_at)),1)):(p(),f("span",ct,"-"))]),_:1}),t(B,{label:"代理",width:"120"},{default:i(({row:u})=>{var le;return[(le=u.proxy)!=null&&le.enabled?(p(),x(X,{key:0,size:"small",type:"warning"},{default:i(()=>[o[27]||(o[27]=e("i",{class:"fa-solid fa-shield-halved"},null,-1)),c(" "+g(u.proxy.type),1)]),_:2},1024)):(p(),f("span",ft,"-"))]}),_:1}),t(B,{label:"操作",width:"260",fixed:"right"},{default:i(({row:u})=>[t(v,{link:"",type:"primary",size:"small",onClick:le=>Ve(u)},{default:i(()=>[...o[28]||(o[28]=[e("i",{class:"fa-solid fa-edit"},null,-1),c(" 编辑 ",-1)])]),_:1},8,["onClick"]),ae(u)?(p(),x(v,{key:0,link:"",type:"info",size:"small",loading:I.value.includes(u.id),onClick:le=>we(u)},{default:i(()=>[...o[29]||(o[29]=[e("i",{class:"fa-solid fa-stethoscope"},null,-1),c(" 检测 ",-1)])]),_:1},8,["loading","onClick"])):_("",!0),L(u)?(p(),x(v,{key:1,link:"",type:"success",size:"small",loading:$.value.includes(u.id),onClick:le=>xe(u)},{default:i(()=>[...o[30]||(o[30]=[e("i",{class:"fa-solid fa-rotate"},null,-1),c(" 恢复 ",-1)])]),_:1},8,["loading","onClick"])):_("",!0),O(u)?(p(),x(v,{key:2,link:"",type:"warning",size:"small",loading:D.value.includes(u.id),onClick:le=>r(u)},{default:i(()=>[...o[31]||(o[31]=[e("i",{class:"fa-solid fa-key"},null,-1),c(" 刷新Token ",-1)])]),_:1},8,["loading","onClick"])):_("",!0),t($e,{title:"确定删除该账户吗？","confirm-button-text":"删除","cancel-button-text":"取消",onConfirm:le=>Ce(u.id)},{reference:i(()=>[t(v,{link:"",type:"danger",size:"small"},{default:i(()=>[...o[32]||(o[32]=[e("i",{class:"fa-solid fa-trash"},null,-1),c(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Me,ue.value]]),e("div",mt,[J.value.length>0?(p(),f("div",yt,[c(" 已选择 "+g(J.value.length)+" 项 ",1),t(v,{link:"",type:"danger",onClick:l},{default:i(()=>[...o[33]||(o[33]=[c("批量删除",-1)])]),_:1})])):_("",!0),t(Y,{"current-page":U.page,"onUpdate:currentPage":o[4]||(o[4]=u=>U.page=u),"page-size":U.pageSize,"onUpdate:pageSize":o[5]||(o[5]=u=>U.pageSize=u),total:U.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:V},null,8,["current-page","page-size","total"])])]),_:1}),t(ra,{modelValue:P.value,"onUpdate:modelValue":[o[6]||(o[6]=u=>P.value=u),m],"edit-data":G.value,onSuccess:y},null,8,["modelValue","edit-data"])])}}},gt=Ue(vt,[["__scopeId","data-v-23239f45"]]);export{gt as default};
