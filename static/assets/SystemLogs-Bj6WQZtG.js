import{_ as Oe,r as f,o as je,b as o,d as s,e as i,f as a,w as n,h as c,i as U,M as qe,n as p,q as S,v as Ke,B as Pe,R as $e,J as pe,k as L,l as m,F as P,H as Q,S as Ae,t as d,T as Ie,D as T,m as Ge,U as He,E as M,V as me,N as Je}from"./index-BW7LrRP4.js";const We={class:"system-logs-page"},Qe={class:"page-header"},Xe={class:"header-actions"},Ze={class:"card-header"},el={class:"filter-bar"},ll={class:"file-name"},tl={class:"card-header"},al={key:0,class:"file-info"},sl={class:"filename"},nl={key:1},ol={key:2,class:"header-tools"},il={class:"log-content"},ul={key:0,class:"empty-tip"},dl={key:1,class:"empty-tip"},rl=["onClick"],cl={class:"log-main-line"},_l={class:"log-time"},fl={key:0,class:"log-module"},pl={key:1,class:"log-request-id"},ml={class:"log-message"},vl={key:2,class:"inline-fields"},gl={key:0,class:"inline-field user-id"},kl={key:1,class:"inline-field account-id"},hl={key:2,class:"inline-field api-key"},yl={key:3,class:"inline-field model"},wl={key:4,class:"inline-field client-ip"},bl={key:6,class:"inline-field latency"},Cl={key:3,class:"expand-indicator"},zl={key:0,class:"log-fields"},xl={class:"fields-grid"},Vl={class:"field-key"},Fl={key:0,class:"log-field caller-field"},Sl={class:"field-value caller-value"},Ll={key:1,class:"log-raw"},Nl={key:0,class:"pagination-wrap"},Dl={__name:"SystemLogs",setup(Rl){const g=f("app"),Y=f([]),$=f([]),B=f(!1),N=f(""),D=f(""),v=f(""),x=f([]),w=f([]),k=f({}),O=f(!1),j=f(!1),b=f(1),A=f(200),R=f(""),q=f(!1),C=f(null),h=f([]),I=f(!0);function ve(){Y.value=[],$.value=[],v.value="",x.value=[],w.value=[],k.value={},N.value="",D.value="",b.value=1,R.value="",q.value=!1,h.value=[],V()}async function V(){var l,e;B.value=!0;try{const u={source:g.value};N.value&&(u.category=N.value),D.value&&g.value==="app"&&(u.date=D.value);const r=await U.getSystemLogFiles(u);Y.value=((l=r.data)==null?void 0:l.files)||[],$.value=((e=r.data)==null?void 0:e.categories)||[]}catch(u){console.error("Failed to load files:",u)}finally{B.value=!1}}function X(l){v.value=l.name,b.value=1,R.value="",h.value=[],F()}function ge({row:l}){return l.name===v.value?"selected-row":""}async function F(){var l,e,u,r,y;if(v.value){O.value=!0,h.value=[];try{const _=await U.readSystemLog({file:v.value,source:g.value,page:b.value,page_size:A.value,keyword:R.value,reverse:q.value?"true":""});x.value=((l=_.data)==null?void 0:l.lines)||[],w.value=((e=_.data)==null?void 0:e.entries)||[],k.value={size_human:(u=_.data)==null?void 0:u.size_human,total_lines:(r=_.data)==null?void 0:r.total_lines,total_pages:(y=_.data)==null?void 0:y.total_pages},me(()=>{C.value&&(C.value.scrollTop=0)})}catch(_){console.error("Failed to load log content:",_),M.error("åŠ è½½æ—¥å¿—å¤±è´¥: "+(_.message||"æœªçŸ¥é”™è¯¯"))}finally{O.value=!1}}}async function Z(){var l,e,u,r,y;if(v.value){j.value=!0,h.value=[];try{const _=await U.tailSystemLog({file:v.value,source:g.value,lines:200});x.value=((l=_.data)==null?void 0:l.lines)||[],w.value=((e=_.data)==null?void 0:e.entries)||[],k.value={size_human:(u=_.data)==null?void 0:u.size_human,total_lines:(r=_.data)==null?void 0:r.count,total_pages:1},b.value=1,me(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)}),M.success("å·²åŠ è½½æœ€æ–° "+(((y=_.data)==null?void 0:y.count)||0)+" è¡Œæ—¥å¿—")}catch(_){console.error("Failed to tail log:",_),M.error("åŠ è½½å®žæ—¶æ—¥å¿—å¤±è´¥: "+(_.message||"æœªçŸ¥é”™è¯¯"))}finally{j.value=!1}}}function ke(l){A.value=l,b.value=1,F()}function he(l,e){switch(l){case"view":X(e);break;case"tail":v.value=e.name,Z();break;case"download":window.open(U.downloadSystemLog(e.name,g.value),"_blank");break;case"delete":g.value==="app"?ye(e.name):M.warning("æœåŠ¡å™¨æ—¥å¿—ä¸å…è®¸åˆ é™¤");break}}async function ye(l){try{await Je.confirm(`ç¡®å®šè¦åˆ é™¤æ—¥å¿—æ–‡ä»¶ "${l}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,"åˆ é™¤ç¡®è®¤",{type:"warning"}),await U.deleteSystemLog(l,g.value),M.success("åˆ é™¤æˆåŠŸ"),v.value===l&&(v.value="",x.value=[],w.value=[],k.value={}),V()}catch(e){e!=="cancel"&&console.error("Failed to delete file:",e)}}function ee(l){if(!l)return"";const e=l.toUpperCase();return e==="ERROR"||e==="FATAL"?"level-error":e==="WARN"||e==="WARNING"?"level-warn":e==="DEBUG"?"level-debug":"level-info"}function we(l){if(!l)return"";try{return new Date(l).toLocaleString("zh-CN",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return l}}function le(l){return l.fields&&Object.keys(l.fields).length>0||l.caller}function be(l){return l.fields?["user_id","account_id","api_key_id","model","client_ip","status","latency"].some(u=>l.fields[u]!==void 0):!1}function G(l){return I.value?!h.value.includes(l):h.value.includes(l)}function Ce(l){const e=h.value.indexOf(l);e>-1?h.value.splice(e,1):h.value.push(l)}function ze(l){return l>=500?"status-error":l>=400?"status-warn":l>=200&&l<300?"status-success":"status-info"}function xe(l){return l==null?"":l>=1e3?(l/1e3).toFixed(2)+"s":l+"ms"}function Ve(l){if(!l)return{};const e=["user_id","api_key_id","account_id","account_name","model","client_ip","method","path","status","latency","input_tokens","output_tokens","cache_creation_tokens","cache_read_tokens","total_tokens","input_cost","output_cost","cache_create_cost","cache_read_cost","total_cost","price_rate","package_id","package_type","request_size","response_size","host","protocol","user_agent","content_type","attempts","max_retries","exec_duration","total_duration","session_id","error"],u={};for(const r of e)l[r]!==void 0&&(u[r]=l[r]);for(const r of Object.keys(l))u[r]===void 0&&(u[r]=l[r]);return u}function Fe(l){return["user_id","api_key_id","account_id"].includes(l)?"field-id":["input_tokens","output_tokens","total_tokens","cache_creation_tokens","cache_read_tokens"].includes(l)?"field-token":["input_cost","output_cost","total_cost","cache_create_cost","cache_read_cost"].includes(l)?"field-cost":["latency","exec_duration","total_duration"].includes(l)?"field-duration":l==="error"?"field-error":l==="client_ip"?"field-ip":l==="model"?"field-model":""}function Se(l,e){if(l==="status"){if(e>=500)return"value-error";if(e>=400)return"value-warn";if(e>=200&&e<300)return"value-success"}return l==="error"?"value-error":""}function Le(l,e){return e==null?"-":["input_cost","output_cost","total_cost","cache_create_cost","cache_read_cost"].includes(l)?"$"+Number(e).toFixed(6):["latency","exec_duration","total_duration"].includes(l)?typeof e=="string"&&e.includes("ms")||typeof e=="string"&&e.includes("s")?e:typeof e=="number"?e>=1e3?(e/1e3).toFixed(2)+"s":e+"ms":e:["input_tokens","output_tokens","total_tokens","cache_creation_tokens","cache_read_tokens"].includes(l)?Number(e).toLocaleString():typeof e=="object"?JSON.stringify(e,null,2):String(e)}return je(()=>{V()}),(l,e)=>{const u=c("el-icon"),r=c("el-button"),y=c("el-tab-pane"),_=c("el-tabs"),H=c("el-tag"),Ne=c("el-option"),De=c("el-select"),Re=c("el-date-picker"),J=c("el-table-column"),K=c("el-dropdown-item"),Ee=c("el-dropdown-menu"),Ue=c("el-dropdown"),Te=c("el-table"),te=c("el-card"),ae=c("el-col"),Me=c("el-input"),se=c("el-checkbox"),ne=c("el-empty"),Ye=c("el-pagination"),Be=c("el-row"),oe=qe("loading");return s(),o("div",We,[i("div",Qe,[e[8]||(e[8]=i("h2",null,"ç³»ç»Ÿæ—¥å¿—",-1)),i("div",Xe,[a(r,{onClick:V,loading:B.value},{default:n(()=>[a(u,null,{default:n(()=>[a(S(Ke))]),_:1}),e[7]||(e[7]=p(" åˆ·æ–° ",-1))]),_:1},8,["loading"])])]),a(_,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),onTabChange:ve,class:"log-tabs"},{default:n(()=>[a(y,{label:"åº”ç”¨æ—¥å¿—",name:"app"},{label:n(()=>[i("span",null,[a(u,null,{default:n(()=>[a(S(Pe))]),_:1}),e[9]||(e[9]=p(" åº”ç”¨æ—¥å¿—",-1))])]),_:1}),a(y,{label:"æœåŠ¡å™¨æ—¥å¿—",name:"server"},{label:n(()=>[i("span",null,[a(u,null,{default:n(()=>[a(S($e))]),_:1}),e[10]||(e[10]=p(" æœåŠ¡å™¨æ—¥å¿—",-1))])]),_:1})]),_:1},8,["modelValue"]),a(Be,{gutter:20},{default:n(()=>[a(ae,{span:8},{default:n(()=>[a(te,{class:"file-list-card"},{header:n(()=>[i("div",Ze,[i("span",null,d(g.value==="app"?"åº”ç”¨æ—¥å¿—æ–‡ä»¶":"æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶"),1),a(H,{size:"small"},{default:n(()=>[p(d(Y.value.length)+" ä¸ªæ–‡ä»¶",1)]),_:1})])]),default:n(()=>[i("div",el,[a(De,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),placeholder:"é€‰æ‹©åˆ†ç±»",clearable:"",size:"small",onChange:V},{default:n(()=>[(s(!0),o(P,null,Q($.value,t=>(s(),L(Ne,{key:t.name,label:`${t.label} (${t.count})`,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),g.value==="app"?(s(),L(Re,{key:0,modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=t=>D.value=t),type:"date",placeholder:"é€‰æ‹©æ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",size:"small",clearable:"",onChange:V,style:{width:"140px","margin-left":"10px"}},null,8,["modelValue"])):m("",!0)]),pe((s(),L(Te,{data:Y.value,stripe:"",size:"small","highlight-current-row":"",onRowClick:X,"row-class-name":ge,"max-height":"500"},{default:n(()=>[a(J,{prop:"name",label:"æ–‡ä»¶å","min-width":"180","show-overflow-tooltip":""},{default:n(({row:t})=>[i("div",ll,[a(u,null,{default:n(()=>[a(S(Ae))]),_:1}),i("span",null,d(t.name),1)])]),_:1}),a(J,{prop:"size_human",label:"å¤§å°",width:"80"}),a(J,{label:"æ“ä½œ",width:"80"},{default:n(({row:t})=>[a(Ue,{onCommand:z=>he(z,t)},{dropdown:n(()=>[a(Ee,null,{default:n(()=>[a(K,{command:"view"},{default:n(()=>[...e[11]||(e[11]=[p("æŸ¥çœ‹",-1)])]),_:1}),a(K,{command:"tail"},{default:n(()=>[...e[12]||(e[12]=[p("å®žæ—¶",-1)])]),_:1}),a(K,{command:"download"},{default:n(()=>[...e[13]||(e[13]=[p("ä¸‹è½½",-1)])]),_:1}),g.value==="app"?(s(),L(K,{key:0,command:"delete",divided:""},{default:n(()=>[...e[14]||(e[14]=[p("åˆ é™¤",-1)])]),_:1})):m("",!0)]),_:1})]),default:n(()=>[a(r,{type:"primary",link:"",size:"small"},{default:n(()=>[a(u,null,{default:n(()=>[a(S(Ie))]),_:1})]),_:1})]),_:1},8,["onCommand"])]),_:1})]),_:1},8,["data"])),[[oe,B.value]])]),_:1})]),_:1}),a(ae,{span:16},{default:n(()=>[a(te,{class:"log-content-card"},{header:n(()=>[i("div",tl,[v.value?(s(),o("div",al,[i("span",sl,d(v.value),1),k.value.size_human?(s(),L(H,{key:0,size:"small",type:"info"},{default:n(()=>[p(d(k.value.size_human),1)]),_:1})):m("",!0),k.value.total_lines?(s(),L(H,{key:1,size:"small",type:"success"},{default:n(()=>[p(d(k.value.total_lines)+" è¡Œ",1)]),_:1})):m("",!0)])):(s(),o("span",nl,"è¯·é€‰æ‹©æ—¥å¿—æ–‡ä»¶")),v.value?(s(),o("div",ol,[a(Me,{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t),placeholder:"æœç´¢å…³é”®è¯",size:"small",clearable:"",style:{width:"150px","margin-right":"10px"},onKeyup:Ge(F,["enter"])},null,8,["modelValue"]),a(se,{modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=t=>q.value=t),size:"small",onChange:F},{default:n(()=>[...e[15]||(e[15]=[p("å€’åº",-1)])]),_:1},8,["modelValue"]),a(se,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=t=>I.value=t),size:"small",style:{"margin-left":"10px"}},{default:n(()=>[...e[16]||(e[16]=[p("å±•å¼€è¯¦æƒ…",-1)])]),_:1},8,["modelValue"]),a(r,{size:"small",onClick:F,loading:O.value,style:{"margin-left":"10px"}},{default:n(()=>[...e[17]||(e[17]=[p(" æŸ¥è¯¢ ",-1)])]),_:1},8,["loading"]),a(r,{size:"small",type:"success",onClick:Z,loading:j.value},{default:n(()=>[a(u,null,{default:n(()=>[a(S(He))]),_:1}),e[18]||(e[18]=p(" å®žæ—¶ ",-1))]),_:1},8,["loading"])])):m("",!0)])]),default:n(()=>[pe((s(),o("div",il,[v.value?w.value.length===0&&x.value.length===0?(s(),o("div",dl,[a(ne,{description:"æ²¡æœ‰æ—¥å¿—å†…å®¹"})])):g.value==="app"&&w.value.length>0?(s(),o("div",{key:2,class:"log-entries",ref_key:"logPreRef",ref:C},[(s(!0),o(P,null,Q(w.value,(t,z)=>{var ie,ue,de,re,ce,_e,fe;return s(),o("div",{key:z,class:T(["log-entry",ee(t.level),{expanded:G(z)}]),onClick:W=>Ce(z)},[t.is_json?(s(),o(P,{key:0},[i("div",cl,[i("span",_l,d(we(t.timestamp)),1),i("span",{class:T(["log-level",ee(t.level)])},d(t.level),3),t.module?(s(),o("span",fl,"["+d(t.module)+"]",1)):m("",!0),t.request_id?(s(),o("span",pl,d(t.request_id),1)):m("",!0),i("span",ml,d(t.message),1),be(t)?(s(),o("span",vl,[(ie=t.fields)!=null&&ie.user_id?(s(),o("span",gl,[e[19]||(e[19]=i("span",{class:"field-icon"},"ðŸ‘¤",-1)),p(d(t.fields.user_id),1)])):m("",!0),(ue=t.fields)!=null&&ue.account_id?(s(),o("span",kl,[e[20]||(e[20]=i("span",{class:"field-icon"},"ðŸ”‘",-1)),p(d(t.fields.account_id),1)])):m("",!0),(de=t.fields)!=null&&de.api_key_id?(s(),o("span",hl,[e[21]||(e[21]=i("span",{class:"field-icon"},"ðŸŽ«",-1)),p(d(t.fields.api_key_id),1)])):m("",!0),(re=t.fields)!=null&&re.model?(s(),o("span",yl,[e[22]||(e[22]=i("span",{class:"field-icon"},"ðŸ¤–",-1)),p(d(t.fields.model),1)])):m("",!0),(ce=t.fields)!=null&&ce.client_ip?(s(),o("span",wl,[e[23]||(e[23]=i("span",{class:"field-icon"},"ðŸŒ",-1)),p(d(t.fields.client_ip),1)])):m("",!0),(_e=t.fields)!=null&&_e.status?(s(),o("span",{key:5,class:T(["inline-field",ze(t.fields.status)])},d(t.fields.status),3)):m("",!0),((fe=t.fields)==null?void 0:fe.latency)!==void 0?(s(),o("span",bl,d(xe(t.fields.latency)),1)):m("",!0)])):m("",!0),le(t)?(s(),o("span",Cl,d(G(z)?"â–¼":"â–¶"),1)):m("",!0)]),G(z)&&le(t)?(s(),o("div",zl,[i("div",xl,[(s(!0),o(P,null,Q(Ve(t.fields),(W,E)=>(s(),o("div",{key:E,class:T(["log-field",Fe(E)])},[i("span",Vl,d(E)+":",1),i("span",{class:T(["field-value",Se(E,W)])},d(Le(E,W)),3)],2))),128)),t.caller?(s(),o("div",Fl,[e[24]||(e[24]=i("span",{class:"field-key"},"caller:",-1)),i("span",Sl,d(t.caller),1)])):m("",!0)])])):m("",!0)],64)):(s(),o("span",Ll,d(t.raw),1))],10,rl)}),128))],512)):(s(),o("pre",{key:3,class:"log-pre",ref_key:"logPreRef",ref:C},d(x.value.join(`
`)),513)):(s(),o("div",ul,[a(ne,{description:"è¯·ä»Žå·¦ä¾§é€‰æ‹©è¦æŸ¥çœ‹çš„æ—¥å¿—æ–‡ä»¶"})]))])),[[oe,O.value||j.value]]),k.value.total_pages>1?(s(),o("div",Nl,[a(Ye,{"current-page":b.value,"onUpdate:currentPage":e[6]||(e[6]=t=>b.value=t),"page-size":A.value,total:k.value.total_lines,"page-sizes":[100,200,500,1e3],layout:"total, sizes, prev, pager, next",onCurrentChange:F,onSizeChange:ke},null,8,["current-page","page-size","total"])])):m("",!0)]),_:1})]),_:1})]),_:1})])}}},Ul=Oe(Dl,[["__scopeId","data-v-54307f70"]]);export{Ul as default};
