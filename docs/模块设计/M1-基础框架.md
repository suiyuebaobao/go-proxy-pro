# M1 基础框架模块设计

> 创建时间：2024-12-08
> 状态：已完成

---

## 1. 模块概述

### 1.1 目标
搭建项目骨架，实现基础用户认证系统，为后续模块提供基础设施支持。

### 1.2 核心功能
- 项目基础结构搭建
- 用户认证系统（JWT）
- 数据库连接（MySQL + Redis）
- 基础中间件（CORS、日志、错误恢复）
- 前端基础框架

---

## 2. 数据模型

### 2.1 用户表 (users)

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    role VARCHAR(20) DEFAULT 'user',        -- admin / user
    status VARCHAR(20) DEFAULT 'active',    -- active / disabled
    balance DECIMAL(10,4) DEFAULT 0,        -- 用户余额
    price_rate DECIMAL(5,2) DEFAULT 1.0,    -- 价格倍率 (0=免费, 1=原价, 1.5=1.5倍)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    INDEX idx_username (username),
    INDEX idx_status (status),
    INDEX idx_role (role)
);
```

### 2.2 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键，自增 |
| username | VARCHAR(50) | 用户名，唯一 |
| password | VARCHAR(255) | 密码，bcrypt加密存储 |
| email | VARCHAR(100) | 邮箱，可选 |
| role | VARCHAR(20) | 角色：admin（管理员）、user（普通用户）|
| status | VARCHAR(20) | 状态：active（正常）、disabled（禁用）|
| balance | DECIMAL(10,4) | 用户余额（美元） |
| price_rate | DECIMAL(5,2) | 价格倍率，0表示免费 |

---

## 3. API 接口

### 3.1 认证接口

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/auth/login | 用户登录 |
| POST | /api/auth/register | 用户注册 |

### 3.2 用户管理接口（管理员）

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/admin/users | 获取用户列表（分页）|
| GET | /api/admin/users/:id | 获取用户详情 |
| POST | /api/admin/users | 创建用户 |
| PUT | /api/admin/users/:id | 更新用户 |
| DELETE | /api/admin/users/:id | 删除用户 |
| POST | /api/admin/users/batch-rate | 批量设置价格倍率 |

### 3.3 个人设置接口

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/profile | 获取个人信息 |
| PUT | /api/profile | 更新个人信息 |
| PUT | /api/profile/password | 修改密码 |

---

## 4. 目录结构

```
go-aiproxy/
├── cmd/
│   └── server/
│       └── main.go              # 程序入口
├── configs/
│   └── config.yaml              # 配置文件
├── internal/
│   ├── config/
│   │   └── config.go            # 配置加载
│   ├── handler/
│   │   ├── auth.go              # 认证处理器
│   │   └── user.go              # 用户管理处理器
│   ├── middleware/
│   │   ├── cors.go              # CORS中间件
│   │   ├── jwt.go               # JWT验证中间件
│   │   └── logger.go            # 请求日志中间件
│   ├── model/
│   │   └── user.go              # 用户模型
│   ├── repository/
│   │   └── user.go              # 用户数据访问
│   └── router/
│       └── router.go            # 路由配置
├── pkg/
│   ├── database/
│   │   ├── mysql.go             # MySQL连接
│   │   └── redis.go             # Redis连接
│   ├── jwt/
│   │   └── jwt.go               # JWT工具
│   └── response/
│       └── response.go          # 统一响应格式
└── web/                         # 前端项目
    └── src/
        ├── views/
        │   ├── Login.vue        # 登录页面
        │   └── Users.vue        # 用户管理页面
        ├── stores/
        │   └── user.js          # 用户状态管理
        └── api/
            └── index.js         # API封装
```

---

## 5. 技术选型

### 5.1 后端
- **框架**: Gin (高性能HTTP框架)
- **ORM**: GORM (Go ORM库)
- **数据库**: MySQL 8.0
- **缓存**: Redis 6.x
- **认证**: JWT (JSON Web Token)

### 5.2 前端
- **框架**: Vue 3 + Composition API
- **UI组件**: Element Plus
- **状态管理**: Pinia
- **HTTP客户端**: Alova
- **构建工具**: Vite

---

## 6. 完成清单

- [x] 初始化 Go 项目结构
- [x] 配置 Gin 框架
- [x] 配置 MySQL + GORM
- [x] 配置 Redis
- [x] users 表 + CRUD
- [x] JWT 登录/验证
- [x] 基础中间件（CORS、Logger、Recovery）
- [x] 前端登录页面
- [x] 前端基础布局框架
- [x] 用户管理页面
- [x] 批量设置价格倍率功能
