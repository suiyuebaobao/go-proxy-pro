# 管理员接口文档 - 日志/缓存/配置管理

## 概述

管理员接口需要 JWT Token 认证且用户角色为 admin。

**认证**: `Authorization: Bearer <jwt_token>`

---

## 一、请求日志

### 1. 获取日志列表

**路径**: `GET /api/admin/logs`

**查询参数**:
| 参数 | 类型 | 说明 |
|------|------|------|
| page | int | 页码 |
| page_size | int | 每页数量 |
| user_id | int | 用户ID |
| api_key_id | int | API Key ID |
| account_id | int | 账户ID |
| model | string | 模型名称 |
| status | string | 状态 |
| start_date | string | 开始日期 |
| end_date | string | 结束日期 |

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "user_id": 1,
        "api_key_id": 1,
        "account_id": 1,
        "model": "claude-sonnet-4-20250514",
        "platform": "claude-official",
        "input_tokens": 1000,
        "output_tokens": 500,
        "cost": 0.02,
        "duration_ms": 1500,
        "status": "success",
        "created_at": "2025-12-15T10:00:00Z"
      }
    ],
    "total": 1000,
    "page": 1
  }
}
```

### 2. 获取日志汇总

**路径**: `GET /api/admin/logs/summary`

### 3. 获取账户负载统计

**路径**: `GET /api/admin/logs/account-load`

### 4. 获取所有用户使用汇总

**路径**: `GET /api/admin/logs/usage-summary`

---

## 二、操作日志

### 1. 获取操作日志列表

**路径**: `GET /api/admin/operation-logs`

**查询参数**:
| 参数 | 类型 | 说明 |
|------|------|------|
| page | int | 页码 |
| page_size | int | 每页数量 |
| user_id | int | 操作用户ID |
| action | string | 操作类型 |
| resource | string | 资源类型 |
| start_date | string | 开始日期 |
| end_date | string | 结束日期 |

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "user_id": 1,
        "username": "admin",
        "action": "create",
        "resource": "account",
        "resource_id": 5,
        "description": "创建账户: test-account",
        "ip": "127.0.0.1",
        "created_at": "2025-12-15T10:00:00Z"
      }
    ],
    "total": 500,
    "page": 1
  }
}
```

### 2. 获取操作统计

**路径**: `GET /api/admin/operation-logs/stats`

### 3. 获取单条操作日志

**路径**: `GET /api/admin/operation-logs/:id`

### 4. 清理旧日志

**路径**: `DELETE /api/admin/operation-logs/cleanup`

**查询参数**: `days` (保留天数)

---

## 三、缓存管理

### 1. 获取缓存统计

**路径**: `GET /api/admin/cache/stats`

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "sessions": 150,
    "users": 50,
    "accounts": 10,
    "unavailable": 2
  }
}
```

### 2. 列出所有会话

**路径**: `GET /api/admin/cache/sessions`

### 3. 移除会话

**路径**: `DELETE /api/admin/cache/sessions/:sessionId`

### 4. 列出账号缓存

**路径**: `GET /api/admin/cache/accounts`

### 5. 列出用户缓存

**路径**: `GET /api/admin/cache/users`

### 6. 列出不可用账户

**路径**: `GET /api/admin/cache/unavailable`

### 7. 按类型清理缓存

**路径**: `POST /api/admin/cache/clear`

**请求参数**:
```json
{
  "type": "sessions"  // sessions, users, accounts, unavailable, all
}
```

### 8. 清理用户缓存

**路径**: `DELETE /api/admin/cache/users/:id`

### 9. 清理 API Key 缓存

**路径**: `DELETE /api/admin/cache/api-keys/:id`

### 10. 获取缓存配置

**路径**: `GET /api/admin/cache/config`

### 11. 更新缓存配置

**路径**: `PUT /api/admin/cache/config`

---

## 四、账户缓存管理

### 1. 清除账户会话

**路径**: `DELETE /api/admin/accounts/:id/cache/sessions`

### 2. 标记账户不可用

**路径**: `POST /api/admin/accounts/:id/cache/unavailable`

**请求参数**:
```json
{
  "duration": 3600,  // 秒
  "reason": "rate limited"
}
```

### 3. 清除不可用标记

**路径**: `DELETE /api/admin/accounts/:id/cache/unavailable`

### 4. 获取并发信息

**路径**: `GET /api/admin/accounts/:id/cache/concurrency`

### 5. 设置并发限制

**路径**: `PUT /api/admin/accounts/:id/cache/concurrency`

**请求参数**:
```json
{
  "limit": 10
}
```

### 6. 重置并发计数

**路径**: `DELETE /api/admin/accounts/:id/cache/concurrency`

---

## 五、系统配置

### 1. 获取所有配置

**路径**: `GET /api/admin/configs`

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "system": {
      "site_name": "AI Proxy",
      "allow_register": true
    },
    "proxy": {
      "timeout": 120,
      "retry_count": 3
    }
  }
}
```

### 2. 获取分类配置

**路径**: `GET /api/admin/configs/category/:category`

### 3. 更新配置

**路径**: `PUT /api/admin/configs`

**请求参数**:
```json
{
  "category": "system",
  "key": "site_name",
  "value": "My AI Proxy"
}
```

### 4. 获取同步状态

**路径**: `GET /api/admin/configs/sync/status`

### 5. 手动触发同步

**路径**: `POST /api/admin/configs/sync/trigger`

---

## 六、代理配置管理

### 1. 获取代理列表

**路径**: `GET /api/admin/proxy-configs`

### 2. 获取启用的代理

**路径**: `GET /api/admin/proxy-configs/enabled`

### 3. 获取默认代理

**路径**: `GET /api/admin/proxy-configs/default`

### 4. 清除默认代理

**路径**: `DELETE /api/admin/proxy-configs/default`

### 5. 创建代理

**路径**: `POST /api/admin/proxy-configs`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 代理名称 |
| type | string | 是 | 类型: http/socks5 |
| host | string | 是 | 主机地址 |
| port | int | 是 | 端口 |
| username | string | 否 | 用户名 |
| password | string | 否 | 密码 |
| enabled | bool | 否 | 是否启用 |

### 6. 测试代理连通性

**路径**: `POST /api/admin/proxy-configs/test`

**请求参数**:
```json
{
  "type": "http",
  "host": "127.0.0.1",
  "port": 7890
}
```

### 7. 获取单个代理

**路径**: `GET /api/admin/proxy-configs/:id`

### 8. 更新代理

**路径**: `PUT /api/admin/proxy-configs/:id`

### 9. 删除代理

**路径**: `DELETE /api/admin/proxy-configs/:id`

### 10. 切换代理启用状态

**路径**: `PUT /api/admin/proxy-configs/:id/toggle`

### 11. 设置为默认代理

**路径**: `PUT /api/admin/proxy-configs/:id/default`
