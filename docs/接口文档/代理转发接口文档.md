# 代理转发接口文档

## 概述

代理转发接口用于调用各种 AI 模型，支持 OpenAI、Claude、Gemini 等平台的格式。

**认证方式**：API Key

```bash
Authorization: Bearer sk-xxxxxxxxxxxx
```

或

```bash
X-API-Key: sk-xxxxxxxxxxxx
```

或（Claude 客户端常用）

```bash
x-api-key: sk-xxxxxxxxxxxx
```

---

## Base URL 配置（推荐）

客户端配置时只需填写 Base URL，客户端会自动拼接后续路径。

| 平台 | Base URL | 完整端点 |
|------|----------|----------|
| Claude | `http://域名/claude/` | `/claude/v1/messages` |
| OpenAI | `http://域名/openai/` | `/openai/v1/chat/completions` |
| Gemini | `http://域名/gemini/` | `/gemini/v1/chat` |

> 说明：本项目的代理接口为上游透传，成功响应体以各平台原始格式为准（不包一层 `code/message`）。

## 支持的平台

| 平台标识 | 说明 |
|---------|------|
| claude-official | Claude 官方 API |
| claude-console | Claude Console |
| claude-ccr | Claude CCR |
| bedrock | AWS Bedrock |
| openai | OpenAI API |
| azure-openai | Azure OpenAI |
| gemini | Google Gemini |
| openai-responses | OpenAI Responses API (Codex) |

---

## 一、OpenAI 兼容接口

**路径**: `POST /openai/v1/chat/completions`

**请求示例**:
```bash
curl http://localhost:8080/openai/v1/chat/completions \
  -H "Authorization: Bearer sk-xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-20250514",
    "messages": [{"role": "user", "content": "Hello!"}],
    "stream": false
  }'
```

**模型格式**:
```json
{"model": "claude-sonnet-4-20250514"}
{"model": "claude-official,claude-sonnet-4-20250514"}
```

**响应示例**:
```json
{
  "id": "chatcmpl-xxx",
  "object": "chat.completion",
  "model": "claude-sonnet-4-20250514",
  "choices": [{
    "index": 0,
    "message": {"role": "assistant", "content": "Hello!"},
    "finish_reason": "stop"
  }],
  "usage": {"prompt_tokens": 10, "completion_tokens": 5, "total_tokens": 15}
}
```

---

## 二、Claude 原生接口

**路径**: `POST /claude/v1/messages`

**请求示例**:
```bash
curl http://localhost:8080/claude/v1/messages \
  -H "Authorization: Bearer sk-xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "claude-sonnet-4-20250514",
    "max_tokens": 1024,
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```

**响应示例**:
```json
{
  "id": "msg_xxx",
  "type": "message",
  "role": "assistant",
  "content": [{"type": "text", "text": "Hello!"}],
  "model": "claude-sonnet-4-20250514",
  "stop_reason": "end_turn",
  "usage": {"input_tokens": 10, "output_tokens": 5}
}
```

---

## 三、Gemini 接口

**路径**: `POST /gemini/v1/chat`

**请求示例**:
```bash
curl http://localhost:8080/gemini/v1/chat \
  -H "Authorization: Bearer sk-xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gemini-2.5-flash",
    "messages": [{"role": "user", "content": "Hello!"}]
  }'
```

---

## 四、OpenAI Responses API (Codex)

**路径**: `POST /responses` 或 `POST /v1/responses`

支持 Claude Code、Codex CLI 等客户端的 Responses API 请求。

**请求示例**:
```bash
curl http://localhost:8080/responses \
  -H "Authorization: Bearer sk-xxxxxxxxxxxx" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-5.1-codex-max",
    "input": "Write a hello world function",
    "stream": true
  }'
```

详细文档请参考：[OpenAI Responses 接口文档](OpenAI-Responses接口文档.md)

---

## 错误码

| 状态码 | 说明 |
|--------|------|
| 401 | API Key 无效/禁用/过期 |
| 403 | 平台/模型无权限 |
| 429 | 请求限流 |
| 502 | 上游 API 错误 |
| 503 | 无可用账户 |
