# 认证接口文档

## 概述

认证接口用于用户登录和注册。

**基础路径**：`/api/auth`

---

## 0. 验证码（如启用）

系统可配置开启验证码与登录频率限制；登录/注册前建议先获取状态。

### 0.1 获取验证码开关状态

**路径**: `GET /api/auth/captcha/status`

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "captcha_enabled": true,
    "login_rate_limit_enabled": true
  }
}
```

### 0.2 获取验证码

**路径**: `GET /api/auth/captcha`

**说明**：
- 当 `captcha_enabled=false` 时，返回空 `captcha_id/image`，可直接登录/注册
- 当 `captcha_enabled=true` 时，`image` 为 base64 图片数据

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "captcha_id": "xxxxxx",
    "image": "data:image/png;base64,......",
    "enabled": true
  }
}
```

---

## 1. 用户登录

**路径**: `POST /api/auth/login`

**认证**: 无需认证

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名 |
| password | string | 是 | 密码 |
| captcha_id | string | 否* | 验证码ID（启用验证码时必填） |
| captcha | string | 否* | 验证码内容（启用验证码时必填） |

**请求示例**:
```json
{
  "username": "admin",
  "password": "admin123",
  "captcha_id": "xxxxxx",
  "captcha": "a1b2"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "admin",
      "status": "active",
      "balance": 100.00,
      "price_rate": 1.0,
      "max_concurrency": 10,
      "created_at": "2025-12-01T00:00:00Z",
      "updated_at": "2025-12-01T00:00:00Z"
    }
  }
}
```

**错误响应**:
```json
{
  "code": 401,
  "message": "invalid username or password"
}
```

---

## 2. 用户注册

**路径**: `POST /api/auth/register`

**认证**: 无需认证

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名（3-50字符） |
| password | string | 是 | 密码（至少6字符） |
| email | string | 否 | 邮箱 |
| captcha_id | string | 否* | 验证码ID（启用验证码时必填） |
| captcha | string | 否* | 验证码内容（启用验证码时必填） |

**请求示例**:
```json
{
  "username": "newuser",
  "password": "password123",
  "email": "user@example.com"
}
```

**响应示例**:
```json
{
  "code": 0,
  "message": "created",
  "data": {
    "id": 2,
    "username": "newuser",
    "email": "user@example.com",
    "role": "user",
    "status": "active",
    "balance": 0,
    "price_rate": 1.0,
    "max_concurrency": 10,
    "created_at": "2025-12-15T10:00:00Z",
    "updated_at": "2025-12-15T10:00:00Z"
  }
}
```

**错误响应**:
```json
{
  "code": 400,
  "message": "username already exists"
}
```

---

## 用户字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int | 用户ID |
| username | string | 用户名 |
| email | string | 邮箱 |
| role | string | 角色：admin/user |
| status | string | 状态：active/disabled |
| balance | float | 余额（美元） |
| price_rate | float | 价格倍率（默认1.0原价，0为免费） |
| max_concurrency | int | 最大并发数 |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |

---

## Token 使用说明

登录成功后返回的 `token` 需要在后续请求中携带：

```bash
Authorization: Bearer <token>
```

Token 有效期默认为 24 小时。
