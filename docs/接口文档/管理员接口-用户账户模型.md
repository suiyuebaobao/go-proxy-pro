# 管理员接口文档 - 用户/账户/模型管理

## 概述

管理员接口需要 JWT Token 认证且用户角色为 admin。

**认证**: `Authorization: Bearer <jwt_token>`

---

## 一、用户管理

### 1. 获取用户列表

**路径**: `GET /api/admin/users`

**查询参数**: `page`, `page_size`

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "items": [
      {
        "id": 1,
        "username": "admin",
        "email": "admin@example.com",
        "role": "admin",
        "status": "active",
        "balance": 100.00,
        "price_rate": 1.0,
        "max_concurrency": 10
      }
    ],
    "total": 50,
    "page": 1
  }
}
```

### 2. 创建用户

**路径**: `POST /api/admin/users`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名 |
| password | string | 是 | 密码 |
| email | string | 否 | 邮箱 |
| role | string | 否 | 角色: admin/user |
| status | string | 否 | 状态: active/disabled |
| price_rate | float | 否 | 价格倍率 |
| max_concurrency | int | 否 | 最大并发数 |

### 3. 获取单个用户

**路径**: `GET /api/admin/users/:id`

### 4. 更新用户

**路径**: `PUT /api/admin/users/:id`

**请求参数**:
| 参数 | 类型 | 说明 |
|------|------|------|
| email | string | 邮箱 |
| role | string | 角色 |
| status | string | 状态 |
| price_rate | float | 价格倍率 |
| max_concurrency | int | 最大并发数 |

### 5. 删除用户

**路径**: `DELETE /api/admin/users/:id`

### 6. 批量更新费率

**路径**: `POST /api/admin/users/batch-price-rate`

**请求参数**:
```json
{
  "user_ids": [1, 2, 3],
  "price_rate": 0.8
}
```

### 7. 全部更新费率

**路径**: `POST /api/admin/users/all-price-rate`

**请求参数**:
```json
{
  "price_rate": 1.0
}
```

### 8. 获取所有用户（不分页）

**路径**: `GET /api/admin/users/all`

### 9. 获取用户使用统计

**路径**: `GET /api/admin/users/:id/usage/summary`

### 10. 获取用户并发信息

**路径**: `GET /api/admin/users/:id/concurrency`

### 11. 重置用户并发

**路径**: `DELETE /api/admin/users/:id/concurrency`

### 12. 管理用户 API Key

- `GET /api/admin/users/:id/api-keys` - 获取用户的 API Key 列表
- `POST /api/admin/users/:id/api-keys` - 为用户创建 API Key
- `DELETE /api/admin/users/:id/api-keys/:keyId` - 删除 API Key
- `PUT /api/admin/users/:id/api-keys/:keyId/toggle` - 切换状态

---

## 二、账户管理

### 1. 获取账户类型

**路径**: `GET /api/admin/accounts/types`

**响应示例**:
```json
{
  "code": 0,
  "message": "success",
  "data": ["claude-official", "claude-console", "openai", "gemini", "bedrock", "azure-openai"]
}
```

### 2. 获取账户列表

**路径**: `GET /api/admin/accounts`

**查询参数**: `page`, `page_size`, `type`, `status`

### 3. 创建账户

**路径**: `POST /api/admin/accounts`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 账户名称 |
| type | string | 是 | 账户类型 |
| enabled | bool | 否 | 是否启用 |
| priority | int | 否 | 优先级 |
| weight | int | 否 | 权重 |
| max_concurrency | int | 否 | 最大并发 |
| api_key | string | 否 | API Key |
| api_secret | string | 否 | API Secret |
| access_token | string | 否 | Access Token |
| refresh_token | string | 否 | Refresh Token |
| region | string | 否 | 区域 (Bedrock/Azure) |
| endpoint | string | 否 | 端点 URL |
| proxy_config_id | int | 否 | 代理配置ID |

### 4. 获取单个账户

**路径**: `GET /api/admin/accounts/:id`

### 5. 更新账户

**路径**: `PUT /api/admin/accounts/:id`

### 6. 删除账户

**路径**: `DELETE /api/admin/accounts/:id`

### 7. 更新账户状态

**路径**: `PUT /api/admin/accounts/:id/status`

**请求参数**:
```json
{
  "status": "valid"  // valid, rate_limited, invalid
}
```

---

## 三、账户分组管理

### 1. 获取分组列表

**路径**: `GET /api/admin/account-groups`

**查询参数**: `page`, `page_size`

### 2. 获取所有分组（不分页）

**路径**: `GET /api/admin/account-groups/all`

### 3. 创建分组

**路径**: `POST /api/admin/account-groups`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| name | string | 是 | 分组名称 |
| description | string | 否 | 描述 |
| platform | string | 否 | 平台类型 |
| is_default | bool | 否 | 是否默认 |

### 4. 获取单个分组

**路径**: `GET /api/admin/account-groups/:id`

### 5. 更新分组

**路径**: `PUT /api/admin/account-groups/:id`

### 6. 删除分组

**路径**: `DELETE /api/admin/account-groups/:id`

### 7. 添加账户到分组

**路径**: `POST /api/admin/account-groups/:id/accounts`

**请求参数**:
```json
{
  "account_id": 1
}
```

### 8. 从分组移除账户

**路径**: `DELETE /api/admin/account-groups/:id/accounts/:accountId`

---

## 四、模型管理

### 1. 获取模型列表

**路径**: `GET /api/admin/models`

**查询参数**: `page`, `page_size`, `platform`, `enabled`

### 2. 获取平台列表

**路径**: `GET /api/admin/models/platforms`

### 3. 创建模型

**路径**: `POST /api/admin/models`

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| model_id | string | 是 | 模型ID |
| model_name | string | 是 | 模型名称 |
| platform | string | 是 | 平台类型 |
| input_price | float | 是 | 输入价格 ($/1M tokens) |
| output_price | float | 是 | 输出价格 ($/1M tokens) |
| cache_creation_price | float | 否 | 缓存创建价格 |
| cache_read_price | float | 否 | 缓存读取价格 |
| enabled | bool | 否 | 是否启用 |

### 4. 获取单个模型

**路径**: `GET /api/admin/models/:id`

### 5. 更新模型

**路径**: `PUT /api/admin/models/:id`

### 6. 删除模型

**路径**: `DELETE /api/admin/models/:id`

### 7. 切换模型启用状态

**路径**: `PUT /api/admin/models/:id/toggle`

### 8. 初始化默认模型

**路径**: `POST /api/admin/models/init-defaults`

### 9. 重置默认模型

**路径**: `POST /api/admin/models/reset-defaults`

---

## 五、OAuth 授权

### 1. 生成授权 URL

**路径**: `POST /api/admin/oauth/generate-url`

**请求参数**:
```json
{
  "type": "claude-console"
}
```

### 2. 交换 Token

**路径**: `POST /api/admin/oauth/exchange`

**请求参数**:
```json
{
  "code": "authorization_code",
  "type": "claude-console"
}
```

### 3. Cookie 授权

**路径**: `POST /api/admin/oauth/cookie-auth`

**请求参数**:
```json
{
  "cookie": "session_cookie_value",
  "type": "claude-console"
}
```

---

## 六、代理测试

**路径**: `POST /api/admin/proxy/test`

**请求参数**:
```json
{
  "account_id": 1,
  "model": "claude-sonnet-4-20250514",
  "message": "Hello"
}
```
