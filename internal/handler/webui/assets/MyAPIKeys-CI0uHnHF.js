import{_ as te,r,o as ae,b as x,d as p,e as i,f as e,w as t,h as s,i as C,E as m,M as oe,n,q as k,O as se,J as ne,k as b,l as D,t as u,a5 as E,Z as ue,a6 as de,F as ie,H as re}from"./index-BdjcZBcD.js";const _e={class:"my-api-keys"},pe={class:"page-header"},ce={class:"key-display"},fe={key:0},me={key:1,class:"text-muted"},ye={class:"usage-stats"},ve={class:"new-key-display"},ge={class:"cost-value"},ke={__name:"MyAPIKeys",setup(be){const w=r(!1),A=r(!1),P=r([]),M=r([]),v=r(!1),K=r(!1),$=r(!1),V=r(""),d=r(null),c=r({name:"",user_package_id:null}),I=o=>o?new Date(o).toLocaleString("zh-CN"):"-",S=o=>o?o>=1e6?(o/1e6).toFixed(2)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString():"0",N=async o=>{try{await navigator.clipboard.writeText(o),m.success("已复制到剪贴板")}catch{m.error("复制失败")}},F=async()=>{w.value=!0;try{const o=await C.getApiKeys();P.value=o.data||[]}catch{m.error("获取 API Key 列表失败")}finally{w.value=!1}},H=async()=>{try{const o=await C.getMyActivePackages();M.value=o.data||[]}catch(o){console.error("Failed to fetch packages:",o)}},J=async()=>{if(!c.value.name){m.warning("请输入名称");return}A.value=!0;try{const o=await C.createApiKey(c.value);o.code===0&&o.data?(V.value=o.data.key_full||o.data.key,v.value=!1,K.value=!0,c.value={name:"",user_package_id:null},F()):m.error(o.message||"创建失败")}catch{m.error("创建失败")}finally{A.value=!1}},O=async o=>{try{await C.deleteApiKey(o),m.success("删除成功"),F()}catch{m.error("删除失败")}},Z=o=>{d.value=o,$.value=!0};return ae(()=>{F(),H()}),(o,l)=>{var L;const g=s("el-icon"),_=s("el-button"),y=s("el-table-column"),z=s("el-tag"),h=s("el-popconfirm"),j=s("el-table"),G=s("el-empty"),Q=s("el-card"),q=s("el-input"),B=s("el-form-item"),R=s("el-option"),W=s("el-select"),X=s("el-form"),U=s("el-dialog"),Y=s("el-alert"),f=s("el-descriptions-item"),ee=s("el-descriptions"),le=oe("loading");return p(),x("div",_e,[i("div",pe,[l[12]||(l[12]=i("h2",null,"我的 API Key",-1)),e(_,{type:"primary",onClick:l[0]||(l[0]=a=>v.value=!0)},{default:t(()=>[e(g,null,{default:t(()=>[e(k(se))]),_:1}),l[11]||(l[11]=n(" 创建 API Key ",-1))]),_:1})]),e(Q,{shadow:"hover"},{default:t(()=>[ne((p(),b(j,{data:P.value,stripe:""},{default:t(()=>[e(y,{prop:"name",label:"名称","min-width":"120"}),e(y,{label:"Key","min-width":"180"},{default:t(({row:a})=>[i("div",ce,[i("code",null,u(a.key_prefix)+"..."+u(a.key_suffix||""),1),a.key_full?(p(),b(_,{key:0,type:"primary",link:"",size:"small",onClick:T=>N(a.key_full)},{default:t(()=>[e(g,null,{default:t(()=>[e(k(E))]),_:1})]),_:1},8,["onClick"])):D("",!0)])]),_:1}),e(y,{label:"状态",width:"100"},{default:t(({row:a})=>[e(z,{type:a.status==="active"?"success":"danger",size:"small"},{default:t(()=>[n(u(a.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"绑定套餐","min-width":"120"},{default:t(({row:a})=>[a.user_package?(p(),x("span",fe,u(a.user_package.name),1)):(p(),x("span",me,"未绑定"))]),_:1}),e(y,{label:"使用统计",width:"150"},{default:t(({row:a})=>[i("div",ye,[i("div",null,"请求: "+u(a.request_count||0),1),i("div",null,"消费: $"+u((a.cost_used||0).toFixed(4)),1)])]),_:1}),e(y,{label:"创建时间",width:"160"},{default:t(({row:a})=>[n(u(I(a.created_at)),1)]),_:1}),e(y,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[e(_,{type:"primary",link:"",size:"small",onClick:T=>Z(a)},{default:t(()=>[e(g,null,{default:t(()=>[e(k(ue))]),_:1}),l[13]||(l[13]=n(" 详情 ",-1))]),_:1},8,["onClick"]),e(h,{title:"确定要删除这个 API Key 吗？",onConfirm:T=>O(a.id)},{reference:t(()=>[e(_,{type:"danger",link:"",size:"small"},{default:t(()=>[e(g,null,{default:t(()=>[e(k(de))]),_:1}),l[14]||(l[14]=n(" 删除 ",-1))]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[le,w.value]]),!w.value&&P.value.length===0?(p(),b(G,{key:0,description:"暂无 API Key"},{default:t(()=>[e(_,{type:"primary",onClick:l[1]||(l[1]=a=>v.value=!0)},{default:t(()=>[...l[15]||(l[15]=[n("创建第一个 API Key",-1)])]),_:1})]),_:1})):D("",!0)]),_:1}),e(U,{modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=a=>v.value=a),title:"创建 API Key",width:"500px"},{footer:t(()=>[e(_,{onClick:l[4]||(l[4]=a=>v.value=!1)},{default:t(()=>[...l[17]||(l[17]=[n("取消",-1)])]),_:1}),e(_,{type:"primary",loading:A.value,onClick:J},{default:t(()=>[...l[18]||(l[18]=[n("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(X,{model:c.value,"label-width":"100px"},{default:t(()=>[e(B,{label:"名称",required:""},{default:t(()=>[e(q,{modelValue:c.value.name,"onUpdate:modelValue":l[2]||(l[2]=a=>c.value.name=a),placeholder:"请输入名称，如：开发测试"},null,8,["modelValue"])]),_:1}),e(B,{label:"绑定套餐"},{default:t(()=>[e(W,{modelValue:c.value.user_package_id,"onUpdate:modelValue":l[3]||(l[3]=a=>c.value.user_package_id=a),placeholder:"选择套餐",clearable:"",style:{width:"100%"}},{default:t(()=>[(p(!0),x(ie,null,re(M.value,a=>(p(),b(R,{key:a.id,label:`${a.name} (${a.type==="subscription"?"订阅":"额度"})`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[16]||(l[16]=i("div",{class:"form-tip"},"不绑定套餐则使用默认计费",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(U,{modelValue:K.value,"onUpdate:modelValue":l[9]||(l[9]=a=>K.value=a),title:"API Key 创建成功",width:"500px","close-on-click-modal":!1},{footer:t(()=>[e(_,{type:"primary",onClick:l[8]||(l[8]=a=>K.value=!1)},{default:t(()=>[...l[21]||(l[21]=[n("我已保存",-1)])]),_:1})]),default:t(()=>[e(Y,{type:"warning",closable:!1,style:{"margin-bottom":"16px"}},{title:t(()=>[...l[19]||(l[19]=[i("strong",null,"请立即复制并保存此 API Key，关闭后将无法再次查看完整内容！",-1)])]),_:1}),i("div",ve,[e(q,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=a=>V.value=a),readonly:""},{append:t(()=>[e(_,{onClick:l[6]||(l[6]=a=>N(V.value))},{default:t(()=>[e(g,null,{default:t(()=>[e(k(E))]),_:1}),l[20]||(l[20]=n(" 复制 ",-1))]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),e(U,{modelValue:$.value,"onUpdate:modelValue":l[10]||(l[10]=a=>$.value=a),title:`${(L=d.value)==null?void 0:L.name} - 使用详情`,width:"600px"},{default:t(()=>[d.value?(p(),b(ee,{key:0,column:2,border:""},{default:t(()=>[e(f,{label:"名称"},{default:t(()=>[n(u(d.value.name),1)]),_:1}),e(f,{label:"状态"},{default:t(()=>[e(z,{type:d.value.status==="active"?"success":"danger",size:"small"},{default:t(()=>[n(u(d.value.status==="active"?"正常":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"Key 前缀"},{default:t(()=>[n(u(d.value.key_prefix)+"...",1)]),_:1}),e(f,{label:"创建时间"},{default:t(()=>[n(u(I(d.value.created_at)),1)]),_:1}),e(f,{label:"请求次数"},{default:t(()=>[n(u(d.value.request_count||0),1)]),_:1}),e(f,{label:"Token 使用"},{default:t(()=>[n(u(S(d.value.tokens_used)),1)]),_:1}),e(f,{label:"累计消费",span:2},{default:t(()=>[i("span",ge,"$"+u((d.value.cost_used||0).toFixed(4)),1)]),_:1}),e(f,{label:"最后使用",span:2},{default:t(()=>[n(u(d.value.last_used_at?I(d.value.last_used_at):"从未使用"),1)]),_:1})]),_:1})):D("",!0)]),_:1},8,["modelValue","title"])])}}},Ke=te(ke,[["__scopeId","data-v-6839ec34"]]);export{Ke as default};
