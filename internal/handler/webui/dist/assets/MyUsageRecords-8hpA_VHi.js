import{_ as Q,r as k,a as x,o as j,b as D,d as f,e as r,f as a,w as l,h as s,i as S,E as A,M as G,F as O,H as W,k as z,n as m,q as X,Q as Z,t as c,J as ee,l as U,D as F}from"./index-BNmznGOD.js";const te={class:"my-usage-records"},ae={class:"summary-value"},oe={class:"summary-value"},le={class:"summary-value"},se={class:"summary-value"},ne={key:0,class:"pagination-wrap"},re={__name:"MyUsageRecords",setup(de){const v=k(!1),b=k([]),R=k([]),n=x({dateRange:null,model:""}),_=x({request_count:0,total_tokens:0,total_cost:0,model_count:0}),u=x({page:1,pageSize:20,total:0}),V=[{text:"今天",value:()=>{const t=new Date;return[t,t]}},{text:"最近7天",value:()=>{const t=new Date,e=new Date;return e.setDate(e.getDate()-7),[e,t]}},{text:"最近30天",value:()=>{const t=new Date,e=new Date;return e.setDate(e.getDate()-30),[e,t]}},{text:"本月",value:()=>{const t=new Date;return[new Date(t.getFullYear(),t.getMonth(),1),t]}}],C=t=>t?new Date(t).toLocaleString("zh-CN"):"-",g=t=>t?t.toLocaleString():"0",q=t=>t?t>=1e6?(t/1e6).toFixed(2)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toLocaleString():"0",h=async()=>{v.value=!0;try{const t={page:u.page,page_size:u.pageSize};n.dateRange&&n.dateRange.length===2&&(t.start_date=n.dateRange[0],t.end_date=n.dateRange[1]),n.model&&(t.model=n.model);const e=await S.getUserUsageRecords(t);e.data&&(b.value=e.data.items||[],u.total=e.data.total||0)}catch{A.error("获取记录失败")}finally{v.value=!1}},N=async()=>{var t,e,y;try{const d=await S.getUserUsageSummary();d.data&&(_.total_cost=((t=d.data.total)==null?void 0:t.total_cost)||0,_.total_tokens=((e=d.data.total)==null?void 0:e.total_tokens)||0,_.request_count=((y=d.data.total)==null?void 0:y.request_count)||0,_.model_count=d.data.model_count||0)}catch(d){console.error("Failed to fetch summary:",d)}},B=async()=>{try{const t=await S.getUserModelStats();t.data&&(R.value=t.data.map(e=>e.model).filter(Boolean))}catch(t){console.error("Failed to fetch models:",t)}},L=()=>{n.dateRange=null,n.model="",u.page=1,h()};return j(()=>{h(),N(),B()}),(t,e)=>{const y=s("el-date-picker"),d=s("el-form-item"),Y=s("el-option"),T=s("el-select"),E=s("el-icon"),M=s("el-button"),I=s("el-form"),p=s("el-card"),w=s("el-col"),P=s("el-row"),i=s("el-table-column"),$=s("el-table"),H=s("el-pagination"),J=s("el-empty"),K=G("loading");return f(),D("div",te,[e[10]||(e[10]=r("div",{class:"page-header"},[r("h2",null,"使用记录")],-1)),a(p,{shadow:"hover",class:"filter-card"},{default:l(()=>[a(I,{inline:!0,model:n},{default:l(()=>[a(d,{label:"时间范围"},{default:l(()=>[a(y,{modelValue:n.dateRange,"onUpdate:modelValue":e[0]||(e[0]=o=>n.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"240px"},shortcuts:V},null,8,["modelValue"])]),_:1}),a(d,{label:"模型"},{default:l(()=>[a(T,{modelValue:n.model,"onUpdate:modelValue":e[1]||(e[1]=o=>n.model=o),placeholder:"全部模型",clearable:"",filterable:"",style:{width:"200px"}},{default:l(()=>[(f(!0),D(O,null,W(R.value,o=>(f(),z(Y,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:l(()=>[a(M,{type:"primary",onClick:h},{default:l(()=>[a(E,null,{default:l(()=>[a(X(Z))]),_:1}),e[4]||(e[4]=m(" 查询 ",-1))]),_:1}),a(M,{onClick:L},{default:l(()=>[...e[5]||(e[5]=[m("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(P,{gutter:16,class:"summary-row"},{default:l(()=>[a(w,{xs:12,sm:6},{default:l(()=>[a(p,{shadow:"hover",class:"summary-card"},{default:l(()=>[r("div",ae,c(_.request_count||0),1),e[6]||(e[6]=r("div",{class:"summary-label"},"请求次数",-1))]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:l(()=>[a(p,{shadow:"hover",class:"summary-card"},{default:l(()=>[r("div",oe,c(q(_.total_tokens)),1),e[7]||(e[7]=r("div",{class:"summary-label"},"总 Token",-1))]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:l(()=>[a(p,{shadow:"hover",class:"summary-card"},{default:l(()=>[r("div",le,"$"+c((_.total_cost||0).toFixed(4)),1),e[8]||(e[8]=r("div",{class:"summary-label"},"总费用",-1))]),_:1})]),_:1}),a(w,{xs:12,sm:6},{default:l(()=>[a(p,{shadow:"hover",class:"summary-card"},{default:l(()=>[r("div",se,c(_.model_count||0),1),e[9]||(e[9]=r("div",{class:"summary-label"},"使用模型数",-1))]),_:1})]),_:1})]),_:1}),a(p,{shadow:"hover"},{default:l(()=>[ee((f(),z($,{data:b.value,stripe:""},{default:l(()=>[a(i,{label:"时间",width:"160"},{default:l(({row:o})=>[m(c(C(o.request_time||o.timestamp)),1)]),_:1}),a(i,{prop:"model",label:"模型","min-width":"180","show-overflow-tooltip":""}),a(i,{label:"输入",width:"90"},{default:l(({row:o})=>[m(c(g(o.input_tokens)),1)]),_:1}),a(i,{label:"输出",width:"90"},{default:l(({row:o})=>[m(c(g(o.output_tokens)),1)]),_:1}),a(i,{label:"缓存创建",width:"90"},{default:l(({row:o})=>[r("span",{class:F({"cache-highlight":o.cache_creation_input_tokens>0})},c(g(o.cache_creation_input_tokens)),3)]),_:1}),a(i,{label:"缓存读取",width:"90"},{default:l(({row:o})=>[r("span",{class:F({"cache-read-highlight":o.cache_read_input_tokens>0})},c(g(o.cache_read_input_tokens)),3)]),_:1}),a(i,{label:"总Token",width:"100"},{default:l(({row:o})=>[m(c(g(o.total_tokens)),1)]),_:1}),a(i,{label:"费用",width:"100"},{default:l(({row:o})=>[m(" $"+c((o.total_cost||0).toFixed(4)),1)]),_:1}),a(i,{prop:"request_ip",label:"IP",width:"120","show-overflow-tooltip":""})]),_:1},8,["data"])),[[K,v.value]]),u.total>0?(f(),D("div",ne,[a(H,{"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=o=>u.page=o),"page-size":u.pageSize,"onUpdate:pageSize":e[3]||(e[3]=o=>u.pageSize=o),total:u.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onChange:h},null,8,["current-page","page-size","total"])])):U("",!0),!v.value&&b.value.length===0?(f(),z(J,{key:1,description:"暂无记录"})):U("",!0)]),_:1})])}}},ue=Q(re,[["__scopeId","data-v-b01b3abd"]]);export{ue as default};
