import{_ as Y,r as _,c as Z,o as ee,b as p,d as s,e as f,f as t,w as a,h as u,i as V,M as le,n as d,q as te,O as ae,J as oe,k as w,t as r,l as b,F,H as ue,E as M}from"./index-BNmznGOD.js";const ne={class:"packages-page"},se={class:"page-header"},de={key:0,class:"quota-info"},ie={key:0},pe={key:1},re={key:2},me={key:3},_e={key:1,class:"text-muted"},fe={__name:"Packages",setup(ce){const x=_(!1),P=_([]),D=_([]),c=_(!1),v=_(!1),h=_(!1),B=_(),o=_({id:0,name:"",type:"subscription",price:0,duration:30,daily_quota:0,weekly_quota:0,monthly_quota:0,quota_amount:0,allowed_models:"",status:"active",description:""}),E=Z({get(){return o.value.allowed_models?o.value.allowed_models.split(",").filter(n=>n.trim()):[]},set(n){o.value.allowed_models=n.join(",")}}),I={name:[{required:!0,message:"请输入名称",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}]};async function U(){x.value=!0;try{const n=await V.getPackages();P.value=n.data||[]}catch{}finally{x.value=!1}}async function L(){try{const n=await V.getModels();D.value=(n.data||[]).filter(l=>l.enabled)}catch{}}function R(){v.value=!1,o.value={id:0,name:"",type:"subscription",price:0,duration:30,daily_quota:0,weekly_quota:0,monthly_quota:0,quota_amount:0,allowed_models:"",status:"active",description:""},c.value=!0}function S(n){v.value=!0,o.value={...n},c.value=!0}async function j(){var l;if(await((l=B.value)==null?void 0:l.validate().catch(()=>!1))){h.value=!0;try{const g={...o.value,price:parseFloat(o.value.price)||0,duration:parseInt(o.value.duration)||30,daily_quota:parseFloat(o.value.daily_quota)||0,weekly_quota:parseFloat(o.value.weekly_quota)||0,monthly_quota:parseFloat(o.value.monthly_quota)||0,quota_amount:parseFloat(o.value.quota_amount)||0};v.value?(await V.updatePackage(o.value.id,g),M.success("更新成功")):(await V.createPackage(g),M.success("创建成功")),c.value=!1,U()}catch{}finally{h.value=!1}}}async function H(n){try{await V.deletePackage(n),M.success("删除成功"),U()}catch{}}return ee(()=>{U(),L()}),(n,l)=>{const g=u("el-icon"),k=u("el-button"),m=u("el-table-column"),C=u("el-tag"),J=u("el-popconfirm"),O=u("el-table"),T=u("el-card"),y=u("el-input"),i=u("el-form-item"),q=u("el-option"),$=u("el-select"),N=u("el-input-number"),z=u("el-col"),A=u("el-row"),G=u("el-divider"),K=u("el-form"),Q=u("el-dialog"),W=le("loading");return s(),p("div",ne,[f("div",se,[l[14]||(l[14]=f("h2",null,"套餐管理",-1)),t(k,{type:"primary",onClick:R},{default:a(()=>[t(g,null,{default:a(()=>[t(te(ae))]),_:1}),l[13]||(l[13]=d(" 创建套餐 ",-1))]),_:1})]),t(T,null,{default:a(()=>[oe((s(),w(O,{data:P.value,stripe:""},{default:a(()=>[t(m,{prop:"id",label:"ID",width:"60"}),t(m,{prop:"name",label:"名称",width:"120"}),t(m,{prop:"type",label:"类型",width:"80"},{default:a(({row:e})=>[t(C,{type:e.type==="subscription"?"primary":"success",size:"small"},{default:a(()=>[d(r(e.type==="subscription"?"订阅":"额度"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"price",label:"价格",width:"80"},{default:a(({row:e})=>[d(" $"+r(e.price.toFixed(2)),1)]),_:1}),t(m,{prop:"duration",label:"有效期",width:"80"},{default:a(({row:e})=>[d(r(e.duration)+"天 ",1)]),_:1}),t(m,{label:"额度限制","min-width":"200"},{default:a(({row:e})=>[e.type==="subscription"?(s(),p("div",de,[e.daily_quota>0?(s(),p("span",ie,"日: $"+r(e.daily_quota),1)):b("",!0),e.weekly_quota>0?(s(),p("span",pe,"周: $"+r(e.weekly_quota),1)):b("",!0),e.monthly_quota>0?(s(),p("span",re,"月: $"+r(e.monthly_quota),1)):b("",!0),!e.daily_quota&&!e.weekly_quota&&!e.monthly_quota?(s(),p("span",me,"无限制")):b("",!0)])):(s(),p(F,{key:1},[d(" 总额度: $"+r(e.quota_amount),1)],64))]),_:1}),t(m,{label:"模型限制",width:"120"},{default:a(({row:e})=>[e.allowed_models?(s(),w(C,{key:0,size:"small",type:"warning"},{default:a(()=>[d(r(e.allowed_models.split(",").length)+"个模型 ",1)]),_:2},1024)):(s(),p("span",_e,"全部"))]),_:1}),t(m,{prop:"status",label:"状态",width:"80"},{default:a(({row:e})=>[t(C,{type:e.status==="active"?"success":"info",size:"small"},{default:a(()=>[d(r(e.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"操作",width:"120",fixed:"right"},{default:a(({row:e})=>[t(k,{type:"primary",link:"",onClick:X=>S(e)},{default:a(()=>[...l[15]||(l[15]=[d("编辑",-1)])]),_:1},8,["onClick"]),t(J,{title:"确定删除该套餐吗？",onConfirm:X=>H(e.id)},{reference:a(()=>[t(k,{type:"danger",link:""},{default:a(()=>[...l[16]||(l[16]=[d("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[W,x.value]])]),_:1}),t(Q,{modelValue:c.value,"onUpdate:modelValue":l[12]||(l[12]=e=>c.value=e),title:v.value?"编辑套餐":"创建套餐",width:"600","close-on-click-modal":!1},{footer:a(()=>[t(k,{onClick:l[11]||(l[11]=e=>c.value=!1)},{default:a(()=>[...l[23]||(l[23]=[d("取消",-1)])]),_:1}),t(k,{type:"primary",loading:h.value,onClick:j},{default:a(()=>[d(r(v.value?"保存":"创建"),1)]),_:1},8,["loading"])]),default:a(()=>[t(K,{ref_key:"formRef",ref:B,model:o.value,rules:I,"label-width":"100px"},{default:a(()=>[t(i,{label:"名称",prop:"name"},{default:a(()=>[t(y,{modelValue:o.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value.name=e),placeholder:"套餐名称"},null,8,["modelValue"])]),_:1}),t(i,{label:"类型",prop:"type"},{default:a(()=>[t($,{modelValue:o.value.type,"onUpdate:modelValue":l[1]||(l[1]=e=>o.value.type=e),style:{width:"100%"},disabled:v.value},{default:a(()=>[t(q,{label:"订阅 (包月)",value:"subscription"}),t(q,{label:"额度",value:"quota"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(A,{gutter:16},{default:a(()=>[t(z,{span:12},{default:a(()=>[t(i,{label:"价格($)",prop:"price"},{default:a(()=>[t(N,{modelValue:o.value.price,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value.price=e),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(z,{span:12},{default:a(()=>[t(i,{label:"有效期(天)",prop:"duration"},{default:a(()=>[t(N,{modelValue:o.value.duration,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value.duration=e),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o.value.type==="subscription"?(s(),p(F,{key:0},[t(G,{"content-position":"left"},{default:a(()=>[...l[17]||(l[17]=[d("周期额度限制 (0=不限)",-1)])]),_:1}),t(i,{label:"每日额度"},{default:a(()=>[t(y,{modelValue:o.value.daily_quota,"onUpdate:modelValue":l[4]||(l[4]=e=>o.value.daily_quota=e),placeholder:"0",style:{width:"120px"}},null,8,["modelValue"]),l[18]||(l[18]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"美元",-1))]),_:1}),t(i,{label:"每周额度"},{default:a(()=>[t(y,{modelValue:o.value.weekly_quota,"onUpdate:modelValue":l[5]||(l[5]=e=>o.value.weekly_quota=e),placeholder:"0",style:{width:"120px"}},null,8,["modelValue"]),l[19]||(l[19]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"美元",-1))]),_:1}),t(i,{label:"每月额度"},{default:a(()=>[t(y,{modelValue:o.value.monthly_quota,"onUpdate:modelValue":l[6]||(l[6]=e=>o.value.monthly_quota=e),placeholder:"0",style:{width:"120px"}},null,8,["modelValue"]),l[20]||(l[20]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"美元",-1))]),_:1})],64)):b("",!0),o.value.type==="quota"?(s(),w(i,{key:1,label:"总额度",prop:"quota_amount"},{default:a(()=>[t(y,{modelValue:o.value.quota_amount,"onUpdate:modelValue":l[7]||(l[7]=e=>o.value.quota_amount=e),placeholder:"0",style:{width:"120px"}},null,8,["modelValue"]),l[21]||(l[21]=f("span",{style:{"margin-left":"8px",color:"#909399"}},"美元",-1))]),_:1})):b("",!0),t(i,{label:"允许的模型"},{default:a(()=>[t($,{modelValue:E.value,"onUpdate:modelValue":l[8]||(l[8]=e=>E.value=e),multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"留空表示全部模型",style:{width:"100%"}},{default:a(()=>[(s(!0),p(F,null,ue(D.value,e=>(s(),w(q,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l[22]||(l[22]=f("div",{class:"form-tip"},"限制该套餐可使用的模型列表，不选则允许全部模型",-1))]),_:1}),t(i,{label:"状态",prop:"status"},{default:a(()=>[t($,{modelValue:o.value.status,"onUpdate:modelValue":l[9]||(l[9]=e=>o.value.status=e),style:{width:"100%"}},{default:a(()=>[t(q,{label:"启用",value:"active"}),t(q,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"描述"},{default:a(()=>[t(y,{modelValue:o.value.description,"onUpdate:modelValue":l[10]||(l[10]=e=>o.value.description=e),type:"textarea",rows:2,placeholder:"套餐描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ye=Y(fe,[["__scopeId","data-v-8eca04d3"]]);export{ye as default};
