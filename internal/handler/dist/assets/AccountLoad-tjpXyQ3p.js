import{_ as K,r as p,c as j,o as G,b as H,d as h,e as i,f as t,w as o,h as l,i as J,O as Q,n as r,k as x,l as W,L as X,t as d}from"./index-C4cVtHYC.js";const Y={class:"load-page"},Z={class:"page-header"},$={class:"request-count"},ee={class:"total"},te={class:"detail"},ae={class:"success"},ne={class:"error"},oe={__name:"AccountLoad",setup(le){const g=p(!1),v=p([]),m=p("24h"),S=p(null),u=p(""),c=p(""),y=j(()=>Math.max(...v.value.map(e=>e.request_count),1));function C(e){return{claude:"warning",openai:"success",gemini:"primary"}[e]||"info"}function V(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e}function L(e){return e?new Date(e).toLocaleString("zh-CN"):"-"}function b(e){return e.request_count===0?100:Math.round(e.success_count/e.request_count*100)}function T(e){const a=b(e);return a>=95?"success":a>=80?"warning":"exception"}function w(e){return Math.round(e.request_count/y.value*100)}function q(e){const a=w(e);return a>80?"#f56c6c":a>50?"#e6a23c":"#67c23a"}function k(){const e=new Date;switch(m.value){case"1h":u.value=new Date(e-60*60*1e3).toISOString(),c.value=e.toISOString(),_();break;case"24h":u.value=new Date(e-24*60*60*1e3).toISOString(),c.value=e.toISOString(),_();break;case"7d":u.value=new Date(e-7*24*60*60*1e3).toISOString(),c.value=e.toISOString(),_();break;case"30d":u.value=new Date(e-30*24*60*60*1e3).toISOString(),c.value=e.toISOString(),_();break}}function R(e){e&&e.length===2&&(u.value=e[0].toISOString(),c.value=e[1].toISOString(),_())}async function _(){g.value=!0;try{const e={};u.value&&(e.start_time=u.value),c.value&&(e.end_time=c.value);const a=await J.getAccountLoadStats(e);v.value=a.data||[]}catch(e){console.error("Failed to fetch load stats:",e)}finally{g.value=!1}}return G(()=>{k()}),(e,a)=>{const M=l("Refresh"),N=l("el-icon"),B=l("el-button"),f=l("el-option"),A=l("el-select"),I=l("el-form-item"),F=l("el-date-picker"),P=l("el-form"),D=l("el-card"),s=l("el-table-column"),z=l("el-tag"),O=l("el-progress"),U=l("el-table"),E=Q("loading");return h(),H("div",Y,[i("div",Z,[a[3]||(a[3]=i("h2",null,"账户负载",-1)),t(B,{onClick:_},{default:o(()=>[t(N,null,{default:o(()=>[t(M)]),_:1}),a[2]||(a[2]=r(" 刷新 ",-1))]),_:1})]),t(D,{class:"filter-card"},{default:o(()=>[t(P,{inline:!0},{default:o(()=>[t(I,{label:"时间范围"},{default:o(()=>[t(A,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=n=>m.value=n),onChange:k},{default:o(()=>[t(f,{label:"最近1小时",value:"1h"}),t(f,{label:"最近24小时",value:"24h"}),t(f,{label:"最近7天",value:"7d"}),t(f,{label:"最近30天",value:"30d"}),t(f,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),m.value==="custom"?(h(),x(I,{key:0},{default:o(()=>[t(F,{modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=n=>S.value=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",onChange:R},null,8,["modelValue"])]),_:1})):W("",!0)]),_:1})]),_:1}),t(D,null,{default:o(()=>[X((h(),x(U,{data:v.value,stripe:""},{default:o(()=>[t(s,{prop:"account_id",label:"ID",width:"70"}),t(s,{prop:"account_name",label:"账户名称","min-width":"150"}),t(s,{prop:"platform",label:"平台",width:"100"},{default:o(({row:n})=>[t(z,{type:C(n.platform),size:"small"},{default:o(()=>[r(d(n.platform),1)]),_:2},1032,["type"])]),_:1}),t(s,{label:"请求数",width:"120"},{default:o(({row:n})=>[i("div",$,[i("span",ee,d(n.request_count),1),i("span",te,[a[4]||(a[4]=r(" (",-1)),i("span",ae,d(n.success_count),1),a[5]||(a[5]=r(" / ",-1)),i("span",ne,d(n.error_count),1),a[6]||(a[6]=r(") ",-1))])])]),_:1}),t(s,{label:"成功率",width:"120"},{default:o(({row:n})=>[t(O,{percentage:b(n),status:T(n),"stroke-width":10},null,8,["percentage","status"])]),_:1}),t(s,{prop:"total_tokens",label:"Token使用",width:"120"},{default:o(({row:n})=>[r(d(V(n.total_tokens)),1)]),_:1}),t(s,{prop:"avg_duration",label:"平均耗时",width:"100"},{default:o(({row:n})=>[r(d(n.avg_duration)+"ms ",1)]),_:1}),t(s,{label:"最后使用",width:"170"},{default:o(({row:n})=>[r(d(L(n.last_used_at)),1)]),_:1}),t(s,{label:"负载",width:"150"},{default:o(({row:n})=>[t(O,{percentage:w(n),color:q(n)},null,8,["percentage","color"])]),_:1})]),_:1},8,["data"])),[[E,g.value]])]),_:1})])}}},re=K(oe,[["__scopeId","data-v-32c67f06"]]);export{re as default};
