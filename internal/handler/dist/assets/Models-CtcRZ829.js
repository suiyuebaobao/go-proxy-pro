import{e as $e}from"./fontawesome-dkvI_xAu.js";import{_ as he,r as f,a as ae,c as te,o as ze,L as Fe,i as V,E as r,b as M,d as v,e as d,f as l,w as t,h as i,O as Ee,M as oe,n as p,k as z,l as ne,x as m,F as T,t as G,P as de}from"./index-RaNI7jtP.js";const Oe={class:"models-page"},Ae={class:"tab-header"},De={class:"model-name"},Se={class:"name"},je={class:"display-name"},Be={class:"price-info"},Ne={class:"tab-header"},Re={class:"mapping-info"},qe={class:"header-actions"},Ie={class:"model-code"},Le={class:"model-code"},Pe={class:"description"},Te={key:0,class:"cache-stats"},Ge={class:"stats-header"},Ke={key:0,class:"stats-content"},He={key:1,class:"no-mappings"},Je={style:{color:"#909399","font-size":"12px","margin-left":"8px"}},Qe={style:{color:"#909399","font-size":"12px","margin-left":"8px"}},We={__name:"Models",setup(Xe){$e();const B=f("models"),N=f(!1),F=f([]),O=f(""),k=f(!1),A=f(!1),R=f(!1),K=f(),H={name:"",display_name:"",platform:"claude",provider:"",description:"",category:"chat",context_size:2e5,max_output:8192,input_price:0,output_price:0,cache_create_price:0,cache_read_price:0,enabled:!0,is_default:!1,sort_order:0,aliases:""},n=ae({...H}),se={name:[{required:!0,message:"请输入模型名称",trigger:"blur"}],platform:[{required:!0,message:"请选择平台",trigger:"change"}]},ie=te(()=>O.value?F.value.filter(o=>o.platform===O.value):F.value),ue=te(()=>F.value.filter(o=>o.enabled)),q=f(!1),J=f([]),x=f(!1),D=f(!1),I=f(!1),Q=f(),C=f(null),W={source_model:"",target_model:"",priority:0,description:"",enabled:!0},u=ae({...W}),re={source_model:[{required:!0,message:"请输入源模型名称",trigger:"blur"}],target_model:[{required:!0,message:"请输入目标模型名称",trigger:"blur"}]};ze(()=>{L(),S(),U()}),Fe(B,o=>{o==="mappings"&&(S(),U())});async function L(){N.value=!0;try{const o=await V.getModels();F.value=o.data||[]}catch{r.error("加载模型列表失败")}finally{N.value=!1}}function pe(){A.value=!1,Object.assign(n,{...H}),k.value=!0}function me(o){A.value=!0,Object.assign(n,{...o}),k.value=!0}async function fe(){var e;if(await((e=K.value)==null?void 0:e.validate().catch(()=>!1))){R.value=!0;try{A.value?(await V.updateModel(n.id,n),r.success("更新成功")):(await V.createModel(n),r.success("创建成功")),k.value=!1,L()}catch(c){r.error(c.message||"操作失败")}finally{R.value=!1}}}async function ce(o){try{await V.toggleModel(o.id)}catch{o.enabled=!o.enabled,r.error("切换状态失败")}}async function _e(o){try{await de.confirm(`确定删除模型 "${o.name}" 吗？`,"确认删除",{type:"warning"}),await V.deleteModel(o.id),r.success("删除成功"),L()}catch(e){e!=="cancel"&&r.error("删除失败")}}function ge(o){return{claude:"primary",openai:"success",gemini:"warning"}[o]||"info"}function ve(o){return o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(0)+"K":o}async function S(){var o;q.value=!0;try{const e=await V.getModelMappings();J.value=((o=e.data)==null?void 0:o.mappings)||[]}catch{r.error("加载映射列表失败")}finally{q.value=!1}}async function U(){try{const o=await V.getModelMappingCacheStats();C.value=o.data||null}catch(o){console.error("加载缓存统计失败:",o)}}function be(){D.value=!1,Object.assign(u,{...W}),x.value=!0}function Ve(o){D.value=!0,Object.assign(u,{...o}),x.value=!0}async function ye(){var e;if(await((e=Q.value)==null?void 0:e.validate().catch(()=>!1))){I.value=!0;try{D.value?(await V.updateModelMapping(u.id,u),r.success("更新成功")):(await V.createModelMapping(u),r.success("创建成功")),x.value=!1,S(),U()}catch(c){r.error(c.message||"操作失败")}finally{I.value=!1}}}async function we(o){try{await V.toggleModelMapping(o.id),U()}catch{o.enabled=!o.enabled,r.error("切换状态失败")}}async function Me(o){try{await de.confirm(`确定删除映射 "${o.source_model}" 吗？`,"确认删除",{type:"warning"}),await V.deleteModelMapping(o.id),r.success("删除成功"),S(),U()}catch(e){e!=="cancel"&&r.error("删除失败")}}async function ke(){try{await V.refreshModelMappingCache(),r.success("缓存已刷新"),U()}catch{r.error("刷新缓存失败")}}return(o,e)=>{const c=i("el-option"),j=i("el-select"),y=i("el-button"),P=i("el-tag"),_=i("el-table-column"),E=i("el-switch"),X=i("el-table"),Y=i("el-tab-pane"),xe=i("el-alert"),Ce=i("el-divider"),Ue=i("el-tabs"),$=i("el-input"),s=i("el-form-item"),g=i("el-col"),h=i("el-row"),w=i("el-input-number"),Z=i("el-form"),ee=i("el-dialog"),le=Ee("loading");return v(),M("div",Oe,[e[48]||(e[48]=d("div",{class:"page-header"},[d("h2",null,"模型管理")],-1)),l(Ue,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=a=>B.value=a),class:"models-tabs"},{default:t(()=>[l(Y,{label:"模型列表",name:"models"},{default:t(()=>[d("div",Ae,[l(j,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value=a),placeholder:"筛选平台",clearable:"",style:{width:"150px","margin-right":"12px"}},{default:t(()=>[l(c,{label:"全部",value:""}),l(c,{label:"Claude",value:"claude"}),l(c,{label:"OpenAI",value:"openai"}),l(c,{label:"Gemini",value:"gemini"})]),_:1},8,["modelValue"]),l(y,{type:"primary",onClick:pe},{default:t(()=>[...e[26]||(e[26]=[d("i",{class:"fa-solid fa-plus"},null,-1),p(" 添加模型 ",-1)])]),_:1})]),oe((v(),z(X,{data:ie.value,stripe:""},{default:t(()=>[l(_,{prop:"name",label:"模型名称","min-width":"200"},{default:t(({row:a})=>[d("div",De,[d("span",Se,m(a.name),1),a.is_default?(v(),z(P,{key:0,size:"small",type:"success"},{default:t(()=>[...e[27]||(e[27]=[p("默认",-1)])]),_:1})):ne("",!0)]),d("div",je,m(a.display_name),1)]),_:1}),l(_,{prop:"platform",label:"平台",width:"100"},{default:t(({row:a})=>[l(P,{type:ge(a.platform)},{default:t(()=>[p(m(a.platform),1)]),_:2},1032,["type"])]),_:1}),l(_,{prop:"context_size",label:"上下文",width:"100"},{default:t(({row:a})=>[p(m(ve(a.context_size)),1)]),_:1}),l(_,{label:"价格 ($/1M)",width:"150"},{default:t(({row:a})=>[d("div",Be,[d("span",null,"入: $"+m(a.input_price),1),d("span",null,"出: $"+m(a.output_price),1)])]),_:1}),l(_,{prop:"enabled",label:"状态",width:"80"},{default:t(({row:a})=>[l(E,{modelValue:a.enabled,"onUpdate:modelValue":b=>a.enabled=b,onChange:b=>ce(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(_,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(y,{size:"small",onClick:b=>me(a)},{default:t(()=>[...e[28]||(e[28]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(y,{size:"small",type:"danger",onClick:b=>_e(a)},{default:t(()=>[...e[29]||(e[29]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,N.value]])]),_:1}),l(Y,{label:"模型映射",name:"mappings"},{default:t(()=>[d("div",Ne,[d("div",Re,[l(xe,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{default:t(()=>[...e[30]||(e[30]=[p(" 模型映射允许将客户端请求的模型名自动转换为实际的模型名。例如: claude-3-5-sonnet → claude-sonnet-4-20250514 ",-1)])]),_:1})]),d("div",qe,[l(y,{onClick:ke},{default:t(()=>[...e[31]||(e[31]=[d("i",{class:"fa-solid fa-sync"},null,-1),p(" 刷新缓存 ",-1)])]),_:1}),l(y,{type:"primary",onClick:be},{default:t(()=>[...e[32]||(e[32]=[d("i",{class:"fa-solid fa-plus"},null,-1),p(" 添加映射 ",-1)])]),_:1})])]),oe((v(),z(X,{data:J.value,stripe:""},{default:t(()=>[l(_,{prop:"source_model",label:"源模型","min-width":"200"},{default:t(({row:a})=>[d("code",Ie,m(a.source_model),1)]),_:1}),l(_,{label:"",width:"60",align:"center"},{default:t(()=>[...e[33]||(e[33]=[d("i",{class:"fa-solid fa-arrow-right",style:{color:"#909399"}},null,-1)])]),_:1}),l(_,{prop:"target_model",label:"目标模型","min-width":"200"},{default:t(({row:a})=>[d("code",Le,m(a.target_model),1)]),_:1}),l(_,{prop:"priority",label:"优先级",width:"80",align:"center"}),l(_,{prop:"description",label:"描述","min-width":"150"},{default:t(({row:a})=>[d("span",Pe,m(a.description||"-"),1)]),_:1}),l(_,{prop:"enabled",label:"状态",width:"80"},{default:t(({row:a})=>[l(E,{modelValue:a.enabled,"onUpdate:modelValue":b=>a.enabled=b,onChange:b=>we(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(_,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(y,{size:"small",onClick:b=>Ve(a)},{default:t(()=>[...e[34]||(e[34]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(y,{size:"small",type:"danger",onClick:b=>Me(a)},{default:t(()=>[...e[35]||(e[35]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,q.value]]),C.value?(v(),M("div",Te,[l(Ce),d("div",Ge,[d("strong",null,"当前生效的映射 ("+m(C.value.count)+" 条)",1)]),C.value.mappings&&Object.keys(C.value.mappings).length>0?(v(),M("div",Ke,[(v(!0),M(T,null,G(C.value.mappings,(a,b)=>(v(),z(P,{key:b,class:"mapping-tag",type:"info"},{default:t(()=>[p(m(b)+" → "+m(a),1)]),_:2},1024))),128))])):(v(),M("div",He,"暂无生效的映射"))])):ne("",!0)]),_:1})]),_:1},8,["modelValue"]),l(ee,{modelValue:k.value,"onUpdate:modelValue":e[18]||(e[18]=a=>k.value=a),title:A.value?"编辑模型":"添加模型",width:"600px"},{footer:t(()=>[l(y,{onClick:e[17]||(e[17]=a=>k.value=!1)},{default:t(()=>[...e[41]||(e[41]=[p("取消",-1)])]),_:1}),l(y,{type:"primary",onClick:fe,loading:R.value},{default:t(()=>[...e[42]||(e[42]=[p("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Z,{model:n,rules:se,ref_key:"formRef",ref:K,"label-width":"100px"},{default:t(()=>[l(h,{gutter:16},{default:t(()=>[l(g,{span:12},{default:t(()=>[l(s,{label:"模型名称",prop:"name"},{default:t(()=>[l($,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=a=>n.name=a),placeholder:"如: claude-3-5-sonnet"},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:12},{default:t(()=>[l(s,{label:"显示名称"},{default:t(()=>[l($,{modelValue:n.display_name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.display_name=a),placeholder:"如: Claude 3.5 Sonnet"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(h,{gutter:16},{default:t(()=>[l(g,{span:12},{default:t(()=>[l(s,{label:"平台",prop:"platform"},{default:t(()=>[l(j,{modelValue:n.platform,"onUpdate:modelValue":e[4]||(e[4]=a=>n.platform=a),filterable:"","allow-create":"",placeholder:"选择或输入平台",style:{width:"100%"}},{default:t(()=>[l(c,{label:"Claude",value:"claude"}),l(c,{label:"OpenAI",value:"openai"}),l(c,{label:"Gemini",value:"gemini"})]),_:1},8,["modelValue"]),e[36]||(e[36]=d("div",{class:"form-tip"},"决定使用哪个 API 处理请求",-1))]),_:1})]),_:1}),l(g,{span:12},{default:t(()=>[l(s,{label:"提供商"},{default:t(()=>[l($,{modelValue:n.provider,"onUpdate:modelValue":e[5]||(e[5]=a=>n.provider=a),placeholder:"如: anthropic"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(h,{gutter:16},{default:t(()=>[l(g,{span:12},{default:t(()=>[l(s,{label:"上下文长度"},{default:t(()=>[l(w,{modelValue:n.context_size,"onUpdate:modelValue":e[6]||(e[6]=a=>n.context_size=a),min:0,step:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:12},{default:t(()=>[l(s,{label:"最大输出"},{default:t(()=>[l(w,{modelValue:n.max_output,"onUpdate:modelValue":e[7]||(e[7]=a=>n.max_output=a),min:0,step:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(h,{gutter:16},{default:t(()=>[l(g,{span:12},{default:t(()=>[l(s,{label:"输入价格"},{default:t(()=>[l(w,{modelValue:n.input_price,"onUpdate:modelValue":e[8]||(e[8]=a=>n.input_price=a),min:0,precision:4,step:.1,style:{width:"100%"}},null,8,["modelValue"]),e[37]||(e[37]=d("div",{class:"form-tip"},"$/1M tokens",-1))]),_:1})]),_:1}),l(g,{span:12},{default:t(()=>[l(s,{label:"输出价格"},{default:t(()=>[l(w,{modelValue:n.output_price,"onUpdate:modelValue":e[9]||(e[9]=a=>n.output_price=a),min:0,precision:4,step:.1,style:{width:"100%"}},null,8,["modelValue"]),e[38]||(e[38]=d("div",{class:"form-tip"},"$/1M tokens",-1))]),_:1})]),_:1})]),_:1}),l(h,{gutter:16},{default:t(()=>[l(g,{span:12},{default:t(()=>[l(s,{label:"缓存写入"},{default:t(()=>[l(w,{modelValue:n.cache_create_price,"onUpdate:modelValue":e[10]||(e[10]=a=>n.cache_create_price=a),min:0,precision:4,step:.1,style:{width:"100%"}},null,8,["modelValue"]),e[39]||(e[39]=d("div",{class:"form-tip"},"$/1M tokens (可选)",-1))]),_:1})]),_:1}),l(g,{span:12},{default:t(()=>[l(s,{label:"缓存读取"},{default:t(()=>[l(w,{modelValue:n.cache_read_price,"onUpdate:modelValue":e[11]||(e[11]=a=>n.cache_read_price=a),min:0,precision:4,step:.1,style:{width:"100%"}},null,8,["modelValue"]),e[40]||(e[40]=d("div",{class:"form-tip"},"$/1M tokens (可选)",-1))]),_:1})]),_:1})]),_:1}),l(s,{label:"别名"},{default:t(()=>[l($,{modelValue:n.aliases,"onUpdate:modelValue":e[12]||(e[12]=a=>n.aliases=a),placeholder:"多个别名用逗号分隔"},null,8,["modelValue"])]),_:1}),l(s,{label:"描述"},{default:t(()=>[l($,{modelValue:n.description,"onUpdate:modelValue":e[13]||(e[13]=a=>n.description=a),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),l(h,{gutter:16},{default:t(()=>[l(g,{span:8},{default:t(()=>[l(s,{label:"排序"},{default:t(()=>[l(w,{modelValue:n.sort_order,"onUpdate:modelValue":e[14]||(e[14]=a=>n.sort_order=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:t(()=>[l(s,{label:"启用"},{default:t(()=>[l(E,{modelValue:n.enabled,"onUpdate:modelValue":e[15]||(e[15]=a=>n.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{span:8},{default:t(()=>[l(s,{label:"默认"},{default:t(()=>[l(E,{modelValue:n.is_default,"onUpdate:modelValue":e[16]||(e[16]=a=>n.is_default=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:x.value,"onUpdate:modelValue":e[25]||(e[25]=a=>x.value=a),title:D.value?"编辑映射":"添加映射",width:"500px"},{footer:t(()=>[l(y,{onClick:e[24]||(e[24]=a=>x.value=!1)},{default:t(()=>[...e[46]||(e[46]=[p("取消",-1)])]),_:1}),l(y,{type:"primary",onClick:ye,loading:I.value},{default:t(()=>[...e[47]||(e[47]=[p("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(Z,{model:u,rules:re,ref_key:"mappingFormRef",ref:Q,"label-width":"100px"},{default:t(()=>[l(s,{label:"源模型",prop:"source_model"},{default:t(()=>[l(j,{modelValue:u.source_model,"onUpdate:modelValue":e[19]||(e[19]=a=>u.source_model=a),filterable:"","allow-create":"",placeholder:"选择或输入客户端请求的模型名",style:{width:"100%"}},{default:t(()=>[(v(!0),M(T,null,G(F.value,a=>(v(),z(c,{key:a.id,label:a.name,value:a.name},{default:t(()=>[d("span",null,m(a.name),1),d("span",Je,m(a.display_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),e[43]||(e[43]=d("div",{class:"form-tip"},"客户端请求时使用的模型名称（可输入自定义名称）",-1))]),_:1}),l(s,{label:"目标模型",prop:"target_model"},{default:t(()=>[l(j,{modelValue:u.target_model,"onUpdate:modelValue":e[20]||(e[20]=a=>u.target_model=a),filterable:"",placeholder:"选择实际转发的模型",style:{width:"100%"}},{default:t(()=>[(v(!0),M(T,null,G(ue.value,a=>(v(),z(c,{key:a.id,label:a.name,value:a.name},{default:t(()=>[d("span",null,m(a.name),1),d("span",Qe,m(a.display_name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),e[44]||(e[44]=d("div",{class:"form-tip"},"实际发送到上游的模型名称",-1))]),_:1}),l(s,{label:"优先级"},{default:t(()=>[l(w,{modelValue:u.priority,"onUpdate:modelValue":e[21]||(e[21]=a=>u.priority=a),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[45]||(e[45]=d("div",{class:"form-tip"},"数值越大优先级越高",-1))]),_:1}),l(s,{label:"描述"},{default:t(()=>[l($,{modelValue:u.description,"onUpdate:modelValue":e[22]||(e[22]=a=>u.description=a),type:"textarea",rows:2,placeholder:"映射说明（可选）"},null,8,["modelValue"])]),_:1}),l(s,{label:"启用"},{default:t(()=>[l(E,{modelValue:u.enabled,"onUpdate:modelValue":e[23]||(e[23]=a=>u.enabled=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},el=he(We,[["__scopeId","data-v-86c1fad3"]]);export{el as default};
