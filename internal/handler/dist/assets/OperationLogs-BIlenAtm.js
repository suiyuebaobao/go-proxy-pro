import{e as ae}from"./fontawesome-CtfW6NVd.js";import{_ as te,r as v,a as O,p as le,o as oe,b as U,d as h,e as s,f as e,w as t,h as c,i as E,O as ne,n as i,v as se,M as ie,k as V,x as n,l as k,E as I}from"./index-S8NjSD-R.js";const de={class:"operation-logs-page"},ue={class:"page-header"},re={class:"header-actions"},ce={class:"filter-bar"},pe={class:"row-index"},_e={class:"log-time"},ge={class:"user-cell"},me={class:"username"},fe={class:"user-ip"},be={class:"description-cell"},ve={class:"description"},he={key:0,class:"target"},ye={class:"path-cell"},we={class:"path"},xe={class:"duration"},Ve={class:"table-footer"},ke={class:"ua-text"},ze={class:"request-body"},Ce={__name:"OperationLogs",setup(De){ae();const y=v(!1),z=v([]),x=v(!1),d=v(null),C=v(null),p=O({page:1,pageSize:20,total:0}),_=O({module:"",action:"",search:"",start_time:"",end_time:""}),N={auth:"认证",user:"用户",account:"账户",apikey:"API Key",model:"模型",config:"配置",cache:"缓存",proxy:"代理",package:"套餐",group:"分组",system:"系统"},Y={login:"登录",create:"创建",update:"更新",delete:"删除",clear:"清除"};function D(l){return N[l]||l}function A(l){return{auth:"warning",user:"primary",account:"success",apikey:"info",model:"",config:"warning",cache:"info",proxy:"danger",package:"success",group:""}[l]||""}function L(l){return Y[l]||l}function P(l){return{login:"warning",create:"success",update:"primary",delete:"danger",clear:"warning"}[l]||""}function B(l){return{POST:"success",PUT:"warning",DELETE:"danger",GET:"info"}[l]||""}function T(l){return l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}function q(l){try{return JSON.stringify(JSON.parse(l),null,2)}catch{return l}}let b=null;function F(){clearTimeout(b),b=setTimeout(()=>{p.page=1,m()},300)}le(()=>{b&&(clearTimeout(b),b=null)});function J(l){l?(_.start_time=l[0],_.end_time=l[1]):(_.start_time="",_.end_time=""),p.page=1,m()}function S(){p.page=1,m()}async function m(){y.value=!0;try{const l={page:p.page,page_size:p.pageSize,..._};Object.keys(l).forEach(f=>{(l[f]===""||l[f]===null)&&delete l[f]});const o=await E.getOperationLogs(l);z.value=o.data.items||[],p.total=o.data.total||0}catch(l){console.error("Failed to load operation logs:",l)}finally{y.value=!1}}function K(l){d.value=l,x.value=!0}async function $(){try{const l=await E.cleanupOperationLogs(90);I.success(`清理完成，删除了 ${l.data.deleted} 条记录`),m()}catch{I.error("清理失败")}}return oe(()=>{m()}),(l,o)=>{const f=c("el-button"),j=c("el-popconfirm"),r=c("el-option"),M=c("el-select"),G=c("el-date-picker"),R=c("el-input"),g=c("el-table-column"),w=c("el-tag"),H=c("el-table"),Q=c("el-pagination"),W=c("el-card"),u=c("el-descriptions-item"),X=c("el-descriptions"),Z=c("el-dialog"),ee=ne("loading");return h(),U("div",de,[s("div",ue,[o[9]||(o[9]=s("div",{class:"header-left"},[s("h2",null,"操作日志"),s("p",{class:"header-desc"},"记录系统所有操作行为，便于审计和追溯")],-1)),s("div",re,[e(f,{onClick:m},{default:t(()=>[s("i",{class:se(["fa-solid fa-sync-alt",{"fa-spin":y.value}])},null,2),o[7]||(o[7]=i(" 刷新 ",-1))]),_:1}),e(j,{title:"确定要清理90天前的日志吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:$},{reference:t(()=>[e(f,{type:"warning"},{default:t(()=>[...o[8]||(o[8]=[s("i",{class:"fa-solid fa-broom"},null,-1),i(" 清理旧日志 ",-1)])]),_:1})]),_:1})])]),s("div",ce,[e(M,{modelValue:_.module,"onUpdate:modelValue":o[0]||(o[0]=a=>_.module=a),clearable:"",placeholder:"模块",onChange:S,style:{width:"120px"}},{default:t(()=>[e(r,{label:"认证",value:"auth"}),e(r,{label:"用户",value:"user"}),e(r,{label:"账户",value:"account"}),e(r,{label:"API Key",value:"apikey"}),e(r,{label:"模型",value:"model"}),e(r,{label:"配置",value:"config"}),e(r,{label:"缓存",value:"cache"}),e(r,{label:"代理",value:"proxy"}),e(r,{label:"套餐",value:"package"}),e(r,{label:"分组",value:"group"})]),_:1},8,["modelValue"]),e(M,{modelValue:_.action,"onUpdate:modelValue":o[1]||(o[1]=a=>_.action=a),clearable:"",placeholder:"操作",onChange:S,style:{width:"120px"}},{default:t(()=>[e(r,{label:"登录",value:"login"}),e(r,{label:"创建",value:"create"}),e(r,{label:"更新",value:"update"}),e(r,{label:"删除",value:"delete"}),e(r,{label:"清除",value:"clear"})]),_:1},8,["modelValue"]),e(G,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=a=>C.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"260px"},onChange:J},null,8,["modelValue"]),e(R,{modelValue:_.search,"onUpdate:modelValue":o[3]||(o[3]=a=>_.search=a),placeholder:"搜索用户/描述/路径...",clearable:"",style:{width:"200px"},onInput:F},{prefix:t(()=>[...o[10]||(o[10]=[s("i",{class:"fa-solid fa-search"},null,-1)])]),_:1},8,["modelValue"])]),e(W,{class:"logs-table-card",shadow:"never"},{default:t(()=>[ie((h(),V(H,{data:z.value,stripe:""},{default:t(()=>[e(g,{label:"#",width:"60",align:"center"},{default:t(({$index:a})=>[s("span",pe,n((p.page-1)*p.pageSize+a+1),1)]),_:1}),e(g,{label:"时间",width:"170"},{default:t(({row:a})=>[s("span",_e,n(T(a.created_at)),1)]),_:1}),e(g,{label:"用户",width:"120"},{default:t(({row:a})=>[s("div",ge,[s("span",me,n(a.username||"-"),1),s("span",fe,n(a.ip),1)])]),_:1}),e(g,{label:"模块",width:"100"},{default:t(({row:a})=>[e(w,{size:"small",type:A(a.module)},{default:t(()=>[i(n(D(a.module)),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"操作",width:"80"},{default:t(({row:a})=>[e(w,{size:"small",type:P(a.action)},{default:t(()=>[i(n(L(a.action)),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"描述","min-width":"250"},{default:t(({row:a})=>[s("div",be,[s("span",ve,n(a.description),1),a.target_name?(h(),U("span",he,[o[11]||(o[11]=s("i",{class:"fa-solid fa-arrow-right"},null,-1)),i(" "+n(a.target_name),1)])):k("",!0)])]),_:1}),e(g,{label:"路径",width:"200"},{default:t(({row:a})=>[s("div",ye,[e(w,{size:"small",type:B(a.method)},{default:t(()=>[i(n(a.method),1)]),_:2},1032,["type"]),s("span",we,n(a.path),1)])]),_:1}),e(g,{label:"结果",width:"90",align:"center"},{default:t(({row:a})=>[e(w,{size:"small",type:a.response_code===0?"success":"danger"},{default:t(()=>[i(n(a.response_code===0?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(g,{label:"耗时",width:"80",align:"right"},{default:t(({row:a})=>[s("span",xe,n(a.duration)+"ms",1)]),_:1}),e(g,{label:"操作",width:"80",fixed:"right"},{default:t(({row:a})=>[e(f,{link:"",type:"primary",size:"small",onClick:Le=>K(a)},{default:t(()=>[...o[12]||(o[12]=[s("i",{class:"fa-solid fa-eye"},null,-1),i(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,y.value]]),s("div",Ve,[e(Q,{"current-page":p.page,"onUpdate:currentPage":o[4]||(o[4]=a=>p.page=a),"page-size":p.pageSize,"onUpdate:pageSize":o[5]||(o[5]=a=>p.pageSize=a),total:p.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onChange:m},null,8,["current-page","page-size","total"])])]),_:1}),e(Z,{modelValue:x.value,"onUpdate:modelValue":o[6]||(o[6]=a=>x.value=a),title:"操作日志详情",width:"600px"},{default:t(()=>[d.value?(h(),V(X,{key:0,column:2,border:""},{default:t(()=>[e(u,{label:"ID"},{default:t(()=>[i(n(d.value.id),1)]),_:1}),e(u,{label:"时间"},{default:t(()=>[i(n(T(d.value.created_at)),1)]),_:1}),e(u,{label:"用户"},{default:t(()=>[i(n(d.value.username)+" (ID: "+n(d.value.user_id)+")",1)]),_:1}),e(u,{label:"IP"},{default:t(()=>[i(n(d.value.ip),1)]),_:1}),e(u,{label:"模块"},{default:t(()=>[i(n(D(d.value.module)),1)]),_:1}),e(u,{label:"操作"},{default:t(()=>[i(n(L(d.value.action)),1)]),_:1}),e(u,{label:"目标ID"},{default:t(()=>[i(n(d.value.target_id||"-"),1)]),_:1}),e(u,{label:"目标名称"},{default:t(()=>[i(n(d.value.target_name||"-"),1)]),_:1}),e(u,{label:"描述",span:2},{default:t(()=>[i(n(d.value.description),1)]),_:1}),e(u,{label:"请求方法"},{default:t(()=>[i(n(d.value.method),1)]),_:1}),e(u,{label:"请求路径"},{default:t(()=>[i(n(d.value.path),1)]),_:1}),e(u,{label:"响应码"},{default:t(()=>[i(n(d.value.response_code),1)]),_:1}),e(u,{label:"响应消息"},{default:t(()=>[i(n(d.value.response_msg||"-"),1)]),_:1}),e(u,{label:"耗时"},{default:t(()=>[i(n(d.value.duration)+"ms",1)]),_:1}),e(u,{label:"User-Agent",span:2},{default:t(()=>[s("div",ke,n(d.value.user_agent||"-"),1)]),_:1}),d.value.request_body?(h(),V(u,{key:0,label:"请求体",span:2},{default:t(()=>[s("pre",ze,n(q(d.value.request_body)),1)]),_:1})):k("",!0)]),_:1})):k("",!0)]),_:1},8,["modelValue"])])}}},Me=te(Ce,[["__scopeId","data-v-40f4f3ce"]]);export{Me as default};
