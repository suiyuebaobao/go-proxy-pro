import{_ as F,u as U,a as b,r as m,o as B,b as E,d as N,e as R,f as e,w as l,h as t,z as S,n as y,i as V,E as P}from"./index-BhqdlszY.js";const q={class:"profile-page"},M={__name:"Profile",setup(z){const p=U(),d=b({email:""}),i=m(!1),f=m(),o=b({old_password:"",new_password:""}),_=m(!1),h={old_password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}]};B(()=>{var n;d.email=((n=p.user)==null?void 0:n.email)||""});async function x(){i.value=!0;try{await V.updateProfile({email:d.email}),await p.fetchProfile(),P.success("保存成功")}catch{}finally{i.value=!1}}async function k(){if(await f.value.validate().catch(()=>!1)){_.value=!0;try{await V.changePassword(o),P.success("密码修改成功"),o.old_password="",o.new_password=""}catch{}finally{_.value=!1}}}return(n,a)=>{const u=t("el-input"),r=t("el-form-item"),w=t("el-button"),c=t("el-form"),g=t("el-card"),v=t("el-col"),C=t("el-row");return N(),E("div",q,[a[5]||(a[5]=R("h2",null,"个人设置",-1)),e(C,{gutter:20},{default:l(()=>[e(v,{span:12},{default:l(()=>[e(g,{header:"基本信息"},{default:l(()=>[e(c,{model:d,"label-width":"80px"},{default:l(()=>[e(r,{label:"用户名"},{default:l(()=>{var s;return[e(u,{value:(s=S(p).user)==null?void 0:s.username,disabled:""},null,8,["value"])]}),_:1}),e(r,{label:"邮箱"},{default:l(()=>[e(u,{modelValue:d.email,"onUpdate:modelValue":a[0]||(a[0]=s=>d.email=s)},null,8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(w,{type:"primary",loading:i.value,onClick:x},{default:l(()=>[...a[3]||(a[3]=[y(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(v,{span:12},{default:l(()=>[e(g,{header:"修改密码"},{default:l(()=>[e(c,{ref_key:"pwdFormRef",ref:f,model:o,rules:h,"label-width":"80px"},{default:l(()=>[e(r,{label:"原密码",prop:"old_password"},{default:l(()=>[e(u,{modelValue:o.old_password,"onUpdate:modelValue":a[1]||(a[1]=s=>o.old_password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(r,{label:"新密码",prop:"new_password"},{default:l(()=>[e(u,{modelValue:o.new_password,"onUpdate:modelValue":a[2]||(a[2]=s=>o.new_password=s),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(w,{type:"primary",loading:_.value,onClick:k},{default:l(()=>[...a[4]||(a[4]=[y(" 修改密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},T=F(M,[["__scopeId","data-v-ce501222"]]);export{T as default};
