import{_ as C,u as I,r as n,a as U,c as z,o as B,b as v,d,e as c,f as t,w as l,g as E,h as p,i as L,j as N,k as R,l as q,m as A,n as M,E as S}from"./index-C4cVtHYC.js";const K={class:"login-container"},P={class:"login-card"},j={class:"captcha-row"},D=["src"],G={__name:"Login",setup(T){const y=N(),b=I(),h=n(),m=n(!1),f=n(""),w=n(""),o=n(!0),a=U({username:"",password:"",captcha:""}),V=z(()=>{const s={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};return o.value&&(s.captcha=[{required:!0,message:"请输入验证码",trigger:"blur"}]),s});async function u(){try{const s=await L.getCaptcha();o.value=s.data.enabled!==!1,o.value&&(w.value=s.data.captcha_id,f.value=s.data.image)}catch{o.value=!1}}async function g(){if(await h.value.validate().catch(()=>!1)){m.value=!0;try{const e={username:a.username,password:a.password};o.value&&(e.captcha_id=w.value,e.captcha=a.captcha),await b.login(e),S.success("登录成功"),y.push("/dashboard")}catch{o.value&&(u(),a.captcha="")}finally{m.value=!1}}}return B(()=>{u()}),(s,e)=>{const _=p("el-input"),i=p("el-form-item"),k=p("el-button"),x=p("el-form");return d(),v("div",K,[c("div",P,[e[4]||(e[4]=c("h2",{class:"login-title"},"Go-AIProxy",-1)),e[5]||(e[5]=c("p",{class:"login-subtitle"},"AI API 代理管理平台",-1)),e[6]||(e[6]=c("p",{class:"welcome-text"},"欢迎各位",-1)),t(x,{ref_key:"formRef",ref:h,model:a,rules:V.value,onSubmit:E(g,["prevent"])},{default:l(()=>[t(i,{prop:"username"},{default:l(()=>[t(_,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=r=>a.username=r),placeholder:"用户名","prefix-icon":"User",size:"large"},null,8,["modelValue"])]),_:1}),t(i,{prop:"password"},{default:l(()=>[t(_,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=r=>a.password=r),type:"password",placeholder:"密码","prefix-icon":"Lock",size:"large","show-password":""},null,8,["modelValue"])]),_:1}),o.value?(d(),R(i,{key:0,prop:"captcha"},{default:l(()=>[c("div",j,[t(_,{modelValue:a.captcha,"onUpdate:modelValue":e[2]||(e[2]=r=>a.captcha=r),placeholder:"验证码",size:"large",class:"captcha-input",onKeyup:A(g,["enter"])},null,8,["modelValue"]),f.value?(d(),v("img",{key:0,src:f.value,class:"captcha-image",onClick:u,title:"点击刷新验证码"},null,8,D)):(d(),v("div",{key:1,class:"captcha-placeholder",onClick:u}," 加载中... "))])]),_:1})):q("",!0),t(i,null,{default:l(()=>[t(k,{type:"primary",size:"large",loading:m.value,class:"login-btn",onClick:g},{default:l(()=>[...e[3]||(e[3]=[M(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])])}}},H=C(G,[["__scopeId","data-v-f65147f5"]]);export{H as default};
