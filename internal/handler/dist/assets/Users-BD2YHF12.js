import{_ as Vl,r as o,a as xe,c as ql,o as wl,b as v,d,e as f,f as a,w as t,h as y,i as b,O as Ul,n as s,z as Ce,Q as $e,x as i,M as pe,k as x,v as Ge,F as I,t as me,l as w,E as V}from"./index-RaNI7jtP.js";const xl={class:"users-page"},Cl={class:"page-header"},$l={class:"header-actions"},zl={key:0,class:"unlimited"},Pl={class:"pagination"},Kl={class:"selected-users"},hl={key:0,class:"usage-section"},Fl={key:0,class:"pkg-usage-info"},Dl={key:0},Il={key:1},Rl={key:2},Al={key:3,class:"unlimited"},Sl={key:1},Tl={class:"usage-section"},Ml={class:"apikey-header"},Bl={class:"key-full"},El={key:0},Ll={class:"new-key-display"},Nl={class:"key-box"},Ol={class:"package-header"},jl={key:0,class:"subscription-info"},Gl={class:"expire-info"},Ql={class:"quota-usage"},Hl={key:0,class:"quota-item"},Jl={key:1,class:"quota-item"},Wl={key:2,class:"quota-item"},Xl={key:3,class:"quota-item unlimited"},Yl={key:1,class:"text-muted"},Zl={__name:"Users",setup(ea){const fe=o(!1),ze=o([]),F=xe({page:1,pageSize:20,total:0}),Pe=o([]),B=o(!1),ve=o(!1),Ke=o(),_=xe({id:0,username:"",email:"",role:"",status:"",price_rate:1,max_concurrency:10}),R=o([]),E=o(!1),J=o(1),ye=o(!1),W=o(!1),X=o(!1),he=o(null),P=xe({totalRequests:0,totalTokens:0,totalCost:0}),_e=o([]),Y=o([]),Z=o(!1),ee=o(!1),K=o(null),le=o([]),L=o(!1),Fe=o(),ce=o(!1),ge=o([]),q=o({name:"",user_package_id:null,allowed_platforms:"all",rate_limit:60,daily_limit:0}),Qe={name:[{required:!0,message:"请输入名称",trigger:"blur"}],user_package_id:[{required:!0,message:"请选择要绑定的套餐",trigger:"change"}]},ae=o(!1),te=o(""),N=o(!1),ue=o(!1),se=o(!1),A=o(null),oe=o([]),De=o([]),O=o(!1),j=o(null),be=o(!1),G=o(!1),ke=o(!1),n=o({id:0,type:"",status:"",expire_time:null,daily_quota:0,weekly_quota:0,monthly_quota:0,daily_used:0,weekly_used:0,monthly_used:0,quota_total:0,quota_used:0,allowed_models:""}),Ie=ql({get(){return n.value.allowed_models?n.value.allowed_models.split(",").filter(u=>u.trim()):[]},set(u){n.value.allowed_models=u.join(",")}}),He={email:[{type:"email",message:"请输入有效的邮箱",trigger:"blur"}]},Q=o(!1),Re=o(),Ve=o(!1),g=o({username:"",password:"",email:"",role:"user",status:"active",price_rate:1,max_concurrency:10}),Je={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度 3-50 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码至少 6 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入有效的邮箱",trigger:"blur"}]};function We(u){return u===0?"success":u<1?"warning":u>1?"danger":"info"}function Ae(u){return u?new Date(u).toLocaleString("zh-CN"):""}async function S(){fe.value=!0;try{const u=await b.getUsers({page:F.page,page_size:F.pageSize});ze.value=u.data.items||[],F.total=u.data.total||0}catch{}finally{fe.value=!1}}async function Xe(){try{const u=await b.getModels();Pe.value=(u.data||[]).filter(e=>e.enabled)}catch{}}function Ye(u){Object.assign(_,u),B.value=!0}async function Ze(){if(await Ke.value.validate().catch(()=>!1)){ve.value=!0;try{await b.updateUser(_.id,{email:_.email,role:_.role,status:_.status,price_rate:_.price_rate,max_concurrency:_.max_concurrency}),V.success("更新成功"),B.value=!1,S()}catch{}finally{ve.value=!1}}}async function el(u){try{await b.deleteUser(u),V.success("删除成功"),S()}catch{}}function ll(u){R.value=u}function al(){J.value=1,E.value=!0}async function tl(){if(R.value.length!==0){ye.value=!0;try{const u=R.value.map(e=>e.id);await b.batchUpdateUserRates({user_ids:u,price_rate:J.value}),V.success(`已更新 ${u.length} 个用户的价格倍率`),E.value=!1,S()}catch{}finally{ye.value=!1}}}async function ul(u){he.value=u,W.value=!0,X.value=!0,P.totalRequests=0,P.totalTokens=0,P.totalCost=0,_e.value=[],Y.value=[];try{const e=await b.getUserUsageSummary(u.id);e.data&&(P.totalRequests=e.data.total_requests||0,P.totalTokens=e.data.total_tokens||0,P.totalCost=e.data.total_cost||0,_e.value=e.data.model_usage||[],Y.value=e.data.package_usage||[])}catch{}finally{X.value=!1}}wl(()=>{S(),Xe()});async function ie(u){K.value=u,Z.value=!0,ee.value=!0,le.value=[];try{const e=await b.adminGetUserAPIKeys(u.id);le.value=e.data||[]}catch{}finally{ee.value=!1}}async function sl(){q.value={name:"",user_package_id:null,allowed_platforms:"all",rate_limit:60,daily_limit:0};try{const u=await b.getUserPackages(K.value.id);if(ge.value=(u.data||[]).filter(e=>e.status==="active"),ge.value.length===0){V.warning("该用户没有活跃的套餐，请先分配套餐");return}}catch{V.error("获取用户套餐失败");return}L.value=!0}async function ol(){var e;if(await((e=Fe.value)==null?void 0:e.validate().catch(()=>!1))){ce.value=!0;try{const D=await b.adminCreateUserAPIKey(K.value.id,q.value);te.value=D.data.key,L.value=!1,ae.value=!0,ie(K.value)}catch{}finally{ce.value=!1}}}async function il(u){try{await b.adminToggleUserAPIKey(K.value.id,u.id),V.success("状态已更新"),ie(K.value)}catch{}}async function nl(u){try{await b.adminDeleteUserAPIKey(K.value.id,u.id),V.success("删除成功"),ie(K.value)}catch{}}async function dl(){try{await navigator.clipboard.writeText(te.value),N.value=!0,V.success("已复制到剪贴板"),setTimeout(()=>{N.value=!1},2e3)}catch{const e=document.createElement("input");e.value=te.value,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),N.value=!0,V.success("已复制到剪贴板"),setTimeout(()=>{N.value=!1},2e3)}}function rl(){g.value={username:"",password:"",email:"",role:"user",status:"active",price_rate:1,max_concurrency:10},Q.value=!0}async function pl(){var e;if(await((e=Re.value)==null?void 0:e.validate().catch(()=>!1))){Ve.value=!0;try{await b.createUser(g.value),V.success("创建成功"),Q.value=!1,S()}catch{}finally{Ve.value=!1}}}async function ne(u){A.value=u,ue.value=!0,se.value=!0,oe.value=[];try{const e=await b.getUserPackages(u.id);oe.value=e.data||[]}catch{}finally{se.value=!1}}async function ml(){j.value=null;try{const u=await b.getPackages();De.value=(u.data||[]).filter(e=>e.status==="active")}catch{}O.value=!0}async function fl(){if(!j.value){V.warning("请选择套餐");return}be.value=!0;try{await b.assignUserPackage(A.value.id,{package_id:j.value}),V.success("分配成功"),O.value=!1,ne(A.value)}catch{}finally{be.value=!1}}function vl(u){n.value={id:u.id,type:u.type,status:u.status,expire_time:u.expire_time,daily_quota:u.daily_quota||0,weekly_quota:u.weekly_quota||0,monthly_quota:u.monthly_quota||0,daily_used:u.daily_used||0,weekly_used:u.weekly_used||0,monthly_used:u.monthly_used||0,quota_total:u.quota_total||0,quota_used:u.quota_used||0,allowed_models:u.allowed_models||""},G.value=!0}async function yl(){ke.value=!0;try{const u={status:n.value.status,expire_time:n.value.expire_time,allowed_models:n.value.allowed_models};n.value.type==="subscription"?(u.daily_quota=n.value.daily_quota,u.weekly_quota=n.value.weekly_quota,u.monthly_quota=n.value.monthly_quota,u.daily_used=n.value.daily_used,u.weekly_used=n.value.weekly_used,u.monthly_used=n.value.monthly_used):(u.quota_total=n.value.quota_total,u.quota_used=n.value.quota_used),await b.updateUserPackage(n.value.id,u),V.success("保存成功"),G.value=!1,ne(A.value)}catch{}finally{ke.value=!1}}async function _l(u){try{await b.deleteUserPackage(u),V.success("删除成功"),ne(A.value)}catch{}}return(u,e)=>{var Me,Be,Ee;const D=y("el-icon"),m=y("el-button"),r=y("el-table-column"),U=y("el-tag"),qe=y("el-popconfirm"),H=y("el-table"),cl=y("el-pagination"),gl=y("el-card"),T=y("el-input"),p=y("el-form-item"),c=y("el-option"),h=y("el-select"),k=y("el-input-number"),M=y("el-form"),z=y("el-dialog"),we=y("el-statistic"),C=y("el-col"),de=y("el-row"),Se=y("el-progress"),Ue=y("el-empty"),bl=y("el-alert"),kl=y("el-date-picker"),Te=y("el-divider"),re=Ul("loading");return d(),v("div",xl,[f("div",Cl,[e[53]||(e[53]=f("h2",null,"用户管理",-1)),f("div",$l,[a(m,{type:"primary",onClick:rl},{default:t(()=>[a(D,null,{default:t(()=>[a(Ce($e))]),_:1}),e[52]||(e[52]=s(" 创建用户 ",-1))]),_:1}),a(m,{disabled:R.value.length===0,onClick:al},{default:t(()=>[s(" 批量设置倍率 ("+i(R.value.length)+") ",1)]),_:1},8,["disabled"])])]),a(gl,null,{default:t(()=>[pe((d(),x(H,{data:ze.value,stripe:"",onSelectionChange:ll},{default:t(()=>[a(r,{type:"selection",width:"55"}),a(r,{prop:"id",label:"ID",width:"80"}),a(r,{prop:"username",label:"用户名"}),a(r,{prop:"email",label:"邮箱"}),a(r,{prop:"role",label:"角色",width:"100"},{default:t(({row:l})=>[a(U,{type:l.role==="admin"?"danger":"info"},{default:t(()=>[s(i(l.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(U,{type:l.status==="active"?"success":"warning"},{default:t(()=>[s(i(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"price_rate",label:"价格倍率",width:"100"},{default:t(({row:l})=>[a(U,{type:We(l.price_rate)},{default:t(()=>[s(i(l.price_rate===0?"免费":`${l.price_rate}x`),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"max_concurrency",label:"并发限制",width:"90"},{default:t(({row:l})=>[s(i(l.max_concurrency||10),1)]),_:1}),a(r,{prop:"quota_key_balance",label:"额度余额",width:"100"},{default:t(({row:l})=>[f("span",{class:Ge({"low-balance":l.quota_key_balance<1&&l.quota_key_balance>0})}," $"+i((l.quota_key_balance||0).toFixed(2)),3)]),_:1}),a(r,{prop:"subscription_daily_remain",label:"订阅日余额",width:"110"},{default:t(({row:l})=>[l.subscription_daily_remain===-1?(d(),v("span",zl,"无限")):(d(),v("span",{key:1,class:Ge({"low-balance":l.subscription_daily_remain<1&&l.subscription_daily_remain>0})}," $"+i((l.subscription_daily_remain||0).toFixed(2)),3))]),_:1}),a(r,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:l})=>[s(i(Ae(l.created_at)),1)]),_:1}),a(r,{label:"操作",width:"320",fixed:"right"},{default:t(({row:l})=>[a(m,{type:"primary",link:"",onClick:$=>Ye(l)},{default:t(()=>[...e[54]||(e[54]=[s("编辑",-1)])]),_:1},8,["onClick"]),a(m,{type:"success",link:"",onClick:$=>ie(l)},{default:t(()=>[...e[55]||(e[55]=[s("apikey",-1)])]),_:1},8,["onClick"]),a(m,{type:"warning",link:"",onClick:$=>ne(l)},{default:t(()=>[...e[56]||(e[56]=[s("套餐",-1)])]),_:1},8,["onClick"]),a(m,{type:"info",link:"",onClick:$=>ul(l)},{default:t(()=>[...e[57]||(e[57]=[s("统计",-1)])]),_:1},8,["onClick"]),a(qe,{title:"确定删除该用户吗？",onConfirm:$=>el(l.id)},{reference:t(()=>[a(m,{type:"danger",link:""},{default:t(()=>[...e[58]||(e[58]=[s("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[re,fe.value]]),f("div",Pl,[a(cl,{"current-page":F.page,"onUpdate:currentPage":e[0]||(e[0]=l=>F.page=l),"page-size":F.pageSize,"onUpdate:pageSize":e[1]||(e[1]=l=>F.pageSize=l),total:F.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onChange:S},null,8,["current-page","page-size","total"])])]),_:1}),a(z,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=l=>B.value=l),title:"编辑用户",width:"500"},{footer:t(()=>[a(m,{onClick:e[7]||(e[7]=l=>B.value=!1)},{default:t(()=>[...e[61]||(e[61]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:ve.value,onClick:Ze},{default:t(()=>[...e[62]||(e[62]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{ref_key:"formRef",ref:Ke,model:_,rules:He,"label-width":"80px"},{default:t(()=>[a(p,{label:"用户名"},{default:t(()=>[a(T,{value:_.username,disabled:""},null,8,["value"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:t(()=>[a(T,{modelValue:_.email,"onUpdate:modelValue":e[2]||(e[2]=l=>_.email=l)},null,8,["modelValue"])]),_:1}),a(p,{label:"角色",prop:"role"},{default:t(()=>[a(h,{modelValue:_.role,"onUpdate:modelValue":e[3]||(e[3]=l=>_.role=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"普通用户",value:"user"}),a(c,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"状态",prop:"status"},{default:t(()=>[a(h,{modelValue:_.status,"onUpdate:modelValue":e[4]||(e[4]=l=>_.status=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"正常",value:"active"}),a(c,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"价格倍率",prop:"price_rate"},{default:t(()=>[a(k,{modelValue:_.price_rate,"onUpdate:modelValue":e[5]||(e[5]=l=>_.price_rate=l),min:0,max:10,step:.1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[59]||(e[59]=f("div",{class:"form-tip"},"0 = 免费，1 = 原价，1.5 = 1.5倍",-1))]),_:1}),a(p,{label:"最大并发"},{default:t(()=>[a(k,{modelValue:_.max_concurrency,"onUpdate:modelValue":e[6]||(e[6]=l=>_.max_concurrency=l),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[60]||(e[60]=f("div",{class:"form-tip"},"用户同时进行的最大请求数",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(z,{modelValue:Q.value,"onUpdate:modelValue":e[17]||(e[17]=l=>Q.value=l),title:"创建用户",width:"500","close-on-click-modal":!1},{footer:t(()=>[a(m,{onClick:e[16]||(e[16]=l=>Q.value=!1)},{default:t(()=>[...e[65]||(e[65]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:Ve.value,onClick:pl},{default:t(()=>[...e[66]||(e[66]=[s("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{ref_key:"createUserFormRef",ref:Re,model:g.value,rules:Je,"label-width":"80px"},{default:t(()=>[a(p,{label:"用户名",prop:"username"},{default:t(()=>[a(T,{modelValue:g.value.username,"onUpdate:modelValue":e[9]||(e[9]=l=>g.value.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(p,{label:"密码",prop:"password"},{default:t(()=>[a(T,{modelValue:g.value.password,"onUpdate:modelValue":e[10]||(e[10]=l=>g.value.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:t(()=>[a(T,{modelValue:g.value.email,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value.email=l),placeholder:"可选"},null,8,["modelValue"])]),_:1}),a(p,{label:"角色",prop:"role"},{default:t(()=>[a(h,{modelValue:g.value.role,"onUpdate:modelValue":e[12]||(e[12]=l=>g.value.role=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"普通用户",value:"user"}),a(c,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"状态",prop:"status"},{default:t(()=>[a(h,{modelValue:g.value.status,"onUpdate:modelValue":e[13]||(e[13]=l=>g.value.status=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"正常",value:"active"}),a(c,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"价格倍率",prop:"price_rate"},{default:t(()=>[a(k,{modelValue:g.value.price_rate,"onUpdate:modelValue":e[14]||(e[14]=l=>g.value.price_rate=l),min:0,max:10,step:.1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[63]||(e[63]=f("div",{class:"form-tip"},"0 = 免费，1 = 原价，1.5 = 1.5倍",-1))]),_:1}),a(p,{label:"最大并发"},{default:t(()=>[a(k,{modelValue:g.value.max_concurrency,"onUpdate:modelValue":e[15]||(e[15]=l=>g.value.max_concurrency=l),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"]),e[64]||(e[64]=f("div",{class:"form-tip"},"用户同时进行的最大请求数",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(z,{modelValue:E.value,"onUpdate:modelValue":e[20]||(e[20]=l=>E.value=l),title:"批量设置价格倍率",width:"450"},{footer:t(()=>[a(m,{onClick:e[19]||(e[19]=l=>E.value=!1)},{default:t(()=>[...e[68]||(e[68]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:ye.value,onClick:tl},{default:t(()=>[...e[69]||(e[69]=[s("确认设置",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{"label-width":"100px"},{default:t(()=>[a(p,{label:"选中用户"},{default:t(()=>[f("div",Kl,[(d(!0),v(I,null,me(R.value,l=>(d(),x(U,{key:l.id,style:{margin:"2px"}},{default:t(()=>[s(i(l.username),1)]),_:2},1024))),128))])]),_:1}),a(p,{label:"价格倍率"},{default:t(()=>[a(k,{modelValue:J.value,"onUpdate:modelValue":e[18]||(e[18]=l=>J.value=l),min:0,max:10,step:.1,precision:2,style:{width:"100%"}},null,8,["modelValue"]),e[67]||(e[67]=f("div",{class:"form-tip"},"0 = 免费，1 = 原价，1.5 = 1.5倍",-1))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(z,{modelValue:W.value,"onUpdate:modelValue":e[22]||(e[22]=l=>W.value=l),title:`${(Me=he.value)==null?void 0:Me.username} 的使用统计`,width:"800"},{footer:t(()=>[a(m,{onClick:e[21]||(e[21]=l=>W.value=!1)},{default:t(()=>[...e[72]||(e[72]=[s("关闭",-1)])]),_:1})]),default:t(()=>[pe((d(),v("div",null,[a(de,{gutter:16,class:"usage-summary"},{default:t(()=>[a(C,{span:8},{default:t(()=>[a(we,{title:"总请求数",value:P.totalRequests},null,8,["value"])]),_:1}),a(C,{span:8},{default:t(()=>[a(we,{title:"总 Token",value:P.totalTokens},null,8,["value"])]),_:1}),a(C,{span:8},{default:t(()=>[a(we,{title:"总消费 ($)",value:P.totalCost,precision:4},null,8,["value"])]),_:1})]),_:1}),Y.value.length>0?(d(),v("div",hl,[e[70]||(e[70]=f("h4",null,"套餐使用情况",-1)),a(H,{data:Y.value,size:"small","max-height":"250"},{default:t(()=>[a(r,{prop:"name",label:"套餐名称",width:"120"}),a(r,{prop:"type",label:"类型",width:"80"},{default:t(({row:l})=>[a(U,{type:l.type==="subscription"?"primary":"success",size:"small"},{default:t(()=>[s(i(l.type==="subscription"?"订阅":"额度"),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"status",label:"状态",width:"80"},{default:t(({row:l})=>[a(U,{type:l.status==="active"?"success":"info",size:"small"},{default:t(()=>[s(i(l.status==="active"?"有效":l.status==="expired"?"已过期":"已用尽"),1)]),_:2},1032,["type"])]),_:1}),a(r,{label:"使用情况","min-width":"200"},{default:t(({row:l})=>{var $,Le,Ne,Oe,je;return[l.type==="subscription"?(d(),v("div",Fl,[l.daily_quota>0?(d(),v("span",Dl,"日: $"+i((($=l.daily_used)==null?void 0:$.toFixed(2))||"0.00")+"/$"+i(l.daily_quota),1)):w("",!0),l.weekly_quota>0?(d(),v("span",Il,"周: $"+i(((Le=l.weekly_used)==null?void 0:Le.toFixed(2))||"0.00")+"/$"+i(l.weekly_quota),1)):w("",!0),l.monthly_quota>0?(d(),v("span",Rl,"月: $"+i(((Ne=l.monthly_used)==null?void 0:Ne.toFixed(2))||"0.00")+"/$"+i(l.monthly_quota),1)):w("",!0),!l.daily_quota&&!l.weekly_quota&&!l.monthly_quota?(d(),v("span",Al,"无限额")):w("",!0)])):(d(),v("div",Sl,[f("span",null,"$"+i(((Oe=l.quota_used)==null?void 0:Oe.toFixed(2))||"0.00")+" / $"+i(((je=l.quota_total)==null?void 0:je.toFixed(2))||"0.00"),1),a(Se,{percentage:l.quota_total>0?Math.min(100,l.quota_used/l.quota_total*100):0,status:l.quota_used>=l.quota_total?"exception":"","stroke-width":4,style:{"margin-top":"4px"}},null,8,["percentage","status"])]))]}),_:1})]),_:1},8,["data"])])):X.value?w("",!0):(d(),x(Ue,{key:1,description:"暂无套餐","image-size":60})),f("div",Tl,[e[71]||(e[71]=f("h4",null,"按模型统计",-1)),a(H,{data:_e.value,size:"small","max-height":"200"},{default:t(()=>[a(r,{prop:"model",label:"模型"}),a(r,{prop:"requests",label:"请求数",width:"100"}),a(r,{prop:"tokens",label:"Token 数",width:"120"}),a(r,{prop:"cost",label:"费用 ($)",width:"100"},{default:t(({row:l})=>[s(i(l.cost.toFixed(4)),1)]),_:1})]),_:1},8,["data"])])])),[[re,X.value]])]),_:1},8,["modelValue","title"]),a(z,{modelValue:Z.value,"onUpdate:modelValue":e[24]||(e[24]=l=>Z.value=l),title:`${(Be=K.value)==null?void 0:Be.username} 的 apikey`,width:"900"},{footer:t(()=>[a(m,{onClick:e[23]||(e[23]=l=>Z.value=!1)},{default:t(()=>[...e[76]||(e[76]=[s("关闭",-1)])]),_:1})]),default:t(()=>[f("div",Ml,[a(m,{type:"primary",size:"small",onClick:sl},{default:t(()=>[a(D,null,{default:t(()=>[a(Ce($e))]),_:1}),e[73]||(e[73]=s(" 创建 apikey ",-1))]),_:1})]),pe((d(),x(H,{data:le.value,stripe:"",size:"small"},{default:t(()=>[a(r,{prop:"name",label:"名称",width:"100"}),a(r,{label:"Key","min-width":"280"},{default:t(({row:l})=>[f("code",Bl,i(l.key_full||l.key_prefix),1)]),_:1}),a(r,{label:"绑定套餐","min-width":"120"},{default:t(({row:l})=>[l.user_package?(d(),v("div",El,[f("div",null,i(l.user_package.name),1),a(U,{type:l.billing_type==="subscription"?"primary":"success",size:"small"},{default:t(()=>[s(i(l.billing_type==="subscription"?"订阅":"额度"),1)]),_:2},1032,["type"])])):(d(),x(U,{key:1,type:"info",size:"small"},{default:t(()=>[...e[74]||(e[74]=[s("未绑定",-1)])]),_:1}))]),_:1}),a(r,{prop:"status",label:"状态",width:"70"},{default:t(({row:l})=>[a(U,{type:l.status==="active"?"success":"danger",size:"small"},{default:t(()=>[s(i(l.status==="active"?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"rate_limit",label:"限制",width:"80"},{default:t(({row:l})=>[s(i(l.rate_limit)+"/分钟 ",1)]),_:1}),a(r,{prop:"request_count",label:"请求数",width:"70"}),a(r,{label:"费用",width:"90"},{default:t(({row:l})=>[s(" $"+i((l.cost_used||0).toFixed(4)),1)]),_:1}),a(r,{label:"操作",width:"120",fixed:"right"},{default:t(({row:l})=>[a(m,{link:"",type:l.status==="active"?"warning":"success",size:"small",onClick:$=>il(l)},{default:t(()=>[s(i(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(qe,{title:"确定删除此 apikey？",onConfirm:$=>nl(l)},{reference:t(()=>[a(m,{link:"",type:"danger",size:"small"},{default:t(()=>[...e[75]||(e[75]=[s("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[re,ee.value]]),!ee.value&&le.value.length===0?(d(),x(Ue,{key:0,description:"暂无 apikey"})):w("",!0)]),_:1},8,["modelValue","title"]),a(z,{modelValue:L.value,"onUpdate:modelValue":e[31]||(e[31]=l=>L.value=l),title:"创建 apikey",width:"500","close-on-click-modal":!1},{footer:t(()=>[a(m,{onClick:e[30]||(e[30]=l=>L.value=!1)},{default:t(()=>[...e[78]||(e[78]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:ce.value,onClick:ol},{default:t(()=>[...e[79]||(e[79]=[s("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{model:q.value,rules:Qe,ref_key:"createKeyFormRef",ref:Fe,"label-position":"top"},{default:t(()=>[a(p,{label:"名称",prop:"name"},{default:t(()=>[a(T,{modelValue:q.value.name,"onUpdate:modelValue":e[25]||(e[25]=l=>q.value.name=l),placeholder:"为这个 Key 起个名字"},null,8,["modelValue"])]),_:1}),a(p,{label:"绑定套餐",prop:"user_package_id"},{default:t(()=>[a(h,{modelValue:q.value.user_package_id,"onUpdate:modelValue":e[26]||(e[26]=l=>q.value.user_package_id=l),style:{width:"100%"},placeholder:"请选择要绑定的套餐"},{default:t(()=>[(d(!0),v(I,null,me(ge.value,l=>(d(),x(c,{key:l.id,label:`${l.name} (${l.type==="subscription"?"订阅":"额度"})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[77]||(e[77]=f("div",{class:"form-tip"},"API Key 将从绑定的套餐扣费，一个套餐可创建多个 Key",-1))]),_:1}),a(p,{label:"允许的平台"},{default:t(()=>[a(h,{modelValue:q.value.allowed_platforms,"onUpdate:modelValue":e[27]||(e[27]=l=>q.value.allowed_platforms=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"全部平台",value:"all"}),a(c,{label:"仅 Claude",value:"claude"}),a(c,{label:"仅 OpenAI",value:"openai"}),a(c,{label:"仅 Gemini",value:"gemini"})]),_:1},8,["modelValue"])]),_:1}),a(de,{gutter:16},{default:t(()=>[a(C,{span:12},{default:t(()=>[a(p,{label:"每分钟限制"},{default:t(()=>[a(k,{modelValue:q.value.rate_limit,"onUpdate:modelValue":e[28]||(e[28]=l=>q.value.rate_limit=l),min:1,max:1e3,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{span:12},{default:t(()=>[a(p,{label:"每日限制 (0=不限)"},{default:t(()=>[a(k,{modelValue:q.value.daily_limit,"onUpdate:modelValue":e[29]||(e[29]=l=>q.value.daily_limit=l),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(z,{modelValue:ae.value,"onUpdate:modelValue":e[33]||(e[33]=l=>ae.value=l),title:"API Key 已创建",width:"500","close-on-click-modal":!1},{footer:t(()=>[a(m,{type:"primary",onClick:e[32]||(e[32]=l=>ae.value=!1)},{default:t(()=>[...e[82]||(e[82]=[s("我已保存，关闭",-1)])]),_:1})]),default:t(()=>[a(bl,{type:"warning",closable:!1,style:{"margin-bottom":"16px"}},{default:t(()=>[...e[80]||(e[80]=[s(" 请立即复制并妥善保存 API Key，关闭后无法再次查看！ ",-1)])]),_:1}),f("div",Ll,[e[81]||(e[81]=f("label",null,"API Key:",-1)),f("div",Nl,[f("code",null,i(te.value),1),a(m,{type:"primary",size:"small",onClick:dl},{default:t(()=>[s(i(N.value?"已复制":"复制"),1)]),_:1})])])]),_:1},8,["modelValue"]),a(z,{modelValue:ue.value,"onUpdate:modelValue":e[35]||(e[35]=l=>ue.value=l),title:`${(Ee=A.value)==null?void 0:Ee.username} 的套餐`,width:"800"},{footer:t(()=>[a(m,{onClick:e[34]||(e[34]=l=>ue.value=!1)},{default:t(()=>[...e[86]||(e[86]=[s("关闭",-1)])]),_:1})]),default:t(()=>[f("div",Ol,[a(m,{type:"primary",size:"small",onClick:ml},{default:t(()=>[a(D,null,{default:t(()=>[a(Ce($e))]),_:1}),e[83]||(e[83]=s(" 分配套餐 ",-1))]),_:1})]),pe((d(),x(H,{data:oe.value,stripe:"",size:"small"},{default:t(()=>[a(r,{prop:"name",label:"套餐名称",width:"120"}),a(r,{prop:"type",label:"类型",width:"80"},{default:t(({row:l})=>[a(U,{type:l.type==="subscription"?"primary":"success",size:"small"},{default:t(()=>[s(i(l.type==="subscription"?"订阅":"额度"),1)]),_:2},1032,["type"])]),_:1}),a(r,{prop:"status",label:"状态",width:"80"},{default:t(({row:l})=>[a(U,{type:l.status==="active"?"success":"info",size:"small"},{default:t(()=>[s(i(l.status==="active"?"有效":l.status==="expired"?"已过期":"已用尽"),1)]),_:2},1032,["type"])]),_:1}),a(r,{label:"详情","min-width":"280"},{default:t(({row:l})=>[l.type==="subscription"?(d(),v("div",jl,[f("div",Gl,"有效期: "+i(Ae(l.expire_time)),1),f("div",Ql,[l.daily_quota>0?(d(),v("span",Hl," 日: $"+i((l.daily_used||0).toFixed(2))+"/$"+i(l.daily_quota),1)):w("",!0),l.weekly_quota>0?(d(),v("span",Jl," 周: $"+i((l.weekly_used||0).toFixed(2))+"/$"+i(l.weekly_quota),1)):w("",!0),l.monthly_quota>0?(d(),v("span",Wl," 月: $"+i((l.monthly_used||0).toFixed(2))+"/$"+i(l.monthly_quota),1)):w("",!0),!l.daily_quota&&!l.weekly_quota&&!l.monthly_quota?(d(),v("span",Xl," 无限额 ")):w("",!0)])])):(d(),v(I,{key:1},[f("span",null,"额度: $"+i((l.quota_used||0).toFixed(2))+" / $"+i((l.quota_total||0).toFixed(2)),1),a(Se,{percentage:l.quota_total>0?Math.min(100,l.quota_used/l.quota_total*100):0,status:l.quota_used>=l.quota_total?"exception":"","stroke-width":6,style:{"margin-top":"4px"}},null,8,["percentage","status"])],64))]),_:1}),a(r,{label:"模型限制",width:"100"},{default:t(({row:l})=>[l.allowed_models?(d(),x(U,{key:0,size:"small",type:"warning"},{default:t(()=>[s(i(l.allowed_models.split(",").length)+"个 ",1)]),_:2},1024)):(d(),v("span",Yl,"全部"))]),_:1}),a(r,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[a(m,{type:"primary",link:"",size:"small",onClick:$=>vl(l)},{default:t(()=>[...e[84]||(e[84]=[s("编辑",-1)])]),_:1},8,["onClick"]),a(qe,{title:"确定删除此套餐？",onConfirm:$=>_l(l.id)},{reference:t(()=>[a(m,{type:"danger",link:"",size:"small"},{default:t(()=>[...e[85]||(e[85]=[s("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[re,se.value]]),!se.value&&oe.value.length===0?(d(),x(Ue,{key:0,description:"暂无套餐"})):w("",!0)]),_:1},8,["modelValue","title"]),a(z,{modelValue:O.value,"onUpdate:modelValue":e[38]||(e[38]=l=>O.value=l),title:"分配套餐",width:"400","close-on-click-modal":!1},{footer:t(()=>[a(m,{onClick:e[37]||(e[37]=l=>O.value=!1)},{default:t(()=>[...e[87]||(e[87]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:be.value,onClick:fl},{default:t(()=>[...e[88]||(e[88]=[s("分配",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{"label-width":"80px"},{default:t(()=>[a(p,{label:"选择套餐"},{default:t(()=>[a(h,{modelValue:j.value,"onUpdate:modelValue":e[36]||(e[36]=l=>j.value=l),style:{width:"100%"},placeholder:"请选择套餐"},{default:t(()=>[(d(!0),v(I,null,me(De.value,l=>(d(),x(c,{key:l.id,label:`${l.name} (${l.type==="subscription"?"订阅":"额度"})`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(z,{modelValue:G.value,"onUpdate:modelValue":e[51]||(e[51]=l=>G.value=l),title:"编辑用户套餐",width:"550","close-on-click-modal":!1},{footer:t(()=>[a(m,{onClick:e[50]||(e[50]=l=>G.value=!1)},{default:t(()=>[...e[92]||(e[92]=[s("取消",-1)])]),_:1}),a(m,{type:"primary",loading:ke.value,onClick:yl},{default:t(()=>[...e[93]||(e[93]=[s("保存",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(M,{model:n.value,"label-width":"100px"},{default:t(()=>[a(p,{label:"状态"},{default:t(()=>[a(h,{modelValue:n.value.status,"onUpdate:modelValue":e[39]||(e[39]=l=>n.value.status=l),style:{width:"100%"}},{default:t(()=>[a(c,{label:"有效",value:"active"}),a(c,{label:"已过期",value:"expired"}),a(c,{label:"已用尽",value:"exhausted"})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"过期时间"},{default:t(()=>[a(kl,{modelValue:n.value.expire_time,"onUpdate:modelValue":e[40]||(e[40]=l=>n.value.expire_time=l),type:"datetime",style:{width:"100%"},placeholder:"选择过期时间"},null,8,["modelValue"])]),_:1}),n.value.type==="subscription"?(d(),v(I,{key:0},[a(Te,{"content-position":"left"},{default:t(()=>[...e[89]||(e[89]=[s("周期额度限制 (0=不限)",-1)])]),_:1}),a(de,{gutter:16},{default:t(()=>[a(C,{span:8},{default:t(()=>[a(p,{label:"日限额($)"},{default:t(()=>[a(k,{modelValue:n.value.daily_quota,"onUpdate:modelValue":e[41]||(e[41]=l=>n.value.daily_quota=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(p,{label:"周限额($)"},{default:t(()=>[a(k,{modelValue:n.value.weekly_quota,"onUpdate:modelValue":e[42]||(e[42]=l=>n.value.weekly_quota=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(p,{label:"月限额($)"},{default:t(()=>[a(k,{modelValue:n.value.monthly_quota,"onUpdate:modelValue":e[43]||(e[43]=l=>n.value.monthly_quota=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(Te,{"content-position":"left"},{default:t(()=>[...e[90]||(e[90]=[s("当前周期已用 (可重置)",-1)])]),_:1}),a(de,{gutter:16},{default:t(()=>[a(C,{span:8},{default:t(()=>[a(p,{label:"日已用($)"},{default:t(()=>[a(k,{modelValue:n.value.daily_used,"onUpdate:modelValue":e[44]||(e[44]=l=>n.value.daily_used=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(p,{label:"周已用($)"},{default:t(()=>[a(k,{modelValue:n.value.weekly_used,"onUpdate:modelValue":e[45]||(e[45]=l=>n.value.weekly_used=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(C,{span:8},{default:t(()=>[a(p,{label:"月已用($)"},{default:t(()=>[a(k,{modelValue:n.value.monthly_used,"onUpdate:modelValue":e[46]||(e[46]=l=>n.value.monthly_used=l),min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):w("",!0),n.value.type==="quota"?(d(),v(I,{key:1},[a(p,{label:"总额度($)"},{default:t(()=>[a(k,{modelValue:n.value.quota_total,"onUpdate:modelValue":e[47]||(e[47]=l=>n.value.quota_total=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(p,{label:"已用额度($)"},{default:t(()=>[a(k,{modelValue:n.value.quota_used,"onUpdate:modelValue":e[48]||(e[48]=l=>n.value.quota_used=l),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})],64)):w("",!0),a(p,{label:"允许的模型"},{default:t(()=>[a(h,{modelValue:Ie.value,"onUpdate:modelValue":e[49]||(e[49]=l=>Ie.value=l),multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"留空表示全部模型",style:{width:"100%"}},{default:t(()=>[(d(!0),v(I,null,me(Pe.value,l=>(d(),x(c,{key:l.id,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[91]||(e[91]=f("div",{class:"form-tip"},"限制该套餐可使用的模型，不选则允许全部模型",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},aa=Vl(Zl,[["__scopeId","data-v-f85a04f2"]]);export{aa as default};
