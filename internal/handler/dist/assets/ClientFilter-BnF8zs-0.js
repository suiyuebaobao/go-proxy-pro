import{_ as $,a as F,r as v,o as M,b as u,d as r,f as t,k as O,l as p,w as s,h as i,F as T,i as f,e as l,t as P,v as Y,x as m,z as j,S as q,n as g,E as C}from"./index-S8NjSD-R.js";const G={class:"client-filter-page"},H={class:"main-switch"},K={class:"client-list"},Q=["onClick"],W={class:"client-icon"},X={class:"client-info"},Z={class:"client-name"},ee={class:"client-desc"},le={class:"mode-detail"},te={key:0},ae={key:1},se={key:0,class:"test-result"},ne={key:0},oe={__name:"ClientFilter",setup(ie){const d=F({filter_enabled:!1,filter_mode:"simple"}),h=v(!1),k=v([]),_=v(!1),o=F({user_agent:"",headersJson:"",bodyJson:""}),c=v(null);async function w(){try{const[n,e]=await Promise.all([f.getClientFilterConfig(),f.getClientTypes()]);Object.assign(d,n.data),d.filter_mode||(d.filter_mode="simple"),k.value=e.data||[]}catch{}}async function J(){h.value=!0;try{await f.updateClientFilterConfig(d),C.success("配置已保存")}catch{await w()}finally{h.value=!1}}async function z(n){n.enabled=!n.enabled;try{await f.toggleClientType(n.id),C.success(`${n.name} 已${n.enabled?"启用":"禁用"}`)}catch{n.enabled=!n.enabled}}function A(){o.user_agent="claude-cli/1.0.15 (external, cli)",o.headersJson=JSON.stringify({"x-app":"claude-code","anthropic-version":"2023-06-01","anthropic-beta":"oauth-2025-04-20","x-stainless-os":"Linux"},null,2),o.bodyJson=JSON.stringify({system:[{text:"You are Claude Code, Anthropic's official CLI for Claude."}],metadata:{user_id:"user_d98385411c93cd074b2cefd5c9831fe77f24a53e4ecdcd1f830bba586fe62cb9_account__session_17cf0fd3-d51b-4b59-977d-b899dafb3022"}},null,2)}async function B(){_.value=!0,c.value=null;try{let n={},e={};try{o.headersJson&&(n=JSON.parse(o.headersJson))}catch{C.error("请求头 JSON 格式错误"),_.value=!1;return}try{o.bodyJson&&(e=JSON.parse(o.bodyJson))}catch{C.error("请求体 JSON 格式错误"),_.value=!1;return}const x=await f.testClientFilter({user_agent:o.user_agent,path:"/v1/messages",headers:n,body:e});c.value=x.data}catch{}finally{_.value=!1}}return M(w),(n,e)=>{const x=i("el-switch"),y=i("el-card"),N=i("el-alert"),E=i("el-icon"),S=i("el-radio-button"),L=i("el-radio-group"),V=i("el-input"),b=i("el-form-item"),U=i("el-button"),D=i("el-form"),I=i("el-collapse-item"),R=i("el-collapse");return r(),u("div",G,[t(y,{class:"main-card"},{default:s(()=>[l("div",H,[e[5]||(e[5]=l("div",{class:"switch-info"},[l("h2",null,"客户端过滤"),l("p",{class:"description"},"只允许指定客户端访问 API")],-1)),t(x,{modelValue:d.filter_enabled,"onUpdate:modelValue":e[0]||(e[0]=a=>d.filter_enabled=a),size:"large","active-text":"已开启","inactive-text":"已关闭",onChange:J,loading:h.value},null,8,["modelValue","loading"])])]),_:1}),d.filter_enabled?p("",!0):(r(),O(N,{key:0,title:"过滤功能已关闭，所有请求都将被允许",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}})),d.filter_enabled?(r(),u(T,{key:1},[t(y,{class:"clients-card"},{default:s(()=>[e[6]||(e[6]=l("h3",null,"允许的客户端",-1)),l("div",K,[(r(!0),u(T,null,P(k.value,a=>(r(),u("div",{key:a.id,class:Y(["client-item",{enabled:a.enabled}]),onClick:de=>z(a)},[l("span",W,m(a.icon),1),l("div",X,[l("span",Z,m(a.name),1),l("span",ee,m(a.description),1)]),a.enabled?(r(),O(E,{key:0,class:"check-icon"},{default:s(()=>[t(j(q))]),_:1})):p("",!0)],10,Q))),128))])]),_:1}),t(y,{class:"mode-card"},{default:s(()=>[e[11]||(e[11]=l("h3",null,"验证模式",-1)),t(L,{modelValue:d.filter_mode,"onUpdate:modelValue":e[1]||(e[1]=a=>d.filter_mode=a),onChange:J,size:"large"},{default:s(()=>[t(S,{value:"simple"},{default:s(()=>[...e[7]||(e[7]=[l("div",{class:"mode-option"},[l("span",{class:"mode-title"},"简单模式"),l("span",{class:"mode-desc"},"宽松验证")],-1)])]),_:1}),t(S,{value:"strict"},{default:s(()=>[...e[8]||(e[8]=[l("div",{class:"mode-option"},[l("span",{class:"mode-title"},"严格模式"),l("span",{class:"mode-desc"},"完整验证")],-1)])]),_:1})]),_:1},8,["modelValue"]),l("div",le,[d.filter_mode==="simple"?(r(),u("p",te,[...e[9]||(e[9]=[l("strong",null,"简单模式",-1),g("：User-Agent 以 ",-1),l("code",null,"claude-cli/版本号",-1),g(" 开头即可",-1)])])):(r(),u("p",ae,[...e[10]||(e[10]=[l("strong",null,"严格模式",-1),g("：User-Agent 必须完整格式 ",-1),l("code",null,"claude-cli/版本 (external, cli)",-1)])]))])]),_:1}),t(y,{class:"test-card"},{default:s(()=>[t(R,null,{default:s(()=>[t(I,{title:"验证测试"},{default:s(()=>[t(D,{"label-width":"100px",size:"default"},{default:s(()=>[t(b,{label:"User-Agent"},{default:s(()=>[t(V,{modelValue:o.user_agent,"onUpdate:modelValue":e[2]||(e[2]=a=>o.user_agent=a),placeholder:"claude-cli/1.0.15 (external, cli)"},null,8,["modelValue"])]),_:1}),t(b,{label:"请求头"},{default:s(()=>[t(V,{modelValue:o.headersJson,"onUpdate:modelValue":e[3]||(e[3]=a=>o.headersJson=a),type:"textarea",rows:2,placeholder:'{"x-app": "claude-code", "anthropic-version": "2023-06-01"}'},null,8,["modelValue"])]),_:1}),t(b,{label:"请求体"},{default:s(()=>[t(V,{modelValue:o.bodyJson,"onUpdate:modelValue":e[4]||(e[4]=a=>o.bodyJson=a),type:"textarea",rows:3,placeholder:'{"system": [{"text": "You are Claude Code..."}]}'},null,8,["modelValue"])]),_:1}),t(b,null,{default:s(()=>[t(U,{type:"primary",onClick:B,loading:_.value},{default:s(()=>[...e[12]||(e[12]=[g(" 测试 ",-1)])]),_:1},8,["loading"]),t(U,{onClick:A},{default:s(()=>[...e[13]||(e[13]=[g("填入示例",-1)])]),_:1})]),_:1})]),_:1}),c.value?(r(),u("div",se,[t(N,{title:c.value.allowed?"验证通过":"验证失败",type:c.value.allowed?"success":"error","show-icon":"",closable:!1},{default:s(()=>{var a;return[l("p",null,"客户端: "+m(c.value.client_name||"未识别"),1),(a=c.value.details)!=null&&a.reason?(r(),u("p",ne,"原因: "+m(c.value.details.reason),1)):p("",!0)]}),_:1},8,["title","type"])])):p("",!0)]),_:1})]),_:1})]),_:1})],64)):p("",!0)])}}},ce=$(oe,[["__scopeId","data-v-3e6c3ca2"]]);export{ce as default};
