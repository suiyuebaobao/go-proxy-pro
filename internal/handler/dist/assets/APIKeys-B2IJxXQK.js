import{_ as O,r as _,a as $,o as j,b as H,d as w,e as g,f as t,w as a,h as r,i as b,O as J,M as T,k as U,x as o,n as i,E as V}from"./index-RaNI7jtP.js";const Q={class:"apikeys-page"},R={class:"key-full"},W={class:"pagination"},X={class:"log-header"},Y={class:"log-pagination"},Z={__name:"APIKeys",setup(ee){const h=_(!1),x=_([]),d=$({page:1,pageSize:20,total:0}),m=_(!1),z=_(!1),c=_(null),k=_([]),u=$({page:1,pageSize:20,total:0});function S(l){return l?new Date(l).toLocaleString("zh-CN"):""}function C(l){return l.expires_at?new Date(l.expires_at)<new Date:!1}function L(l){return l.status==="disabled"?"禁用":C(l)?"已过期":"正常"}function B(l){return l.status==="disabled"?"danger":C(l)?"warning":"success"}async function v(){h.value=!0;try{const l=await b.adminGetAllAPIKeys({page:d.page,page_size:d.pageSize});x.value=l.data.items||[],d.total=l.data.total||0}catch{}finally{h.value=!1}}async function E(l){try{await b.adminToggleUserAPIKey(l.user_id,l.id),V.success("状态已更新"),v()}catch{}}async function N(l){try{await b.adminDeleteUserAPIKey(l.user_id,l.id),V.success("删除成功"),v()}catch{}}function F(l){c.value=l,u.page=1,m.value=!0,K()}async function K(){if(c.value){z.value=!0,k.value=[];try{const l=await b.adminGetAPIKeyLogs(c.value.id,{page:u.page,page_size:u.pageSize});k.value=l.data.items||[],u.total=l.data.total||0}catch{}finally{z.value=!1}}}return j(()=>{v()}),(l,n)=>{var A;const s=r("el-table-column"),f=r("el-tag"),y=r("el-button"),M=r("el-popconfirm"),P=r("el-table"),D=r("el-pagination"),q=r("el-card"),G=r("el-dialog"),I=J("loading");return w(),H("div",Q,[n[9]||(n[9]=g("div",{class:"page-header"},[g("h2",null,"API Key 管理")],-1)),t(q,null,{default:a(()=>[T((w(),U(P,{data:x.value,stripe:""},{default:a(()=>[t(s,{prop:"id",label:"ID",width:"60"}),t(s,{label:"Key","min-width":"280"},{default:a(({row:e})=>[g("code",R,o(e.key_full||e.key_prefix),1)]),_:1}),t(s,{label:"用户",width:"100"},{default:a(({row:e})=>[t(f,{type:"info",size:"small"},{default:a(()=>{var p;return[i(o(((p=e.user)==null?void 0:p.username)||"-"),1)]}),_:2},1024)]),_:1}),t(s,{prop:"name",label:"名称",width:"100"}),t(s,{prop:"status",label:"状态",width:"80"},{default:a(({row:e})=>[t(f,{type:B(e),size:"small"},{default:a(()=>[i(o(L(e)),1)]),_:2},1032,["type"])]),_:1}),t(s,{prop:"rate_limit",label:"限速",width:"80"},{default:a(({row:e})=>[i(o(e.rate_limit)+"/分 ",1)]),_:1}),t(s,{prop:"request_count",label:"请求数",width:"80"}),t(s,{label:"费用",width:"90"},{default:a(({row:e})=>[i(" $"+o((e.cost_used||0).toFixed(4)),1)]),_:1}),t(s,{prop:"created_at",label:"创建时间",width:"150"},{default:a(({row:e})=>[i(o(S(e.created_at)),1)]),_:1}),t(s,{label:"操作",width:"160",fixed:"right"},{default:a(({row:e})=>[t(y,{link:"",type:"primary",size:"small",onClick:p=>F(e)},{default:a(()=>[...n[6]||(n[6]=[i("日志",-1)])]),_:1},8,["onClick"]),t(y,{link:"",type:e.status==="active"?"warning":"success",size:"small",onClick:p=>E(e)},{default:a(()=>[i(o(e.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),t(M,{title:"确定删除此 API Key？",onConfirm:p=>N(e)},{reference:a(()=>[t(y,{link:"",type:"danger",size:"small"},{default:a(()=>[...n[7]||(n[7]=[i("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[I,h.value]]),g("div",W,[t(D,{"current-page":d.page,"onUpdate:currentPage":n[0]||(n[0]=e=>d.page=e),"page-size":d.pageSize,"onUpdate:pageSize":n[1]||(n[1]=e=>d.pageSize=e),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next",onChange:v},null,8,["current-page","page-size","total"])])]),_:1}),t(G,{modelValue:m.value,"onUpdate:modelValue":n[5]||(n[5]=e=>m.value=e),title:`${(A=c.value)==null?void 0:A.key_prefix} 使用日志`,width:"1000px",top:"5vh"},{footer:a(()=>[t(y,{onClick:n[4]||(n[4]=e=>m.value=!1)},{default:a(()=>[...n[8]||(n[8]=[i("关闭",-1)])]),_:1})]),default:a(()=>[g("div",X,[t(f,{type:"info"},{default:a(()=>{var e,p;return[i("用户: "+o((p=(e=c.value)==null?void 0:e.user)==null?void 0:p.username),1)]}),_:1}),t(f,{type:"success"},{default:a(()=>{var e;return[i("请求数: "+o(((e=c.value)==null?void 0:e.request_count)||0),1)]}),_:1}),t(f,{type:"warning"},{default:a(()=>{var e;return[i("费用: $"+o((((e=c.value)==null?void 0:e.cost_used)||0).toFixed(4)),1)]}),_:1})]),T((w(),U(P,{data:k.value,stripe:"","max-height":"500",size:"small"},{default:a(()=>[t(s,{prop:"timestamp",label:"时间",width:"170"},{default:a(({row:e})=>[i(o(S(e.timestamp)),1)]),_:1}),t(s,{prop:"model",label:"模型","min-width":"200","show-overflow-tooltip":""}),t(s,{label:"输入 Token",width:"100"},{default:a(({row:e})=>[i(o(e.input_tokens||0),1)]),_:1}),t(s,{label:"输出 Token",width:"100"},{default:a(({row:e})=>[i(o(e.output_tokens||0),1)]),_:1}),t(s,{label:"缓存创建",width:"90"},{default:a(({row:e})=>[i(o(e.cache_creation_input_tokens||0),1)]),_:1}),t(s,{label:"缓存读取",width:"90"},{default:a(({row:e})=>[i(o(e.cache_read_input_tokens||0),1)]),_:1}),t(s,{label:"总 Token",width:"90"},{default:a(({row:e})=>[i(o(e.total_tokens||0),1)]),_:1}),t(s,{label:"费用",width:"100"},{default:a(({row:e})=>[i(" $"+o((e.total_cost||0).toFixed(6)),1)]),_:1})]),_:1},8,["data"])),[[I,z.value]]),g("div",Y,[t(D,{"current-page":u.page,"onUpdate:currentPage":n[2]||(n[2]=e=>u.page=e),"page-size":u.pageSize,"onUpdate:pageSize":n[3]||(n[3]=e=>u.pageSize=e),total:u.total,"page-sizes":[20,50,100],layout:"total, sizes, prev, pager, next",onChange:K},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue","title"])])}}},ae=O(Z,[["__scopeId","data-v-a7847649"]]);export{ae as default};
